// ==UserScript==
// @name		Rycochet's Castle Age Golem
// @namespace	golem
// @description	Auto player for Castle Age on Facebook. If there's anything you'd like it to do, just ask...
// @license		GNU Lesser General Public License; http://www.gnu.org/licenses/lgpl.html
// @version		31.3
// @include		http://apps.facebook.com/castle_age/*
// @include		http://apps.facebook.com/reqs.php
// @require		http://cloutman.com/jquery-latest.min.js
// @require		http://cloutman.com/jquery-ui-latest.min.js
// ==/UserScript==
// 
// For the source code please check the sourse repository
// - http://code.google.com/p/game-golem/
// 
// For the unshrunk Work In Progress version (which may introduce new bugs)
// - http://game-golem.googlecode.com/svn/trunk/_normal.user.js
var c,revision=591,show_debug=true,isRelease=true,VERSION="31.3",script_started=Date.now(),userID=0,imagepath="",isGreasemonkey=navigator.userAgent.toLowerCase().indexOf("chrome")===-1;
if(window.location.hostname==="apps.facebook.com"||window.location.hostname==="apps.new.facebook.com"){var applications={"reqs.php":["","Gifts"],castle_age:["46755028429","Castle Age"]};for(var i in applications)if(window.location.pathname.indexOf(i)===1){var APP=i,APPID=applications[i][0],APPNAME=applications[i][1],PREFIX="golem"+APPID+"_";break}if(typeof APP!=="undefined"){var log=function(){console.log("["+(new Date).toLocaleTimeString()+"] "+(WorkerStack&&WorkerStack.length?WorkerStack[WorkerStack.length-
1].name+": ":"")+$.makeArray(arguments).join("\n"))},debug=show_debug?function(){console.log("["+(typeof revision==="number"?"r"+revision:"v"+VERSION)+"] ["+(new Date).toLocaleTimeString()+"] "+(WorkerStack&&WorkerStack.length?WorkerStack[WorkerStack.length-1].name+": ":"")+$.makeArray(arguments).join("\n"))}:function(){};if(typeof unsafeWindow==="undefined")var unsafeWindow=window;var document_ready=function(){var d;userID=$("head").html().regex(/user:([0-9]+),/i);if(!userID||typeof userID!=="number"||
userID===0){log("ERROR: No Facebook UserID!!!");window.location.href=window.location.href}else if(APP!=="reqs.php"){try{imagepath=$("#app"+APPID+"_globalContainer img:eq(0)").attr("src").pathpart()}catch(e){log("ERROR: Bad Page Load!!!");Page.reload();return}do_css();Page.identify();for(d in Workers)Workers[d]._setup();for(d in Workers)Workers[d]._init();for(d in Workers){Workers[d]._update();Workers[d]._flush()}Page.parse_all()}};if(typeof jQuery!=="undefined")$(document).ready(document_ready);else{var head=
document.getElementsByTagName("head")[0]||document.documentElement,a=document.createElement("script"),b=document.createElement("script");a.type=b.type="text/javascript";a.src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js";b.src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js";head.appendChild(a);head.appendChild(b);log("Loading jQuery & jQueryUI");(function d(){log("...loading... jQuery: "+typeof jQuery+", window.jQuery: "+typeof unsafewindow.jQuery);if(typeof window.jQuery===
"undefined")window.setTimeout(d,1E4);else{log("jQuery Loaded...");$(document).ready(document_ready)}})()}}}var Images={};Images.blank="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTE%FF%FF%FF%00%00%00U%C2%D3~%00%00%00%01tRNS%00%40%E6%D8f%00%00%00%0FIDATx%DAb%60%18%05%C8%00%20%C0%00%01%10%00%01%3BBBK%00%00%00%00IEND%AEB%60%82";Images.energy="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%02%19PLTE%FD%FD%FE%FE%FE%FE%F9%8E%14%0EU%806o%94%0CDo%0BV%92%19Z%8C%DB%D4%CA%0BHtJ_g%2Fo%95%0EL%7B%FB%FC%FC%89%5C%20%89%5D%23%16Q%81%17S%82%09M%86E%7F%A4%FC%FD%FE%19X%83%00%3Dg%1BV%7D%A8%C0%CD%16W%8A%91Z%17%07Fn%E7%ED%F0%E6%ED%F2X%8C%AB%25%60%8FgbGG%7D%9B%E3%88%1C%FB%F7%F3%01-H%E7%8B%1C%EC%A0A%9E%BD%CFLZV%C5%D6%E2o%9C%B4NRP%DE%82%15%EF%95)%FA%91%1B%0A%40p%C6z%1A%19%60%94%EC%EE%F1%BEs%15%FA%FB%FBBdq%0EO%86%07DiLcn%F7%98%24%7Cs%5C%15V%80%AA%C1%CE%1EU%7F%BD%D2%DF%FC%FD%FD%1CQv%3De~%12U%80*a%87%0FGy%84%80l%10Gs%C7%90I%FB%FC%FD%F8%F7%F4mfH%13Nv%C0%CC%D6%E0%D3%C3-%5E%87%E3%E8%E9%1C_%8AOr%8FS%5BYL%84%A6%0DCp%2FQd%CA%D9%E1%EB%ABTx%98%A4%03%3Fm%D7%E1%E4%F9%8E%15%5Bge%A3%C1%D5%09Ir%82f7%F3%EC%E4%0DK%7B%15Q%83%00Ex%13%2FI%12S%89%ED%8D%19AE%3Dt%9F%B9%EF%F2%F4%26%5E%89rZ%3A%05Bl)i%8Dvzq%CB~%22w%A0%B8%C6%D4%E0%A0%BE%CD%E8%A3A3LZ%2Ff%90%17%5C%89%EF%E8%DB%04P%8F%E3%EC%F0%F4%90%178n%8C%C2%D5%E0%E5%EA%EDHNF%F1%8F%1AHh%7C%FE%FA%F4%0B%40b2Xm%A3%BF%D3G~%A5%18Ip%13Mz%8E%AD%C1%18Z%8E%1CY%87%0ADnS%8B%AC6o%92%EB%8B%19%20V%7F%E8%ED%F0I%5Eey%80v%C5%D6%E0%17V%85%E5%EC%EF%B3%CA%D5%EF%93%1B%E0%D7%CC%15S%7F%EA%8F%22%E9%94%2B.n%97%26f%8E%13M%7C%0AT%93D%7B%9D%A3g%1Ej%99%B1%D3%DE%E4%60%94%AF3s%9D%F5%90%20j%95%AEadS%F7%992%0FGw%85%AA%BE%0FKy%DC%E4%EB%22%5E%90%1Ee%9F%ACq%2B%0CY%9A%FF%FF%FF%81%9F%22%D3%00%00%00%B3tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%0F)%BF%E8%00%00%00%ECIDATx%DAb%D8%B4iScx%B1%A7%87%89%FD%260%60%00be%5D%D5%88%25%CB%8B*a%02%0C%3E%B3%94LsKYzbE%20%02%D3%AA%F3%FB%B8%E4%FD%B2%FA%7B%5B%40%D2%9B%A6%0A%9Bo%A8%9A%B8%91%BDsJ%DB%9C0%90%80%BA%F8%AAx%BD%98%C0I%CE%92%02%ED%05%B2%40%01%B9y%82%0A%D3%DD%D5f%3B%1Avy%2B.%06%0A%04%3B%94%05E%EB%18%A45%AC_g%3BW%02(%D0%CAj%16%CA%9F%9E%CDd1%3F%C9-%C0%06(%90!%ED%92%D8%5D%B1%A2%DE*%AFYlA%14P%A0pf%0EO*%9B%C6%B2%95%96%DA%C9%AB3%81%02F%8B8%F5%D7%08%95%2C%942%AE%5B%EA%0Fv%98%8CV%5CdHS%8A%0A%9F%AB%26%23%C4%2F%13%3A%B8%9D%98%ADE%BDf0B%3D%B7%89%B7v%B2%5D%CDZ%0E_%98o%A1%A0%3C%01D%02%04%18%00M%2Frc%09%13M%1C%00%00%00%00IEND%AEB%60%82";
Images.exp="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%01%E9PLTE%FFs%01%FE%FE%FE%DDd%07%E7%ED%F0%E0%EA%EE%FC%FD%FE%009a%88%3D%12V%86%A6k%99%B1%1AT%826o%93%0FLy%0DLxf8%25%A3%BF%D3%A3%C1%D5%EEk%02%07BnF%7D%A3%05%40l%1FT%80%04%3Ae%88F%20D%3ED%09Du%19U%83%BBT%0B%D7%E1%E4%00!P%CC%5C%07%E3%E8%E9w6%11%DDd%08%8C%B2%C6%8E%B2%C7%00%0E%3C%EEk%03%1CW%7C%F3%F4%F5%A6%BE%CD%22%3BT%F1%F4%F5%12S%86%14M%7B%00%10%40%D2%DE%E3%22%0F!%00Fq%04%3Dh%DDd%06%C5%D4%DE%A4%C0%CFw6%1B%EEk%01o%9B%B4%005c%00%1CI%2Ff%90%13Dk%0FN%7C%3Bu%99R%8B%AC%1CQv5o%94%F7%F9%FA0o%95%E8%ED%F03%40Ka%93%AC%EEk%04%9A%BB%CD%BBT%0D%CC%5C%0A%17%5D%88U.(%84%AA%BE%99G%15%05%3Bg%15T%7B6p%93%FD%FD%FD%00.V%96%B6%C9%1DU%81w6%17%00%2CV%20W~6n%92%A3%BF%D4G~%A2%20W%7Fw6%0E%A4%C1%D5D03%0BGt%00%25Vf.%153%2F%3F%1E%5D%86%05BrU%409%08%3Fk%02%3Dk-g%8F%0AAp%09Ir%A4%BC%CA3%1C%2B%2Fh%8B2b%8Ao%97%B1%C9%D9%E1Dy%97._%88-_%87%22.Ir%9A%B0u%9E%B7%C8%D6%DE%0DGiD%2F%2F%114W%22%3BRS%8B%AC%00%1DM%C1%D1%DE%1BT%83%00%3Ai%06%3Ag%00%00%2F%000cD%3BB%2Fk%8F%12V%80%AF%C6%D5H~%9F%22(%3B%EC%EE%F1%CC%5C%01%BBT%0C%00%2F%5D'%5D%87t%9E%B9L%84%A6%A4%C0%CE%19%5C%87%C6%D3%DA%26%5E%89%06Bt%0FU%7FS%88%A8%02%3Bh%E9%F0%F3%FA%FB%FC%CC%5C%04%91%AF%C3-m%96%03%3Fm%22%2FH%1FR%7F%BE%D0%DA%FF%FF%FF%F4%06%053%00%00%00%A3tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%02%0A%B7%01%00%00%00%DCIDATx%DAbX%84%06%18%40%04%8BI%A9k%FED%16%98%00k%AC%9DCF%AE%15w%8D%00%2BD%202%20%BC%2F%AF%A8xJt%04%FF%2C%90%00sT%C5%02%D1%10.)m%1B%EB%B9%05%8C%40%01w5%3F%89%AAj%17%CD%F9I%253%CAf%02%05%A6%EBXx%C60%F1%F9%1A%C91t%16%EA%01%05%26%D8%B3)%98%B1%EB%F6%9861T%26g%03%05%84%0Degw%B3%AB0%E8%87%BAYN%D2%00%0A%F4%B3%89K'*%E6%A8%0A2%C5%05u%C8%00%05%EAx%C3z%9B%13%BC%3Dj%1B%C4%0C%7C%B4%80%02%5D%9C%F1%99%3CS%5BR%25%EB%85l%E5A%D6.b6%CF%9A%97%96%DE(%92%D2%3A9%10%E2%17%E79Nm%D3%FC%BD8%162%C2%3C%A7n%1C%AC%A4%DC%5E%EE%08%F7-2%00%080%00'%88h7%CBI9%B0%00%00%00%00IEND%AEB%60%82";
Images.gold="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%02%04PLTE%FF%FF%FF%009f%00%3Ag%9F%9Fy%18MyRI%01%5C%92%B5%2Fi%96%E9%DD%93VK%03%E8%ED%F0n%9B%B6%BD%CC%CF%A2%BE%CB%FC%FC%FC%FD%F2%B2%FF%F2%B2SG%00%076W%F3%F4%F4%E2%EC%EE%AC%C2%D4%E7%EC%F0%C3%C5%AA%E6%EA%F0%0EIz%A9%C2%D4%08Dw%F2%F2%D7%FB%FB%FC%08Gz%DA%CC%7Czl%17%AF%9FEgZ%1B%FE%FE%FEi%95%AF%5BV%180r%94i%5B%074u%9An_%0B%8C%AF%C4%00%3Dc2p%94%009%60%E3%EA%EE%25Ss%CD%D8%E1z%83o%EC%E4%A7%8F%AC%BE%E3%D7%8Bdd%2F~n%10%FE%FE%FF%AF%A1L%BD%CB%D2%B5%CF%DF%0BP%7F%E0%D3%8A%EC%E0%A1%BC%A9SIimzf%10%93%80%22sg%16%93%86%3Ds~yn%83%7B%CB%C8%91We%5C%9C%B8%CA%E1%D0x%CA%BFr%A4%914%95%B1%C5%D7%D4%A6x%A2%B5%E0%E5%E8%C8%B7%84%FC%FD%FE%FE%FE%FD%E8%E0%96%FF%FC%DA%BF%CB%CF%A5%C1%CF%AD%C6%BE%B3%A4G%FA%EF%B9%BE%B0b%E9%EE%F0%2Fm%95%020Q%D8%C6mK%83%A7%A1%BC%CA%1D2%2F%13Jn%23Uri%7Cf%2C%3C4gZ%09%15X%86%1BKo%194B0s%97%1A%60%8F%89z%19%BC%CD%D6%93%B7%D1'a%89%DF%D4%81e%93%A8%086a%C8%D9%E1%AE%A0%40zuN%E6%D6%86%60%8A%9F%88p%1F%BA%C4%A7%14V%7F%B5%98%2C%BA%B6%80%F2%F2%F1%DE%D0%7C%BA%AAT%C4%B6%60%5C%8C%AA%2B%5B%7F%D5%C3w%5D%60DJ%84%A7%85n%17%9F%8E1G%83%A4%B2%9FA2p%96%8F%7F%1D%FF%FF%F2%85%93x%9B%89(%06%3Df%85%AB%BE%94%9Av9o%90ESI%1A%3CY%5C~%88%DA%C8%7Dn_%1F%FD%FD%FDW%8C%AD%90%7C%1B%D4%DC%E2%F0%F3%F2%5Dol%9B%B6%C8%CB%BB_a%94%AF%109O%18Mz%D1%DB%E0%F1%F4%F4F%7C%A1%8Ay%22%5C%93%B4%C3%D3%DE%B9%CC%D7%2B%5B~%FF%FF%FF%2Ci%E4%C9%00%00%00%ACtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%05%95%15%B1%00%00%00%DDIDATx%DAbX%8D%06%18%40%84%9EU%9EJ!%AF%08L%20%A8x%F9%A4%DE%CA%F0%F2x%D1%40%88%00%8F%C6%AA%D2%EAH%06%99%A9%ECR%B2%20%01%AE%A5r%EEi96%3D!n%C9%5D%06%E6%40%81%B0*%7DSA%87%88%60%A3%06Wi%BFh%A0%40%A3%A4%BD*%ABfwg%BD%F7D%16%1DK%A0%40%EB%A2%14%25Nu%B3Y%8E%ED5M%D9%1E%40%81%8E~Cg'%85e%7D%25%CD%BE%19%E9%09%40%81%99%8Cs%BD%2C%14%ED%E6%17%F0%8B%17%A9%85%02%05r%AD%A7%04%C8O%AB3%B1%15pa%9AP%0B%14%10%E6%D6%9E%1C%15%E7Y%C6%C1%2C%94%E5%CF%00r%98%18%9Bn%EA%F4%B6%8A%96%D8%98%C53%20~%91%D0%CA_%98%98%99%B4%60%B62%CCsKV%CC3%F6Y9%87%0F%EE%5Bd%00%10%60%00%0E%5Cp%E4%D3%A3%A3%DA%00%00%00%00IEND%AEB%60%82";
Images.health="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%01%FEPLTE%FD%FD%FD%FE%FE%FE%C7%DDn%D1%E4%8A%04%3Bo%04%3Do%BF%DEL%5C%87%98%D3%E3%8A%1F%3EE%D2%E3%8A%0F6L%00Ci%D2%E2%8A)%5E%80)Y%84O%84%A8%E9%F3%AE%DB%EB%81%05Hs%2Cl%94%EB%F4%AF%5E%91%AE%85%AA%BA%08Hy%BC%D5U%B3%D48%C4%DEn%FC%FC%FC%C4%DDp3j%95%E2%EB%9D%8D%B0%C8G%7F%9F%8D%AF%C3%40x%9D%E5%EB%F0%E7%EC%F0%DA%E2%E6(m%98%A7%BDH%03DtB%7C%A0%7B%A1%BB2e%91%FE%FE%FF%25N%5C%BA%C9%D2%AB%C3%D2%CF%E4k%DA%E8%9CJ%7B%91%DC%EA%A3%E3%E9%EE%AE%C4%D3%9C%B0sq%8B3(c%88~%962%22CC%A0%C0%CF%EF%F1%F1%03%3Epb%7F%2C%0B3U%AF%D0%2F1r%98%16S%7C0p%90%AC%C7%1B%BD%CF%DBq%93%911k%90%FC%FD%FE%FD%FE%FE%AD%C0J%40y%A6%B0%C1%AA%D4%E4%A1Rx%83%1CT%82%3Bw%9B%1E%60%8B%17X%87%00Bo%3FZF%EB%EE%EF%E1%E7%E9%00Cn%10Gs%3Ei~%D4%E5%8A%10Q%7F%95%B5%C8%20%5C%86M%83%A5%DA%E9%A4%B3%D332g%8C%B4%CA%D79S%20%C9%DCp6h%93F%7C%A6%E3%EC%F0%0B1%5D%A7%BD%A4%B9%CC%D5%DB%E7%9B%042b%A8%C2%D5%D7%DF%E5%F0%F3%F3%B1%C6%D3o%9A%B1Qk1GfF%BD%CC%D3W%7Bx%C8%D4%A1%94%B3%C7Clz%D2%DD%DE%CD%DB%E2%BB%D2%DD%5E%8D%AB%BA%CCm%F2%F4%F5%5C%80l%EA%F6%B3%BF%DFL%003%60b%91%AE%B9%C8%A7%13T%80%00.W%050W%D8%E9%A0%DA%E8%80%C1%D7jd%91%B0%E0%EF%9Er%9E%B8%F3%F5%F6%C8%D8%AC%FA%FB%FC%A2%BC%CC%1EY%81%1F%5D%8B%BA%D7Q%94%AA%855b%85%BB%D8S%D4%E4%8B%85%AA%BF%D1%DA%E0%E6%F8%AD.q%91%9B%BB%CD%12Q%8E%B2%C0%A4.i%90%DB%EA%A3%22X%7CB%60Y%D7%E4%B4%CF%E1m%D7%EA%9F%005%5E%FF%FF%FF5%C3%B26%00%00%00%AAtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%B5%09%C8%D5%00%00%00%DEIDATx%DAbX%89%06%18%40%84i%8D%B8X%91M%15%03T%C0%ABT%C0%25-Ig%A1%B2%99'D%20%5B%3D%80%2F%CEr%0A%FF%E2%B9y%13A%02%19Z%95%0BZ%D9%E7%1Bg%F9%FA%CBU%EB%02%05%E6M%2F%9F%23%B8%D4%7DB%A3%A8_%94%B6-P%20%BEL~%B9%D1%A2%04%93%9C%CE%DEi%1E%FA%40%01%9F%86.f.%8E%E8%99%CC%BCB%E6%93'%01%05%D2%F5%EA%0Ce%99R%99%A4%97u%2F%096%00%0A%D4%AE%08%D5h%9A*9%83%CD%BB%A4%5DQ%0D(P%18%D3%CCi%E1(%95he%9D%AB9%AB%1F(P%D0'%C1%D2Q%ECj%EF%C0%1A%12%18%CE%08r%98j%8F0Of%0A%B7%5D%84%D3l%06%88_T%94D%DA%22%9D%83Z%F2%19a%9E%ABw%8BU%A8H%0E%93%81%FB%16%19%00%04%18%00*%04nF%C9M%B7%E3%00%00%00%00IEND%AEB%60%82";
Images.percent="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%01%F5PLTE%FE%FE%FE%2C%99%0D%E0%EA%EE%E7%ED%F0%FC%FD%FE%E3%E8%E9%001%60%000b%3A%CC%06%A3%BF%D4%0DFu%089%60%3A%CC%05R%8B%ACF%7D%A3G~%A2%0BDo%07Fn1%AD%13-g%8F%04Dm1%AE%15%A4%C1%D5%1Dt%2C%04%40r%05Br1%AA%0B%0FU%7F%15T%7B%13Nv%12N%7D%14S%7F%8C%B2%C6S%8B%AC%13R2%17%5D%88%22x%18%13W7%1DU%7F%1CW%7C%F1%F4%F5%BE%D0%DA%05%40l%006%60%84%AA%BE%AF%C6%D5%18U%83%05Jf%00%1EM%A4%BC%CA%A6%BE%CD%15Hu6o%93%D7%E1%E4%13Iw%2C%99%13%1FW%82o%97%B1%1D%7C31%B2%18S%88%A8%06%3Fg6%BE%0F6p%93*%5C%84%1Df%0D%05%40YK%80%9E%3Bu%99%1EU%7C%0FVI%0ABt%3F%DD%07%96%B6%C9%E9%F0%F3%0A%3EE%07%3Dh%FD%FD%FD%F7%F9%FA%18U%0F%04%3FqV%86%A6%05Dc%C1%D1%DE%04%3Fsa%93%AC%14M%7B%09Dp%00!R%A4%C0%CF%11Er%A4%C0%CE%A3%C1%D5%07Bs%2C%99%0B%11Gs%10Gt%2Fh%8B%00%24Q%1C_%8A1%AA%08%8E%B2%C7%24U~%22w%131i%8DL%84%A6%A3%BF%D3H~%9F%22%8F1%08Eq%17T%865o%94%EC%EE%F10o%95%1Dp'%C9%D9%E1%FA%FB%FC%18S%7B%00%3El%2Ff%90%C6%D3%DA%91%AF%C3%05%3CU%C5%D4%DE%0CGu%22Rz%26e%8E%3A%CD%0Bn%99%B2%12V%80%1Dw-%2Fk%8Fk%99%B1%0AAmv%9F%B8%055R%E8%ED%F0%1CQv%004e1%AA%0Dr%9A%B0%0FUE%14Ks%C8%D6%DE.n%97%F3%F4%F5%00%3Ah%00%3Bi%14Mz%09Es6%BB%07%0FIk%2C%9F%19%0FZLt%9E%B9%1DS%7D%03ItD%EE%04%D2%DE%E3%0FPC6%BE%11%9A%BB%CD1%B0%18%22%86'%01%3Dj%13H%26%FF%FF%FF%E8%1B%F6*%00%00%00%A7tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00t%D5%D1%A8%00%00%00%DDIDATx%DAbX%86%06%18%40%04SdO%A8e4%13L%80E%8C7_8%B1%DCD1%86%05%22%C0i%EF%3A%BB6%CD%C1%A2%2F%23%AB%04%24%C0%CC%3F%DD%B8w%F1%CC%A9A9%DC%13%8A%19%80%02%0B%D5%E3%DB%E7%A6%DB%19X%5B%C5Ni%F3%02%0A%D8%84%99%A9Nsd4%17%2F%D3%93u%9E%07%14%C8%EC%2Cu%12%92JaT%D2%CFS%AB3%04%0A%F0%09%C8%E5%26%A9%C4%F1t%2F%0AIH6%02%0A%CC%12tg%2F%9A%B1%94%C3_t%92m%B6)P%20X%5E%BBiA%84%B7G%BD%9B%CF%1C%1D%0D%A0%40A%CB%92%F9U%12%01l%5D%5CZ.%AC%20k%9717%88Ln%AD%89%0A%97l%AE%F0%85%F8%A5%A3%B2%B0QZF9P%93%01%E6%B9%89%D5%9E%0A%A9%BA%FD~p%DF%22%03%80%00%03%00%09Ol%02dA%3Ad%00%00%00%00IEND%AEB%60%82";
Images.stamina="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%02%01PLTE%FD%FD%FE%FF%E2%01%03Ex%0DI%7C%1DV%7C%1DW%7F%B4%C9%D32m%96%1DR%8D%B5%CA%D3%15Nx%058m%0BEp%B9%CA%D2%25%5E%84M%84%A6%01%3Aq%FF%DB%01%F2%F4%F4%07G%7B%9E%BA%CA%17T%80%FB%FC%F6%F3%F3%F2%D1%DB%E0%EE%F2%F31q%9B%FF%FF%FFUh%89%FF%C7%00'Z%94%A7%88Q%1AQ%82%FF%DE%00%1AY%9A%99lD%F1%F5%F8%95nK%FD%DF%04%AA%C3%CF%FF%DD%02%5C_%94%E8%EE%F0%B2%C7%D3c%92%AE!%60%8B%B9%CF%DF%B9%94K%94%AD%C1%FF%DD%18%FB%FC%FC%FF%D6%1E%BE%D2%DCTEI%15Rx%CA%D6%DC%FF%EA%00%5DfnBEZ%9B%84_%AC%C4%D3%D2%DD%E2%13U%8D%8C%AE%C08a%8B%EC%A5%13%FC%DDA0T%7Ce%99%B4%25Fkn%97%B3%B8%91A%1C%60%9C%C5%7FI%E4%E8%E9%EA%B8*~%A4%B3%DA%AA%25%98r%5D%FC%FC%FB%0EQ%80%FF%E1%8BH%82%9EHm%99%FC%FE%FD%E5%AD%22%12O%7B%10Mu%EC%B0'%0EH%7C%B8%CA%D1%00Gx%0DEv7s%9C%1BQ%7CO%86%A5%FE%FE%FE%17Mv.q%97%EA%EF%F0%1DU%80%FD%DC%01Ri%82%A6%8DT%99%B7%C9%19X%89%02Ao%D6%962%18V%85%98d%2B%5B%8B%A7%8F%7Cit%9D%B9L%85%AD%C5%D1%D5%D7%9AB%FF%C9%04Pn~%E0%E9%EE%ED%B2%16k%9A%B7-j%8D%2CN%86n%5D%5E%81%A5%B86n%95%90g%3A%97%AA%BB%03%3Dl%FE%DF%0A%1FY%867o%97%FC%E9P!%5C%86%FC%D5%00-r%9A%DC%92%10%12T%92%FB%DFM%FF%DD%00N%88%AA%A0%C1%D2%E7%EC%EB%E4%A2%1F%A0%C0%CFdh%7D%FD%D5%5D%E5%B6%23%E7%ED%F0%E5%EB%ED%C7%D7%E1%FF%D8%04%0A6_%11Lv%FE%FE%FF%FF%D9%006Z%86f%96%B4%FD%FD%FD%F7%D4%AF%0EGo%FE%F1%92%20%5E%92CPa%17%5D%89P%87%A90m%96%FF%F9%C22q%935Mw%FF%FF%FFk%B2_%FF%00%00%00%ABtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%B7*%3Dl%00%00%00%DDIDATx%DAbX%85%06%18%40%C4T%BD%1A%1D%B7%09e0%01%06%DE%F8%DA%CA%D2%FC%E0%1E%1B%06%88%00g%3B%0B%DF%A29%D9%F29%2B%B4%8D%40%02%7DA%0B%14%9A%26jN%F6%AD%8Al%B6%9D%05%14%F0%11%E5%B2K%8B%F0ft%E70%0B%2FH%06%0A%2C%9D%C9%AAd%ADh%A1Q%2C%93%99%C8%1E%05%14(%8Ck%F5H%EFnT%9B%AE%2F%97%A2%2B%02%14%E0%E7%09%EB%F43nIe%0Cu%8EY%A2%0E%14%C8%CB%12%B6%F4%9C%B4%B0M%B0%7CeCR%11P%80-%40%40U%B6K%CCiv%BFk%B4%BD8P%40%A8%82%C9%CA%D10dyI%1Dw%AC%974%C8aZs%99M%3B%02%E7%E7%CE%902%9F%07%F1%CB%94%DEe%8B%95%AB%1D%5C%24%12%60%9ES%99%96Qo%60%22%E9%0F%F7-2%00%080%00syo%E7h%19%818%00%00%00%00IEND%AEB%60%82";
Images.lock="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTE%00%00%00%00%00%00%A5g%B9%CF%00%00%00%01tRNS%00%40%E6%D8f%00%00%00%0FIDATx%DAb%60%18%05%C8%00%20%C0%00%01%10%00%01%3BBBK%00%00%00%00IEND%AEB%60%82";Images.play="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%0FPLTE%A7%A7%A7%C8%C8%C8YYY%40%40%40%00%00%00%9F0%E7%C0%00%00%00%05tRNS%FF%FF%FF%FF%00%FB%B6%0ES%00%00%00%2BIDATx%DAb%60A%03%0CT%13%60fbD%13%60%86%0B%C1%05%60BH%02%CC%CC%0CxU%A0%99%81n%0BeN%07%080%00%03%EF%03%C6%E9%D4%E3)%00%00%00%00IEND%AEB%60%82";
Images.pause="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTE%40%40%40%00%00%00i%D8%B3%D7%00%00%00%02tRNS%FF%00%E5%B70J%00%00%00%1AIDATx%DAb%60D%03%0CT%13%60%60%80%60%3A%0BP%E6t%80%00%03%00%7B%1E%00%E5E%89X%9D%00%00%00%00IEND%AEB%60%82";Images.star_off="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0C%00%00%00%0C%08%03%00%00%00a%AB%AC%D5%00%00%00%96PLTE%E7%E8%E9%E7%E8%EA%F2%F3%F4%E4%E5%E6%DF%E0%E1%E1%E2%E3%DA%DB%DC%D2%D3%D4%D3%D4%D5%DE%DF%E0%F1%F2%F3%E8%E9%EB%D8%D9%DA%EF%F1%F2%EE%F0%F2%EB%ED%EF%EB%ED%EE%EA%EC%EE%F1%F3%F4%DF%E1%E1%E4%E6%E7%DB%DD%DD%E3%E4%E6%DA%DC%DD%EA%EB%ED%F0%F1%F2%E3%E4%E5%E2%E3%E4%EC%ED%EE%F5%F6%F8%F2%F3%F5%EC%EE%EF%DC%DE%DF%E4%E5%E7%EF%F0%F2%EA%EB%EC%F4%F5%F7%E7%E9%EA%F6%F7%F9%E6%E8%E9%DB%DD%DE%F3%F4%F6%EC%EE%EE%E0%E1%E2%ED%EE%EF%D4%D5%D6%F4%F5%F6%D5%D6%D7%F5%F6%F7%FF%FF%FFmf%FB%E3%00%00%002tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%0DP%98%EF%00%00%00vIDATx%DA%3C%8D%D9%16%820%0CD%C3NE%C5%05%10%DC%C0%05%94ni%FF%FF%E7%A0%C1%E3%7D%C8%E4%BE%CC%80ux%1E%05%B8%F3Vj%FC%CBC%88j%91%DB%B3%C6f%85%99%BC%0F%20%D25%03c%5Ea%9C%96%B0Ci%08%89%1C%2C%C7%EB%EFw%05%7D%ACgXAm%9FP%FB%BE%3E_H%A2%20P*%82%2F%C9)%E96%87c%82%24y%EB%06%B7%7Bk'%01%06%00%92%E5%14%B02%9F%07%C0%00%00%00%00IEND%AEB%60%82";
Images.star_on="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0C%00%00%00%0C%08%03%00%00%00a%AB%AC%D5%00%00%00%FCPLTE%FF%ECx%EC%E5%D8%C2%956%DB%C3%8F%C4%968%C3%96%3A%F6%E2w%E5%D7%BB%C9%9D%3B%C2%959%CC%A5U%D3%B6w%EA%E3%D3%EE%E7%DA%FD%EA%5D%EA%E0%CC%FE%EFc%DC%B6A%FF%E3K%C2%937%C5%9A%3A%D7%BD%85%FE%F3%95%E1%BA%3B%E9%E0%CB%E0%BDH%EF%D6l%EF%E9%DF%E7%CCd%E8%DF%C9%F4%DFq%D6%AC%3C%CD%A2%3D%FF%F1%8A%E3%C6%60%D8%BE%88%F5%F5%F5%D0%B0k%F2%F2%EE%FF%E2P%EB%CEN%EE%C8%3C%EF%EC%E3%C3%957%C4%98%3A%EC%E4%D4%CA%A3S%DD%C6%9B%EC%D3k%E0%CF%AB%FF%EE%60%D6%BA%80%DA%BF%87%F1%F0%EB%EA%E1%CF%CF%AA%5D%FF%E5O%E2%D1%AF%FA%E9%83%F5%DDj%E7%C3%40%E8%C5C%C4%959%ED%D3i%E4%D7%BC%F2%EF%E7%C4%977%FB%EC%87%E0%C1_%FF%EF%80%FF%F5%99%C2%969%DC%C8%9F%C5%978%F3%F0%EC%D9%C1%90%DA%C4%94%D3%B4t%BF%8E.%C5%997%FF%EC%5C%FF%DEB%FF%F7%A0%FF%FF%FFv%E6%2F%B2%00%00%00TtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00S%F7r%D1%00%00%00%83IDATx%DAb%08%06%01f%130%C5%00%22%1C%99%3C%A5%E1%1Ce%19%7B_0G%85%97%5D%9FE%CCM%C4%DB%92%DF%8BA%D5%DF%C5%C0*(%C8YJ%89C%8F%C1%CC%8E-((H%D1%95%C1ZG%96!X%97U%8EA%3D0PS%5B%02d%80%83B%A0%90E%A0%BC%07%D84C%C1%00%01%3E%23%5Bc0GT%5C%C3%C9%5D%D2%86%0B%CC1%F7%E3%D6R%F3%11%E6%04s%18%19A%16%9A%F2%04%07%03%04%18%001%8C%20dI%CC%B1%85%00%00%00%00IEND%AEB%60%82";
Images.timer="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0C%00%00%00%0C%08%03%00%00%00a%AB%AC%D5%00%00%00%06PLTE%22%22%22%FF%FF%FF%5E%87%201%00%00%00%02tRNS%FF%00%E5%B70J%00%00%00'IDATx%DAb%60D%02%0C%E8%1C%06%08%00s%C0%0C%08A%12%07%CC%83s%40%3C%04%07*%83b%0F%02%00%04%18%00%18%EF%00Jb%DAw%FF%00%00%00%00IEND%AEB%60%82";Images.timer_red="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0C%00%00%00%0C%08%03%00%00%00a%AB%AC%D5%00%00%00%06PLTE%CD%0A%0A%FF%FF%FF-%A2jr%00%00%00%02tRNS%FF%00%E5%B70J%00%00%00(IDATx%DAb%60D%02%0C%40%04%01%60%0E%98%01%E1%91%C4%01%93p%0E%88Bp%A02(%F6%A0%BA%00%01%00%02%0C%00%15%0D%00J%D9%85%06%E0%00%00%00%00IEND%AEB%60%82";
Images.potion_energy="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%01qPLTE%E4%E1%DE%0D%7B%FFM%94%FF%C4%D3%E1%EC%EC%EE%FB%FB%FA%02%99%FFQVa%00%9B%FC)r%FF%F7%F6%F6)p%FF%E9%EC%FF%FB%FA%FAttt%D4%E0%EB%00%7D%FF3%8D%E3%FA%F9%F9%07%7F%FD%20j%FF%5E%A2%D6DMR%AE%A3%9D%07Hr%3A%9A%ED%17%9E%E7q%93%C9%81%B7%D9%D7%E0%EB%F1%F1%F3%15i%FF%07%8F%FE%A4%C8%DDk%9C%CC%9A%B1%FF%F0%F0%F0%0D%98%DC%80~%7C%08%7C%FF%90%83r%5C%9C%CA%F3%F2%F0D%92%D2%06%95%FC%D1%CF%D9%0E%87%F9o%C9%F9%FD%FC%FC%9E%A0%A3%F5%F9%FD%C7%C0%B8d%60a%5D%84%AA%A1%B8%DDA%7F%CE%A0%A6%C3a%98%FEGHH%86%A2%BE%00%8F%FA%F5%F4%F2%F5%F5%F7%A8%A4%A2v%9D%FF%0Cz%FF%2Bs%FF%FA%FA%FA%00%B2%F8%02%96%FF%E7%EA%FFwwx%1D%94%E8%00%8E%FF*j%FF%AD%A3%96)%B1%F1%5D%BB%ED%0B%2Cl%F2%F1%F2%A1%90~r%AD%CAW%83%FF-%A1%F8%5D%A8%FA%BB%D0%E6%26%87%FC%D9%D4%CE%22%A8%F9e%8A%FF%12%9E%FF%05u%FF%19g%FF%13m%FFeq%87%20p%FF%03l%FFtfZ%3E%9E%E3%9C%C6%DF9w%FF)%C0%F4%17r%FF%D1%D2%DB%1Ey%B5%D4%E6%F9%00%85%FF%0Ep%FF%F4%F3%F1%8E%8E%91%23s%FF%0Do%FFY%BD%E4%8C%7Cl%BA%C8%FFG%86%FF%23%A0%EC%EC%ED%ED%20%BE%FF%00%8D%D24%8E%FF%00I%8A%FF%FF%FFC%9B%AE%8C%00%00%00%7BtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%93%C3%A8%EA%00%00%00%AAIDATx%DAb%A8%02%01%5E3si%7F0%AB%8A%01L%A6%FBITZ%20%0B%B0%B0%8B%C5%E9%22%0B%E4%F0%99%D83%20%0Bh%E5Z%A9%A1%08p%05f(%95%22%0B%08%15%B8%F8%A8%20%0B0%A7rD%24%3B%23%04B%F5%CB%D2%C2TeXa%02%FC!%15%0A%96L%C2%E5%8AP%01%03_%B6%84b%B7%A2%3C%1B)9%88%80Qp%96%7C%24%8F%B2%97%A3N%26D%C0NR%20%26%C8!%25%3E_O%16%22%10%60%EA%AA%EE%C4%C9-%E2%A9%5D%08%11%F0N%D4%8C%8A%8Ee%CC%16t%D7%80%DA%12.n%9D%E4Q%22jhl%0B%E4%00%04%18%00aI%5C8%B90%1DA%00%00%00%00IEND%AEB%60%82";
Images.potion_stamina="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%01tPLTE%FD%B0Q%FD%FB%F7%FD%FB%F6%FA%60%24%FA%F5%EC%FE%FA%E9%F5%DA%BB%F4%D8%BB%FD%B0R%EE%E5%D7%EC%E1%C9%FA%F8%F3%ED%E7%D8%FB%F8%F1%7B%80%83%F9%95I%FB%F4%E9%FD%FC%F8%FE%FE%FB%F2kG%FFu%2C%FD%97%3B%E9g6%FF%7C)%E8%83X%FE%90%3A%FF%8D0%91%8D%88%FA%7F7%FC%5D%40%F7%9E%84%D4%95%80%88%7Fd%F8%F1%E5%DB%8BS%CF%AD%90%804%1E%FE%861%DDP4%FB%E8%D9%D8%C6%9E%E7%8BT%FE%D0%8D%F7bG%B0%A4%94%FCq.%FD%D2%81%F6%F4%F2%FDm%22%F0%BC%98%F7%F0%E5%FFh(%FE%9E%40%F0%86g%D6%3F!%FF%ABL%FD%BEj%BC%5BC%FF%9E%3C%E6%AC%8A%A3%9A%87%A8%A3%9B%F3%E4%D5%FD%B0P%FA%F5%ED%FE%FB%E8%F9b%23%F3%90V%F6j%3D%F9%F5%EC%F9E%13%F4%89d%FD%A8J%94%91%91jhl%FE%8D7%FE%AEH%FFr8%96*%0E%FD%A8DwY0%97%83x%95%8Fx%B0%B4%B5%FC%C9t%FC%A5%40%CC%C6%BDmcb%FD%C1%7D%FE%EE%C6%BD%B4%A4%DC%D6%D0%D9%AAy%95%89w%F8%A9x%EAU-%EA%E2%C9%D4%9F%81%F0m%40%F8~G%D4%8Fl%DF%8D%5E%FD%8E.%E9%CB%A6%BD%AE%98%FD%B1k%FE%E5%AB%ED%BD%A0%FD%BB%5E%FE%FA%F7%F3%26%0F%E0%97p%FA%F6%EB%FD%B7Q%FC%5B%23%9E%8Cn%FD%FC%F7%FE%999%F9%7C%2F%7Csf%C1%91i%FD%95M%F8%E2%CC%FF%FF%FFgb%E8%EA%00%00%00%7CtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%01j%DA1%00%00%00%ABIDATx%DAb%A8%06%01%C6t%A5%18%160%AB%9A%01Lr%05%A8%F8i%20%0B(%96%87%07%26%20%0B8H%F3%05s%22%0B%B8%DAzy%F2%20%0B%F0%CA%5B%26%1A!%0B0%99%E6%09%0B%20%0B%B0i%BB%B9%18%96%20%04%D8%E5dM%F8%D5%AC%05a%02Uq%95%BA%11%99ef%D9P%01!%F7%A24%0B%C7Hs%A7%F8%02%88%40n%B2A%A8%1EkV%A17%B3%3AD%80%DBY%DC%3FD%2B%C7%A3T%C6%0E%22%60Sa%AC%CA%C1%60%EF%23%92%1A%04%11%D0QH%F1%95%B2%92%14%D5%2C%8E%85%DA%12%1D%A5%2C!%96%94%9F%11%A6%0F%E4%00%04%18%00%BA%F5%5D7%DF%1B%AE%5B%00%00%00%00IEND%AEB%60%82";
Images.beta="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTE%FF%FF%FFiii%92%95*%C3%00%00%00%01tRNS%00%40%E6%D8f%00%00%003IDATx%DAb%60%C0%00%8C%8C%E8%02%0C%8CD%A8%60D%16%05%B1%19%890%98%01%5D%1BV%7DX%04%181%EDG%B7%8C%91%90%2F0%0Df%60%00%080%00%15*%00%26%C7%CF%D9%E5%00%00%00%00IEND%AEB%60%82";Images.update="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%18PLTE%C7%C7%C7UUU%7B%7B%7B%BF%BF%BF%A6%A6%A6%FF%FF%FF%40%40%40%FF%FF%FFk5%D0%FB%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00UIDATx%DAt%8F%5B%12%800%08%03%23%8Fx%FF%1B%5B%C0%96%EA%E8~%95%9D%C0%A48_%E0S%A8p%20%3A%85%F1%C6Jh%3C%DD%FD%205E%E4%3D%18%5B)*%9E%82-%24W6Q%F3Cp%09%E1%A2%8E%A2%13%E8b)lVGU%C7%FF%E7v.%01%06%005%D6%06%07%F9%3B(%D0%00%00%00%00IEND%AEB%60%82";
var makeImage=function(d,e){return'<img class="g_image g_'+d+'" title="'+(typeof e!=="undefined"?e:ucfirst(d))+'" src="'+Images.blank+'">'};
function do_css(){$("head").append("<style type=\"text/css\">.red { background: #ffd3d3 !important; }.red:hover { background: #ffc0c0 !important; }.green { background: #e6ffe6 !important; }.green:hover { background: #d3ffd3 !important; }.golem-tooltip { display: none; position: absolute; top: 10000px; left: 10000px; min-width: 250px; z-index: 5; margin: 0; padding: 0; }.golem-tooltip > p { background: white; border: 1px solid #aaaaaa; margin: 0; padding: 5px; }.golem-tooltip > a { float: right; color: red; }.golem-config { position: static; width: 190px; padding: 4px; margin-bottom: 17px; overflow: hidden; overflow-y: auto; float: right; z-index: 10; }.golem-config > div { margin-top: 4px; }.golem-config #golem_fixed { float:right; margin:-2px; width:16px; height: 16px; background: url('data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%0FPLTE%DE%DE%DE%DD%DD%DDcccUUU%00%00%00%23%06%7B1%00%00%00%05tRNS%FF%FF%FF%FF%00%FB%B6%0ES%00%00%00.IDATx%DAb%60A%03%0Cd%0B03%81%18LH%02%10%80%2C%C0%84%24%00%96d%C2%A7%02%AB%19L%8C%A8%B6P%C3%E9%08%00%10%60%00%00z%03%C7%24%170%91%00%00%00%00IEND%AEB%60%82') no-repeat; }.golem-config-fixed { position: fixed; }.golem-config-fixed #golem_fixed { background: url('data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%0FPLTE%DE%DE%DE%DD%DD%DDcccUUU%00%00%00%23%06%7B1%00%00%00%05tRNS%FF%FF%FF%FF%00%FB%B6%0ES%00%00%005IDATx%DAb%60A%03%0C%C4%0901%83%00%13%92%0A%B0%00%0B)%02%8C%CCLLL%CC%0Cx%0CefF%E8%81%B9%83%19%DDa%84%05H%F0%1C%40%80%01%00%FE9%03%C7%D4%8CU%A3%00%00%00%00IEND%AEB%60%82') no-repeat; }#golem-dashboard { position: absolute; width: 600px; height: 185px; margin: 0; border-left: 1px solid black; border-right:1px solid black; overflow: hidden; background: white; z-index: 3; }#golem-dashboard thead th { cursor: pointer }#golem-dashboard thead th.golem-sort:after { content: '&darr;'; }#golem-dashboard thead th.golem-sort-reverse:after { content: '&uarr;'; }#golem-dashboard tbody tr:nth-child(odd) { background: #eeeeee; }#golem-dashboard tbody th { text-align: left; font-weight: normal; }#golem-dashboard td, #golem-dashboard th { margin: 2px; text-align: center; padding: 0 8px; }#golem-dashboard > div { height: 163px; overflow: hidden; overflow-y: scroll; border-top: 1px solid #d3d3d3; }#golem-dashboard > div > div { padding: 2px; }#golem-dashboard .golem-status { width: 100%; }#golem-dashboard .golem-status tbody th { text-align: right; padding: 2px; font-weight: bold; }#golem-dashboard .golem-status tbody td { text-align: left; }#golem-dashboard .overlay { position: absolute; left:10px; margin: 3px; color: white; text-shadow: black 0px 0px 2px; }table.golem-graph { height: 100px }table.golem-graph tbody th, table.golem-graph tbody td { border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }table.golem-graph tbody th { max-width: 75px; }table.golem-graph tbody th:first-child { text-align: right; border-left: 1px solid #dddddd; border-right: 1px solid #cccccc; }table.golem-graph tbody th:first-child div { line-height: 60px; height: 60px; }table.golem-graph tbody th:first-child div:first-child, table.golem-graph tbody th:first-child div:last-child { line-height: 20px; height: 20px; }table.golem-graph tbody th:last-child { text-align: left; border-right: 1px solid #dddddd; vertical-align: bottom; }table.golem-graph tbody th:last-child div { position: relative; height: 10px; margin: -10px 0 0; }table.golem-graph tbody th:last-child div:nth-last-child(1) { color: #ff0000; }table.golem-graph tbody th:last-child div:nth-last-child(2) { color: #0000ff; }table.golem-graph tbody th:last-child div:nth-last-child(3) { color: #00ffff; }table.golem-graph tbody th:last-child div:nth-last-child(4) { color: #aa00aa; }table.golem-graph tbody td { margin: 0; padding: 0 !important; vertical-align: bottom; width: 5px; border-right: 1px solid #dddddd; }table.golem-graph tbody td:nth-child(12n+1) { border-right: 1px solid #cccccc; }table.golem-graph tbody td div div { margin: 0; padding: 0; width: 5px; }table.golem-graph tbody td div.bars div:nth-last-child(1) { background: #00ff00; }table.golem-graph tbody td div.bars div:nth-last-child(2) { background: #00aa00; }table.golem-graph tbody td div.bars div:nth-last-child(3) { background: #ffff00; }table.golem-graph tbody td div.bars div:nth-last-child(4) { background: #ff00ff; }table.golem-graph tbody td div.goal div { position: relative; height: 1px; margin: -1px 0 0; }table.golem-graph tbody td div.goal div:nth-last-child(1) { background: #ff0000; }table.golem-graph tbody td div.goal div:nth-last-child(2) { background: #0000ff; }table.golem-graph tbody td div.goal div:nth-last-child(3) { background: #00ffff; }table.golem-graph tbody td div.goal div:nth-last-child(4) { background: #aa00aa; }.golem-button, .golem-button-active { border: 1px solid #d3d3d3; background: #e6e6e6 url(http://cloutman.com/css/base/images/ui-bg_glass_75_e6e6e6_1x400.png) 50% 50% repeat-x; display: inline-block; cursor: pointer; margin-left: 1px; margin-right: 1px; font-weight: normal; font-size: 13px; color: #555555; padding: 2px 2px 2px 2px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; }.golem-button:hover, .golem-button-active { border: 1px solid #aaaaaa; background: #dadada url(http://cloutman.com/css/base/images/ui-bg_glass_75_dadada_1x400.png) 50% 50% repeat-x; }img.golem-button, img.golem-button-active { margin-bottom: -2px }.golem-tab-header { position: relative; top: 1px; border: 1px solid #d3d3d3; display: inline-block; cursor: pointer; margin-left: 1px; margin-right: 1px; background: #e6e6e6 url(http://cloutman.com/css/base/images/ui-bg_glass_75_e6e6e6_1x400.png) 50% 50% repeat-x; font-weight: normal; color: #555555; padding: 2px 2px 1px 2px; -moz-border-radius-topleft: 3px; -webkit-border-top-left-radius: 3px; border-top-left-radius: 3px; -moz-border-radius-topright: 3px; -webkit-border-top-right-radius: 3px; border-top-right-radius: 3px; }.golem-tab-header-active { border: 1px solid #aaaaaa; border-bottom: 0 !important; padding: 2px; background: #dadada url(http://cloutman.com/css/base/images/ui-bg_glass_75_dadada_1x400.png) 50% 50% repeat-x; }.golem-title { padding: 4px; margin: -4px -4px 0 -4px !important; overflow: hidden; border-bottom: 1px solid #aaaaaa; background: #cccccc url(http://cloutman.com/css/base/images/ui-bg_highlight-soft_75_cccccc_1x100.png) 50% 50% repeat-x; color: #222222; font-weight: bold; }.golem-panel > .golem-panel-header, .golem-panel > * > .golem-panel-header { border: 1px solid #d3d3d3; cursor: pointer; margin-top: 1px; width: 184px; background: #e6e6e6 url(http://cloutman.com/css/base/images/ui-bg_glass_75_e6e6e6_1x400.png) 50% 50% repeat-x; font-weight: normal; color: #555555; padding: 2px 2px 2px 2px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; }.golem-panel-header input { float: right; margin: 2px; }.golem-panel > .golem-panel-content, .golem-panel > * > .golem-panel-content { border: 1px solid #aaaaaa; border-top: 0 !important; padding: 2px 6px; background: #ffffff url(http://cloutman.com/css/base/images/ui-bg_glass_65_ffffff_1x400.png) 50% 50% repeat-x; font-weight: normal; color: #212121; display: none; -moz-border-radius-bottomleft: 3px; -webkit-border-bottom-left-radius: 3px; border-bottom-left-radius: 3px; -moz-border-radius-bottomright: 3px; -webkit-border-bottom-right-radius: 3px; border-bottom-right-radius: 3px; }.golem-panel-show > .golem-panel-header, .golem-panel-show > * > .golem-panel-header { border: 1px solid #aaaaaa; border-bottom: 0 !important; background: #dadada url(http://cloutman.com/css/base/images/ui-bg_glass_75_dadada_1x400.png) 50% 50% repeat-x; -moz-border-radius-bottomleft: 0 !important; -webkit-border-bottom-left-radius: 0 !important; border-bottom-left-radius: 0 !important; -moz-border-radius-bottomright: 0 !important; -webkit-border-bottom-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }.golem-panel-show > .golem-panel-content, .golem-panel-show > * > .golem-panel-content { display: block; }.golem-panel-sortable .golem-lock { display: none; }.golem-panel-content br:last-child { clear: both; }.golem-panel .golem-panel-header .golem-icon { float: left; width: 16px; height: 16px; background: url('data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTEUUU%00%00%00%F5%04%9F%A0%00%00%00%02tRNS%FF%00%E5%B70J%00%00%00%22IDATx%DAb%60D%03%0C%D4%13%60%C0%10%60%C0%10%60%C0%10%60%20%A4%82%90-%149%1D%20%C0%00%81%0E%00%F1%DE%25%95%BE%00%00%00%00IEND%AEB%60%82') no-repeat; }.golem-panel .golem-panel-header .golem-lock { float: right; width: 16px; height: 16px; background: url('data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTEUUU%00%00%00%F5%04%9F%A0%00%00%00%02tRNS%FF%00%E5%B70J%00%00%001IDATx%DAb%60D%03%0CD%0B000%A0%0800%C0D%E0%02%8C(%02%0C%0Cp%25%B8%05%18%09%0A%A0j%C1%B4%96%1C%BF%C0%01%40%80%01%00n%11%00%CF%7D%2Bk%9B%00%00%00%00IEND%AEB%60%82') no-repeat;}.golem-panel-show .golem-panel-header .golem-icon { float: left; width: 16px; height: 16px; background: url('data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%06PLTEUUU%00%00%00%F5%04%9F%A0%00%00%00%02tRNS%FF%00%E5%B70J%00%00%00%22IDATx%DAb%60D%03%0C4%13%60%80%00%24%15%08%3EL%0B%9C%CF%88N%D3%D0a%C8%00%20%C0%00%7F%DE%00%F1%CCc%A6b%00%00%00%00IEND%AEB%60%82') no-repeat; }.golem-info { text-align: center; display: block; }img.g_image { width: 16px; height: 16px; margin-bottom: -4px; }img.g_energy { background: url(\""+Images.energy+
'") no-repeat; }img.g_exp { background: url("'+Images.exp+'") no-repeat; }img.g_gold { background: url("'+Images.gold+'") no-repeat; }img.g_health { background: url("'+Images.health+'") no-repeat; }img.g_percent { background: url("'+Images.percent+'") no-repeat; }img.g_stamina { background: url("'+Images.stamina+'") no-repeat; }img.g_potion_stamina { background: url("'+Images.potion_stamina+'") no-repeat; }img.g_potion_energy { background: url("'+Images.potion_energy+'") no-repeat; }</style>')}
c=String.prototype;c.trim=function(){return this.replace(/^\s+|\s+$/g,"")};c.filepart=function(){var d=this.lastIndexOf("/");if(d>=0)return this.substr(d+1);return this};c.pathpart=function(){var d=this.lastIndexOf("/");if(d>=0)return this.substr(0,d+1);return this};c.regex=function(d){d=this.match(d);var e;if(d){d.shift();for(e=0;e<d.length;e++)if(d[e]&&d[e].search(/^[-+]?[0-9]*\.?[0-9]*$/)>=0)d[e]=parseFloat(d[e]);if(d.length===1)return d[0]}return d};c.toNumber=function(){return parseFloat(this)};
c.parseTimer=function(){var d=this.split(":"),e=0,f;for(f=0;f<d.length;f++)e=e*60+parseInt(d[f],10);if(isNaN(e))e=9999;return e};Number.prototype.round=function(d){return result=Math.round(this*Math.pow(10,d||0))/Math.pow(10,d||0)};Math.range=function(d,e,f){return Math.max(d,Math.min(e,f))};
var makeTimer=function(d){var e=Math.floor(d/3600),f=Math.floor(d/60)%60;d=Math.floor(d%60);return(e?e+":"+(f>9?f:"0"+f):f)+":"+(d>9?d:"0"+d)},WorkerByName=function(d){if(typeof d==="string"){d=d.toLowerCase();for(var e in Workers)if(e.toLowerCase()===d)return Workers[e]}return null},WorkerById=function(d){for(var e in Workers)if(Workers[e].id===d)return Workers[e];return null},Divisor=function(d){var e=d,f=1;if(e<20)return 1;for(;e>100;){e/=10;f*=10}if(d/f>40)f*=5;else if(d/f>20)f*=2.5;return f},
length=function(d){if(isArray(d))return d.length;else if(typeof d==="object"){var e=0,f;for(f in d)e++;return e}return 0},unique=function(d){var e={},f,h=d.length,g=[];for(f=0;f<h;f++)e[d[f]]=d[f];for(f in e)g.push(e[f]);return g},deleteElement=function(d,e){if(isArray(d))for(;e in d;)d.splice(d.indexOf(e),1)},sum=function(d){var e,f=0;if(isArray(d))for(e=0;e<d.length;e++)f+=sum(d[e]||0);else if(typeof d==="object")for(e in d)f+=sum(d[e]);else if(typeof d==="number")f=d;else if(typeof d==="string"&&
d.search(/^[-+]?[0-9]*\.?[0-9]*$/)>=0)f=parseFloat(d);return f},addCommas=function(d){d=d?d.toString():"0";for(var e=/(-?[0-9]+)([0-9]{3})/;e.test(d);)d=d.replace(e,"$1,$2");return d},findInArray=function(d,e){if(isArray(d))for(var f=0;f<d.length;f++)if(d[f]===e)return true;return false},findInObject=function(d,e){if(isObject(d))for(var f in d)if(d[f]==e)return f;return null},objectIndex=function(d,e){if(typeof d==="object")for(var f in d)if(e--<=0)return f;return null},arrayIndexOf=function(d,e){if(isArray(d))for(var f=
0;f<d.length;f++)if(d[f]===e)return f;return-1},arrayLastIndexOf=function(d,e){if(isArray(d))for(var f=d.length-1;f>=0;f--)if(d[f]===e)return f;return-1},sortObject=function(d,e,f){var h=[],g={};if(typeof f==="undefined")f=false;for(i in d)h.push(i);e?h.sort(e):h.sort();for(i=0;i<h.length;i++)g[h[i]]=f&&typeof d[h[i]]==="object"?sortObject(d[h[i]],e,f):d[h[i]];return g},getAttDefList=[],getAttDef=function(d,e,f,h,g){var k=[],l=0,m=0,q=f==="att"?"def":"att",o;if(e)for(o in d)e(k,o,d);else k=getAttDefList;
k.sort(function(n,s){return d[s][f]+0.7*d[s][q]-(d[n][f]+0.7*d[n][q])});for(o=0;o<k.length;o++){e=typeof d[k[o]].own==="number"?d[k[o]].own:1;if(g)if(Math.min(h,e)>0){if(!d[k[o]].use)d[k[o]].use={};d[k[o]].use[g+"_"+f]=Math.min(h,e)}else if(length(d[k[o]].use)){delete d[k[o]].use[g+"_"+f];length(d[k[o]].use)||delete d[k[o]].use}e=Math.min(h,e);l+=e*d[k[o]].att;m+=e*d[k[o]].def;h-=e}getAttDefList=k;return(f==="att"?l:0.7*l)+(f==="def"?m:0.7*m)},tr=function(d,e,f){d.push("<tr"+(f?" "+f:"")+">"+(e||
"")+"</tr>")},th=function(d,e,f){d.push("<th"+(f?" "+f:"")+">"+(e||"")+"</th>")},td=function(d,e,f){d.push("<td"+(f?" "+f:"")+">"+(e||"")+"</td>")},isArray=function(d){return d&&typeof d==="object"&&!d.propertyIsEnumerable("length")&&typeof d.length==="number"},isObject=function(d){return d&&typeof d==="object"&&(!("length"in d)||d.propertyIsEnumerable("length"))},isFunction=function(d){return typeof d==="function"},isNumber=function(d){return typeof d==="number"},isString=function(d){return typeof d===
"string"},isWorker=function(d){try{return Workers[d.name]===d}catch(e){return false}},plural=function(d){return d===1?"":"s"},makeTime=function(d,e){return(new Date(d)).format(typeof e!=="undefined"&&e?e:"l g:i a")};Date.prototype.format=function(d){for(var e="",f=Date.replaceChars,h=0;h<d.length;h++){var g=d.charAt(h);e+=f[g]?f[g].call(this):g}return e};
Date.replaceChars={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.replaceChars.shortDays[this.getDay()]},j:function(){return this.getDate()},
l:function(){return Date.replaceChars.longDays[this.getDay()]},N:function(){return this.getDay()+1},S:function(){return this.getDate()%10==1&&this.getDate()!=11?"st":this.getDate()%10==2&&this.getDate()!=12?"nd":this.getDate()%10==3&&this.getDate()!=13?"rd":"th"},w:function(){return this.getDay()},z:function(){return"Not Yet Supported"},W:function(){return"Not Yet Supported"},F:function(){return Date.replaceChars.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+
1)},M:function(){return Date.replaceChars.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){return"Not Yet Supported"},L:function(){return this.getFullYear()%4==0&&this.getFullYear()%100!=0||this.getFullYear()%400==0?"1":"0"},o:function(){return"Not Supported"},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return"Not Yet Supported"},
g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},e:function(){return"Not Yet Supported"},I:function(){return"Not Supported"},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/
60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":"+(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60)},T:function(){var d=this.getMonth();this.setMonth(0);var e=this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");this.setMonth(d);return e},Z:function(){return-this.getTimezoneOffset()*60},c:function(){return this.format("Y-m-d")+
"T"+this.format("H:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1E3}};var ucfirst=function(d){return d.charAt(0).toUpperCase()+d.substr(1)},ucwords=function(d){return(d+"").replace(/^(.)|\s(.)/g,function(e){return e.toUpperCase()})},Workers={},WorkerStack=[];
if(isGreasemonkey)var setItem=function(d,e){GM_setValue(d,e)},getItem=function(d){return GM_getValue(d)};else{setItem=function(d,e){localStorage.setItem("golem."+APP+"."+d,e)};getItem=function(d){return localStorage.getItem("golem."+APP+"."+d)}}
function Worker(d,e,f){Workers[d]=this;this.id="golem_panel_"+d.toLowerCase().replace(/[^0-9a-z]/g,"-");this.name=d;this.pages=e;this.defaults={};this.settings=f||{};this.data={};this.option={};this.update=this.work=this.parse=this.init=this.display=this.runtime=null;this.get=function(h,g){return this._get(h,g)};this.set=function(h,g){return this._set(h,g)};this._rootpath=true;this._loaded=false;this._working={data:false,option:false,runtime:false,update:false};this._changed=Date.now();this._watching=
[]}c=Worker.prototype;c._flush=function(){WorkerStack.push(this);this._save();this.settings.keep||delete this.data;WorkerStack.pop()};
c._get=function(d,e){var f=typeof d==="string"?d.split("."):typeof d==="object"?d:[],h;if(!f.length||f[0]!=="data"&&f[0]!=="option"&&f[0]!=="runtime")f.unshift("data");if(f[0]==="data"){!this._loaded&&this._init();this._unflush()}h=this[f.shift()];try{return function(k,l){if(l.length){var m=l.shift();return arguments.callee(k[m],l)}else return typeof k!=="undefined"?k:e}(h,f)}catch(g){if(typeof e==="undefined")debug(g.name+" in "+this.name+".get("+d.toString()+", "+(typeof e==="undefined"?"undefined":
e)+"): "+g.message)}return typeof e!=="undefined"?e:null};c._init=function(){if(!this._loaded){WorkerStack.push(this);this._loaded=true;try{this.init&&this.init()}catch(d){debug(d.name+" in "+this.name+".init(): "+d.message)}WorkerStack.pop()}};
c._load=function(d){if(d!=="data"&&d!=="option"&&d!=="runtime"){this._load("data");this._load("option");this._load("runtime")}else{WorkerStack.push(this);var e=getItem((this._rootpath?userID+".":"")+d+"."+this.name);if(e){try{e=JSON.parse(e)}catch(f){debug(this.name+"._load("+d+"): Not JSON data, should only appear once for each type...");e=eval(e)}this[d]=$.extend(true,{},this[d],e)}WorkerStack.pop()}};
c._parse=function(d){WorkerStack.push(this);var e=false;try{e=this.parse&&this.parse(d)}catch(f){debug(f.name+" in "+this.name+".parse("+d+"): "+f.message)}WorkerStack.pop();return e};c._revive=function(d){var e=this;return window.setInterval(function(){e._update("reminder",null)},d*1E3)};c._remind=function(d){var e=this;window.setTimeout(function(){e._update("reminder",null)},d*1E3)};
c._save=function(d){if(d!=="data"&&d!=="option"&&d!=="runtime")return this._save("data")+this._save("option")+this._save("runtime");if(typeof this[d]==="undefined"||!this[d]||this._working[d])return false;var e=(this._rootpath?userID+".":"")+d+"."+this.name,f=JSON.stringify(this[d]);if(getItem(e)==="undefined"||getItem(e)!==f){WorkerStack.push(this);this._working[d]=true;this._changed=Date.now();this._update(d,null);setItem(e,f);this._working[d]=false;WorkerStack.pop();return true}return false};
c._set=function(d,e){var f=typeof d==="string"?d.split("."):typeof d==="object"?d:[],h;if(!f.length||f[0]!=="data"&&f[0]!=="option"&&f[0]!=="runtime")f.unshift("data");if(f[0]==="data"){!this._loaded&&this._init();this._unflush()}h=this[f.shift()];try{f.length&&function(k,l){var m=l.shift();if(l.length){if(typeof k[m]!=="object")k[m]={};if(!arguments.callee(k[m],l)&&!length(k[m])){delete k[m];return false}}else if(typeof e==="undefined"){delete k[m];return false}else k[m]=e;return true}(h,f)}catch(g){debug(g.name+
" in "+this.name+".set("+d+", "+(typeof e==="undefined"?"undefined":e)+"): "+g.message)}return e};c._setup=function(){WorkerStack.push(this);if((!this.settings.gm_only||isGreasemonkey)&&(this.settings.system||!length(this.defaults)||this.defaults[APP])){if(this.defaults[APP])for(var d in this.defaults[APP])this[d]=this.defaults[APP][d];this._load()}else delete Workers[this.name];WorkerStack.pop()};
c._unflush=function(){WorkerStack.push(this);!this._loaded&&this._init();!this.settings.keep&&!this.data&&this._load("data");"Caap"in Workers&&typeof this.caap_load=="function"&&this.caap_load();WorkerStack.pop()};c._unwatch=function(d){if(typeof d==="string")d=WorkerByName(d);isWorker(d)&&deleteElement(d._watching,this)};
c._update=function(d,e){if(this._loaded&&(this.update||this._watching.length)){WorkerStack.push(this);var f=false;this._working.update=true;if(typeof e==="undefined")e=null;if(typeof this.data==="undefined"){f=true;this._unflush()}try{this.update&&this.update(d,e)}catch(h){debug(h.name+" in "+this.name+".update("+(d?d:"null")+", "+(e?e.name:"null")+"): "+h.message)}if(!e)for(e=0;e<this._watching.length;e++)this._watching[e]._update(d,this);f&&this._flush();this._working.update=false;WorkerStack.pop()}};
c._watch=function(d){if(typeof d==="string")d=WorkerByName(d);isWorker(d)&&!findInArray(d._watching,this)&&d._watching.push(this)};c._work=function(d){WorkerStack.push(this);var e=false;try{e=this.work&&this.work(d)}catch(f){debug(f.name+" in "+this.name+".work("+d+"): "+f.message)}WorkerStack.pop();return e};var Army=new Worker("Army");Army.data={};Army.settings={system:true,advanced:true};Army.option={forget:14};Army.runtime={update:{},sort:0,rev:false,show:"Name",info:"uid"};
Army.update=function(d,e){if(d==="data"&&!e)for(var f in this.runtime.update){Workers[f]._update(d,this);delete this.runtime.update[f]}};
Army.init=function(){$("#content").append('<div id="golem-army-tooltip" class="golem-tooltip"><a>&nbsp;x&nbsp;</a><p></p></div>');$("#golem-army-tooltip > a").click(function(){$("#golem-army-tooltip").hide()});$('#golem-army-tooltip a[href*="keep.php"]').live("click",function(){Page.to("keep_stats",$(this).attr("href").substr($(this).attr("href").indexOf("?")));return false});for(var d in this.data)typeof d==="string"&&d.regex(/[^0-9]/g)&&delete this.data[d]};
Army.set=function(d,e){d=typeof d==="string"?d.split("."):typeof d==="object"?d:[];var f=null,h=null;if(d[0]==="option"||d[0]==="runtime")return this._set(d,e);f=isWorker(d[0])?d.shift().name:typeof d[0]==="string"&&d[0].regex(/[^0-9]/gi)?d.shift():WorkerStack.length?WorkerStack[WorkerStack.length-1].name:null;if(d.length&&typeof d[0]==="string"&&!d[0].regex(/[^0-9]/gi))h=d.shift();if(f&&h){if(f in Workers&&!f in this.runtime.update)this.runtime.update[f]=true;d.unshift("data",h,f);return this._set(d,
e)}};
Army.get=function(d,e){var f;d=typeof d==="string"?d.split("."):typeof d==="object"?d:[];var h=null,g=null,k=[];if(d[0]==="option"||d[0]==="runtime")return this._get(d,e);if((h=isWorker(d[0])?d.shift().name:typeof d[0]==="string"&&d[0].regex(/[^0-9]/gi)?d.shift():WorkerStack.length?WorkerStack[WorkerStack.length-1].name:null)&&d.length===0){this._unflush();for(f in this.data)h in this.data[f]&&k.push(f);return k}if(d.length&&typeof d[0]==="string"&&!d[0].regex(/[^0-9]/gi))g=d.shift();if(h&&g){d.unshift("data",g,
h);return this._get(d,e)}};Army.infolist={UserID:"uid",Level:"level",Army:"army"};
Army.sectionlist={Name:{key:"_info",name:"Name",label:function(d,e){return typeof d[e]._info.name!=="undefined"?d[e]._info.name:""},sort:function(d,e){return typeof d[e]._info.name!=="undefined"?d[e]._info.name:null},tooltip:function(d,e){return $('<a href="http://apps.facebook.com/castle_age/keep.php?user='+e+'">Visit Keep</a><hr><b>'+e+":</b> {<br>"+function(f,h){var g,k="";for(g in f){k=k+h+(isArray(f)?"":"<b>"+g+":</b> ");if(isArray(f[g]))k=k+"[<br>"+arguments.callee(f[g],h+"&nbsp;&nbsp;&nbsp;").replace(/,<br>$/,
"<br>")+h+"]";else if(typeof f[g]==="object")k=k+"{<br>"+arguments.callee(f[g],h+"&nbsp;&nbsp;&nbsp;").replace(/,<br>$/,"<br>")+h+"}";else if(typeof f[g]==="string")k=k+'"'+f[g]+'"';else k+=f[g];k+=",<br>"}return k}(d[e],"&nbsp;&nbsp;&nbsp;").replace(/,<br>$/,"<br>")+"}<br>")}},Info:{key:"_info",name:function(){return"Info ("+(findInObject(Army.infolist,Army.runtime.info)||"")+")"},show:"Info",label:function(d,e){return Army.runtime.info==="uid"?e:typeof d[e]._info[Army.runtime.info]!=="undefined"?
d[e]._info[Army.runtime.info]:""},sort:function(d,e){return Army.runtime.info==="uid"?e:typeof d[e]._info[Army.runtime.info]!=="undefined"?d[e]._info[Army.runtime.info]:null}}};Army.section=function(d,e){this.sectionlist[d]=e};Army.getSection=function(d,e,f){try{if(isNumber(d))d=objectIndex(this.sectionlist,d);switch(typeof this.sectionlist[d][e]){case "string":return this.sectionlist[d][e];case "function":return this.sectionlist[d][e](this.data,f);default:return""}}catch(h){}return""};
Army.order=[];
Army.dashboard=function(d,e){var f,h,g,k=this.runtime.show,l=this.runtime.info,m=[],q=[],o=[],n=[];if($("#golem-army-show").length)k=$("#golem-army-show").attr("value");if($("#golem-army-info").length)l=$("#golem-army-info").attr("value");if(typeof d==="undefined"||this.runtime.show!==k||this.runtime.info!==l){this.runtime.show=k;this.runtime.info=l;this.order=[];g=this.getSection(k,"key");for(f in this.data)try{(h=this.getSection(k,"sort",f))&&this.order.push(f)}catch(s){}}for(f in this.sectionlist){th(q,this.getSection(f,
"name"));if((g=this.getSection(f,"show"))&&g!=="")o.push('<option value="'+f+'"'+(f==k?" selected":"")+">"+g+"</option>")}for(f in this.infolist)n.push('<option value="'+(this.infolist[f]||"")+'"'+(this.infolist[f]==l?" selected":"")+">"+f+"</option>");m.push('Limit entries to <select id="golem-army-show">'+o.join("")+'</select> ... Info: <select id="golem-army-info">'+n.join("")+"</select>");if(d!==this.runtime.sort||e!==this.runtime.rev){this.runtime.sort=d=typeof d!=="undefined"?d:this.runtime.sort||
0;this.runtime.rev=e=typeof e!=="undefined"?e:this.runtime.rev||false;this.order.sort(function(r,u){var t=0,v=0;try{t=Army.getSection(d,"sort",r)}catch(y){}try{v=Army.getSection(d,"sort",u)}catch(w){}if(typeof t==="string"||typeof v==="string")return e?(v||"")>(t||""):(v||"")<(t||"");return e?(t||0)-(v||0):(v||0)-(t||0)})}m.push('<table cellspacing="0" style="width:100%"><thead><tr>'+q.join("")+"</tr></thead><tbody>");for(h=0;h<this.order.length;h++){q=[];for(f in this.sectionlist)try{g=this.getSection(f,
"label",this.order[h]);if(typeof g!=="undefined"&&g!==null&&g!=="")this.sectionlist[f].tooltip||this.sectionlist[f].click?td(q,"<a>"+g+"</a>"):td(q,g);else td(q,"")}catch(p){debug(p.name+" in Army.dashboard(): "+f+'("label"): '+p.message);td(q,"")}tr(m,q.join(""))}m.push("</tbody></table>");$("#golem-dashboard-Army").html(m.join(""));$("#golem-dashboard-Army td:first-child,#golem-dashboard-Army th:first-child").css("text-align","left");$("#golem-dashboard-Army select").change(function(){Army._unflush();
Army.dashboard()});$("#golem-dashboard-Army thead th:eq("+d+")").attr("name",e?"reverse":"sort").append("&nbsp;"+(e?"&uarr;":"&darr;"));$("#golem-dashboard-Army td a").click(function(r){r.stopPropagation();var u,t,v;r=$(this.wrappedJSObject?this.wrappedJSObject:this);try{u=objectIndex(Army.sectionlist,r.closest("td").index());t=Army.order[r.closest("tr").index()];Army._unflush();if("click"in Army.sectionlist[u])Army.getSection(u,"click",t)&&r.html("<a>"+Army.getSection(u,"label",t)+"</a>");else if((v=
Army.getSection(u,"tooltip",t))&&v!==""){$("#golem-army-tooltip > p").html(v);$("#golem-army-tooltip").css({top:r.offset().top+r.height(),left:r.closest("td").offset().left}).show()}}catch(y){debug(y.name+" in Army.dashboard(): "+Army.getSection(r.closest("td").index(),"name")+'(data,"tooltip"): '+y.message)}return false})};var Config=new Worker("Config");Config.settings={system:true,keep:true};Config.option={display:"block",fixed:true,advanced:false,exploit:false};
Config.init=function(){if("Caap"in Workers)return false;$("head").append('<link rel="stylesheet" href="http://cloutman.com/css/base/jquery-ui.css" type="text/css" />');var d,e,f;e=$('<div id="golem_config_frame" class="golem-config ui-widget-content'+(Config.option.fixed?" golem-config-fixed":"")+'" style="display:none;"><div class="golem-title">Castle Age Golem '+(isRelease?"v"+VERSION:"r"+revision)+'<img id="golem_fixed"></div><div id="golem_buttons"><img class="golem-button'+(Config.option.display===
"block"?"-active":"")+'" id="golem_options" src="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%0FPLTE%E2%E2%E2%8A%8A%8A%AC%AC%AC%FF%FF%FFUUU%1C%CB%CE%D3%00%00%00%04tRNS%FF%FF%FF%00%40*%A9%F4%00%00%00%3DIDATx%DA%A4%8FA%0E%00%40%04%03%A9%FE%FF%CDK%D2%B0%BBW%BD%CD%94%08%8B%2F%B6%10N%BE%A2%18%97%00%09pDr%A5%85%B8W%8A%911%09%A8%EC%2B%8CaM%60%F5%CB%11%60%00%9C%F0%03%07%F6%BC%1D%2C%00%00%00%00IEND%AEB%60%82"></div><div style="display:'+Config.option.display+
';"><div id="golem_config" style="overflow:hidden;overflow-y:auto;"></div><div style="text-align:right;"><label>Advanced <input type="checkbox" id="golem-config-advanced"'+(Config.option.advanced?" checked":"")+"></label></div></div></div>");$("div.UIStandardFrame_Content").after(e);$("#golem_options").click(function(){$(this).toggleClass("golem-button golem-button-active");Config.option.display=Config.option.display==="block"?"none":"block";$("#golem_config").parent().toggle("blind");Config._save("option")});
$("#golem_fixed").click(function(){Config.option.fixed^=true;$(this).closest(".golem-config").toggleClass("golem-config-fixed");Config._save("option")});for(d in Workers)Config.makePanel(Workers[d],Workers[d].display);$(".golem-config .golem-panel > h3").click(function(){if($(this).parent().hasClass("golem-panel-show"))$(this).next().hide("blind",function(){$(this).parent().toggleClass("golem-panel-show");Config.option.active=[];$(".golem-panel-show").each(function(){Config.option.active.push($(this).attr("id"))});
Config._save("option")});else{$(this).parent().toggleClass("golem-panel-show");$(this).next().show("blind");Config.option.active=[];$(".golem-panel-show").each(function(){Config.option.active.push($(this).attr("id"))});Config._save("option")}});$("#golem_config").sortable({axis:"y"}).children(".golem-panel-sortable").draggable({connectToSortable:"#golem_config",axis:"y",distance:5,scroll:false,handle:"h3",helper:"clone",opacity:0.75,zIndex:100,refreshPositions:true,stop:function(){Config.updateOptions()}}).droppable({tolerance:"pointer",
over:function(h,g){var k=Config.getOrder(),l=WorkerByName($(g.draggable).attr("name")),m=arrayIndexOf(k,$(this).attr("name"));if(arrayIndexOf(k,"Idle")>=m){if(l.settings.before)for(h=0;h<l.settings.before.length;h++)if(arrayIndexOf(k,l.settings.before[h])<=m)return;if(l.settings.after)for(h=0;h<l.settings.after.length;h++)if(arrayIndexOf(k,l.settings.after[h])>=m)return}m<arrayIndexOf(k,$(g.draggable).attr("name"))?$(this).before(g.draggable):$(this).after(g.draggable);Queue.clearCurrent()}});for(d in Workers){if(Workers[d].settings.before)for(e=
0;e<Workers[d].settings.before.length;e++)if(f=WorkerByName(Workers[d].settings.before[e])){f.settings.after=f.settings.after||[];f.settings.after.push(Workers[d].name);f.settings.after=unique(f.settings.after)}if(Workers[d].settings.after)for(e=0;e<Workers[d].settings.after.length;e++)if(f=WorkerByName(Workers[d].settings.after[e])){f.settings.before=f.settings.before||[];f.settings.before.push(Workers[d].name);f.settings.before=unique(f.settings.before)}}$.expr[":"].golem=function(h,g,k){g=k[3].toLowerCase().split(",");
if($(h).attr("id")===PREFIX+g[0].trim().replace(/[^0-9a-z]/g,"-")+"_"+g[1].trim())return true;return false};$("input.golem_addselect").live("click",function(){var h,g,k=$(".golem_select",$(this).parent()).val().split(",");for(h=0;h<k.length;h++)(g=k[h].trim())&&$("select.golem_multiple",$(this).parent()).append("<option>"+g+"</option>");Config.updateOptions()});$("input.golem_delselect").live("click",function(){$("select.golem_multiple option[selected=true]",$(this).parent()).each(function(h,g){$(g).remove()});
Config.updateOptions()});$("#golem_config input,textarea,select").live("change",function(){Config.updateOptions()});$("#golem-config-advanced").click(function(){Config.updateOptions();$('.golem-advanced:not(".golem-require")').css("display",Config.option.advanced?"":"none");Config.checkRequire()});$(".golem-panel-header input").click(function(h){h.stopPropagation(true)});this.checkRequire();$("#golem_config_frame").show()};
Config.makePanel=function(d,e){var f,h;if(!isWorker(d)){if(!WorkerStack.length)return;e=d;d=WorkerStack[WorkerStack.length-1]}if(!e){if(!d.display)return;e=d.display}$("#"+d.id).length||$("#golem_config").append('<div id="'+d.id+'" class="golem-panel'+(d.settings.unsortable?"":" golem-panel-sortable")+(findInArray(this.option.active,d.id)?" golem-panel-show":"")+(d.settings.advanced?" golem-advanced":"")+'"'+(d.settings.advanced&&!this.option.advanced||d.settings.exploit&&!this.option.exploit?' style="display:none;"':
"")+' name="'+d.name+'"><h3 class="golem-panel-header'+(!Queue.enabled(d)?" red":"")+'"><img class="golem-icon" src="'+Images.blank+'">'+d.name+'<input id="'+this.makeID(Queue,"enabled."+d.name)+'" type="checkbox"'+(Queue.enabled(d)?" checked":"")+(!d.work||d.settings.unsortable?' disabled="true"':"")+'><img class="golem-lock" src="'+Images.lock+'"></h3><div class="golem-panel-content" style="font-size:smaller;"></div></div>');h=$("#"+d.id+" > div").empty();if(isArray(e))for(f=0;f<e.length;f++)h.append(this.makeOption(d,
e[f]));else if(isObject(e))h.append(this.makeOption(d,e));else if(isString(e))h.append(this.makeOption(d,{title:e}));else if(isFunction(e))try{this.makePanel(d,e.call(d))}catch(g){debug(g.name+" in Config.makePanel("+d.name+".display()): "+g.message)}this.checkRequire(d.id)};Config.makeID=function(d,e){return PREFIX+d.name.toLowerCase().replace(/[^0-9a-z]/g,"-")+"_"+e};
Config.clearPanel=function(d){this._init();if(!isWorker(d)){if(!WorkerStack.length)return;d=WorkerStack[WorkerStack.length-1]}$("#"+d.id+" > div").empty()};
Config.addOption=function(d,e){this._init();if(!isWorker(d)){if(!d||!WorkerStack.length)return;e=d;d=WorkerStack[WorkerStack.length-1]}if(isArray(e))for(var f=0;f<e.length;f++)$("#"+d.id+" > div").append(this.makeOption(d,e[f]));else if(isObject(e))$("#"+d.id+" > div").append(this.makeOption(d,e));else if(isString(e))$("#"+d.id+" > div").append(this.makeOption(d,{title:e}));else isFunction(e)?this.addOption(d,e()):debug(d.name+" is trying to add an unknown type of panel")};
Config.makeOption=function(d,e){var f,h,g;g=[];var k=[];e=$.extend(true,{},{before:"",after:"",suffix:"",className:"",between:"to",size:7,min:0,max:100},e);e.real_id=this.makeID(d,e.id);e.value=d.get("option."+e.id,null);e.alt=e.alt?' alt="'+e.alt+'"':"";e.hr&&g.push('<br><hr style="clear:both;margin:0;">');e.title&&g.push('<div style="text-align:center;font-size:larger;font-weight:bold;">'+e.title.replace(" ","&nbsp;")+"</div>");if(e.label&&!e.button){g.push('<span style="float:left;margin-top:2px;">'+
e.label.replace(" ","&nbsp;")+"</span>");if(e.text||e.checkbox||e.select)g.push('<span style="float:right;">');else e.multiple&&g.push("<br>")}e.before&&g.push(e.before+" ");if(e.info)e.id?g.push('<span style="float:right" id="'+e.real_id+'">'+(e.value||e.info)+"</span>"):g.push(e.info);else if(e.text)g.push('<input type="text" id="'+e.real_id+'" size="'+e.size+'" value="'+(e.value||isNumber(e.value)?e.value:"")+'">');else if(e.textarea)g.push('<textarea id="'+e.real_id+'" name="'+e.real_id+'" cols="23" rows="5">'+
(e.value||"")+"</textarea>");else if(e.checkbox)g.push('<input type="checkbox" id="'+e.real_id+'"'+(e.value?" checked":"")+">");else if(e.button)g.push('<input type="button" id="'+e.real_id+'" value="'+e.label+'">');else if(e.select){switch(typeof e.select){case "number":h=Divisor(e.select);for(f=0;f<=e.select;f+=h)k.push("<option"+(e.value==f?" selected":"")+">"+f+"</option>");break;case "string":e.className=' class="golem_'+e.select+'"';if(this.data&&this.data[e.select]&&(typeof this.data[e.select]===
"array"||typeof this.data[e.select]==="object"))e.select=this.data[e.select];else break;case "array":case "object":if(isArray(e.select))for(f=0;f<e.select.length;f++)k.push('<option value="'+e.select[f]+'"'+(e.value==e.select[f]?" selected":"")+">"+e.select[f]+(e.suffix?" "+e.suffix:"")+"</option>");else for(f in e.select)k.push('<option value="'+f+'"'+(e.value==f?" selected":"")+">"+e.select[f]+(e.suffix?" "+e.suffix:"")+"</option>");break}g.push('<select id="'+e.real_id+'"'+e.className+e.alt+">"+
k.join("")+"</select>")}else if(e.multiple){if(typeof e.value==="array"||typeof e.value==="object")for(f in e.value)k.push('<option value="'+e.value[f]+'">'+e.value[f]+"</option>");g.push('<select style="width:100%;clear:both;" class="golem_multiple" multiple id="'+e.real_id+'">'+k.join("")+"</select><br>");if(typeof e.multiple==="string")g.push('<input class="golem_select" type="text" size="'+e.size+'">');else{k=[];switch(typeof e.multiple){case "number":h=Divisor(e.select);for(f=0;f<=e.multiple;f+=
h)k.push("<option>"+f+"</option>");break;case "array":case "object":if(isArray(e.multiple))for(f=0;f<e.multiple.length;f++)k.push('<option value="'+e.multiple[f]+'">'+e.multiple[f]+(e.suffix?" "+e.suffix:"")+"</option>");else for(f in e.multiple)k.push('<option value="'+f+'">'+e.multiple[f]+(e.suffix?" "+e.suffix:"")+"</option>");break}g.push('<select class="golem_select">'+k.join("")+"</select>")}g.push('<input type="button" class="golem_addselect" value="Add" /><input type="button" class="golem_delselect" value="Del" />')}e.after&&
g.push(" "+e.after);if(e.label&&(e.text||e.checkbox||e.select||e.multiple))g.push("</span>");g=$("<div>"+g.join("")+"<br></div>");if(e.require){if(typeof e.require==="string"){f=e.require;e.require={};e.require[f]=true}for(f in e.require){if(typeof e.require[f]!=="object")e.require[f]=[e.require[f]];if(f.search(/\.(data|option|runtime)\./)===-1){e.require[d.name+".option."+f]=e.require[f];delete e.require[f]}else if(f.search(/(data|option|runtime)\./)===0){e.require[d.name+"."+f]=e.require[f];delete e.require[f]}}g.addClass("golem-require").attr("require",
JSON.stringify(e.require))}e.advanced&&g.addClass("golem-advanced");e.help&&g.attr("title",e.help);(e.advanced||e.exploit)&&g.css("background","#ffeeee");e.advanced&&!this.option.advanced&&g.css("display","none");e.exploit&&!this.option.exploit&&g.css("display","none");e.exploit&&g.css("border","1px solid red");return g};
Config.set=function(d,e){if("Caap"in Workers)return false;this._unflush();if(!this.data[d]||JSON.stringify(this.data[d])!==JSON.stringify(e)){this.data[d]=e;$("select.golem_"+d).each(function(f,h){var g=WorkerById($(h).closest("div.golem-panel").attr("id"));g=g?g.get(["option",$(h).attr("id").regex(/_([^_]*)$/i)]):null;var k=Config.data[d],l=[];if(isArray(k))for(f=0;f<k.length;f++)l.push('<option value="'+k[f]+'">'+k[f]+"</option>");else for(f in k)l.push('<option value="'+f+'">'+k[f]+"</option>");
$(h).html(l.join("")).val(g)});this._save();return true}return false};
Config.updateOptions=function(){Queue.option.queue=this.getOrder();this.option.advanced=$("#golem-config-advanced").attr("checked");$("#golem_config :input:not(:button)").each(function(d,e){if($(e).attr("id")){var f;if(d=$(e).attr("id").slice(PREFIX.length).regex(/([^_]*)_(.*)/i)){if($(e).attr("type")==="checkbox")f=$(e).attr("checked");else if($(e).attr("multiple")){f=[];$("option",e).each(function(g,k){f.push($(k).text())})}else if((f=$(e).attr("value")||$(e).val()||null)&&f.search(/[^-0-9.]/)===
-1)f=parseFloat(f);try{WorkerByName(d[0]).set("option."+d[1],f)}catch(h){debug(h.name+" in Config.updateOptions(): "+$(e).attr("id")+"("+JSON.stringify(d)+") = "+h.message)}}}});this.checkRequire()};
Config.checkRequire=function(d){$((typeof d==="string"?"#"+d+" ":"")+".golem-require").each(function(e,f){var h,g,k=true,l=JSON.parse($(f).attr("require"));if($(f).hasClass("golem-advanced"))k=Config.option.advanced;for(e in l){g=e.split(".");if(h=WorkerByName(g.shift())){g=h.get(g,false);for(h=0;h<l[e].length;h++)if(isArray(l[e][h])){if(findInArray(l[e][h],g))k=false}else if(l[e][h]!==g)k=false}else k=false}k?$(f).show():$(f).hide()});for(i in Workers)Workers[i]._save("option")};
Config.getOrder=function(){var d=[];$("#golem_config > div").each(function(e,f){d.push($(f).attr("name"))});return unique(d)};var Dashboard=new Worker("Dashboard");Dashboard.settings={keep:true};Dashboard.defaults={castle_age:{pages:"*"}};Dashboard.option={display:"block",active:null};
Dashboard.init=function(){var d,e=[],f=[],h=this.option.active;for(i in Workers)if(Workers[i].dashboard){d="golem-dashboard-"+i;if(!h)this.option.active=h=d;Workers[i]===this?e.unshift('<h3 name="'+d+'" class="golem-tab-header'+(h===d?" golem-tab-header-active":"")+'">&nbsp;*&nbsp;</h3>'):e.push('<h3 name="'+d+'" class="golem-tab-header'+(h===d?" golem-tab-header-active":"")+'">'+(Workers[i]===this?"&nbsp;*&nbsp;":i)+"</h3>");f.push('<div id="'+d+'"'+(h===d?"":' style="display:none;"')+"></div>");
this._watch(Workers[i])}$('<div id="golem-dashboard" style="top:'+$("#app"+APPID+"_main_bn").offset().top+"px;display:"+this.option.display+';">'+e.join("")+"<div>"+f.join("")+"</div></div>").prependTo(".UIStandardFrame_Content");$(".golem-tab-header").click(function(){if(!$(this).hasClass("golem-tab-header-active")){if(Dashboard.option.active){$('h3[name="'+Dashboard.option.active+'"]').removeClass("golem-tab-header-active");$("#"+Dashboard.option.active).hide()}Dashboard.option.active=$(this).attr("name");
$(this).addClass("golem-tab-header-active");Dashboard.update("",WorkerByName(Dashboard.option.active.substr(16)));$("#"+Dashboard.option.active).show();Dashboard._save("option")}});$("#golem-dashboard .golem-panel > h3").live("click",function(){if($(this).parent().hasClass("golem-panel-show"))$(this).next().hide("blind",function(){$(this).parent().toggleClass("golem-panel-show")});else{$(this).parent().toggleClass("golem-panel-show");$(this).next().show("blind")}});$("#golem-dashboard thead th").live("click",
function(){var g=WorkerByName(Dashboard.option.active.substr(16));g._unflush();g.dashboard($(this).prevAll().length,$(this).attr("name")==="sort")});$("#golem_buttons").append('<img class="golem-button'+(Dashboard.option.display==="block"?"-active":"")+'" id="golem_toggle_dash" src="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%10%00%00%00%10%08%03%00%00%00(-%0FS%00%00%00%1EPLTE%BA%BA%BA%EF%EF%EF%E5%E5%E5%D4%D4%D4%D9%D9%D9%E3%E3%E3%F8%F8%F8%40%40%40%FF%FF%FF%00%00%00%83%AA%DF%CF%00%00%00%0AtRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%B2%CC%2C%CF%00%00%00EIDATx%DA%9C%8FA%0A%00%20%08%04%B5%CC%AD%FF%7F%B8%0D%CC%20%E8%D20%A7AX%94q!%7FA%10H%04%F4%00%19*j%07Np%9E%3B%C9%A0%0C%BA%DC%A1%91B3%98%85%AF%D9%E1%5C%A1%FE%F9%CB%14%60%00D%1D%07%E7%0AN(%89%00%00%00%00IEND%AEB%60%82">');
$("#golem_toggle_dash").click(function(){$(this).toggleClass("golem-button golem-button-active");Dashboard.option.display=Dashboard.option.display==="block"?"none":"block";Dashboard.option.display==="block"&&!$("#"+Dashboard.option.active).children().length&&WorkerByName(Dashboard.option.active.substr(16)).dashboard();$("#golem-dashboard").toggle("drop");Dashboard._save("option")});window.setInterval(function(){$(".golem-timer").each(function(g,k){(g=$(k).text().parseTimer())&&g>0?$(k).text(makeTimer($(k).text().parseTimer()-
1)):$(k).removeClass("golem-timer").text("now?")});$(".golem-time").each(function(g,k){(g=parseInt($(k).attr("name"))-Date.now())&&g>0?$(k).text(makeTimer(g/1E3)):$(k).removeClass("golem-time").text("now?")})},1E3)};Dashboard.parse=function(){$("#golem-dashboard").css("top",$("#app"+APPID+"_main_bn").offset().top+"px")};
Dashboard.update=function(d,e){if(this._loaded&&e)if(this.option.active==="golem-dashboard-"+e.name&&this.option.display==="block")try{e._unflush();e.dashboard()}catch(f){debug(f.name+" in "+e.name+".dashboard(): "+f.message)}else $("#golem-dashboard-"+e.name).empty()};
Dashboard.dashboard=function(){var d,e=[];for(d in Workers)this.data[d]&&e.push("<tr><th>"+d+':</th><td id="golem-status-'+d+'">'+this.data[d]+"</td></tr>");e.sort();$("#golem-dashboard-Dashboard").html('<table cellspacing="0" cellpadding="0" class="golem-status">'+e.join("")+"</table>")};Dashboard.status=function(d,e){if(e)this.data[d.name]=e;else delete this.data[d.name];this._save()};var History=new Worker("History");History.option=null;History.settings={system:true};
History.dashboard=function(){var d=[];d.push('<table cellspacing="0" cellpadding="0" class="golem-graph"><thead><tr><th></th><th colspan="73"><span style="float:left;">&lArr; Older</span>72 Hour History<span style="float:right;">Newer &rArr;</span><th></th></th></tr></thead><tbody>');d.push(this.makeGraph(["land","income"],"Income",true,{"Average Income":this.get("land.mean")+this.get("income.mean")}));d.push(this.makeGraph("bank","Bank",true,Land.runtime.best?{"Next Land":Land.runtime.cost}:null));
d.push(this.makeGraph("exp","Experience",false,{"Next Level":Player.get("maxexp")}));d.push(this.makeGraph("exp.change","Exp Gain",false,{Average:this.get("exp.average.change"),"Standard Deviation":this.get("exp.stddev.change"),"Ignore entries above":this.get("exp.mean.change")+2*this.get("exp.stddev.change")}));d.push("</tbody></table>");$("#golem-dashboard-History").html(d.join(""))};History.update=function(){var d,e=Math.floor(Date.now()/36E5)-168;for(d in this.data)d<e&&delete this.data[d]};
History.set=function(d,e){if(e){this._unflush();var f=Math.floor(Date.now()/36E5);d=typeof d==="string"?d.split("."):typeof d==="object"?d:[];if(d.length&&(typeof d[0]==="number"||!d[0].regex(/[^0-9]/gi)))f=d.shift();this.data[f]=this.data[f]||{};this.data[f][d[0]]=e}};
History.add=function(d,e){if(e){this._unflush();var f=Math.floor(Date.now()/36E5);d=typeof d==="string"?d.split("."):typeof d==="object"?d:[];if(d.length&&(typeof d[0]==="number"||!d[0].regex(/[^0-9]/gi)))f=d.shift();this.data[f]=this.data[f]||{};this.data[f][d[0]]=(this.data[f][d[0]]||0)+e}};
History.math={stddev:function(d){var e,f=0,h=this.mean(d);for(e in d)f+=Math.pow(d[e]-h,2);f/=d.length;return Math.sqrt(f)},average:function(d){var e,f=this.mean(d),h=this.stddev(d);for(e in d)Math.abs(d[e]-f)>h*2&&delete d[e];return sum(d)/d.length},mean:function(d){return sum(d)/d.length},harmonic:function(d){var e,f=[];for(e in d)d[e]&&f.push(1/d[e]);return f.length/sum(f)},geometric:function(d){var e,f=1;for(e in d)f*=d[e]||1;return Math.pow(f,1/d.length)},median:function(d){d.sort(function(e,
f){return e-f});if(d.length%2)return(d[Math.floor(d.length/2)]+d[Math.ceil(d.length/2)])/2;return d[Math.floor(d.length/2)]},mode:function(d){var e,f=0,h=0,g={};for(e in d)g[d[e]]=(g[d[e]]||0)+1;g=sortObject(g,function(k,l){return g[l]-g[k]});for(e in g)if(g[e]===g[0]){f+=parseInt(g[e]);h++}return f/h},max:function(d){d.sort(function(e,f){return f-e});return d[0]},min:function(d){d.sort(function(e,f){return e-f});return d[0]}};
History.get=function(d){this._unflush();var e,f,h,g=null,k=[],l=this.data;d=typeof d==="string"?d.split("."):typeof d==="object"?d:[];var m=Math.floor(Date.now()/36E5),q=false,o=168,n=false;if(d.length&&(typeof d[0]==="number"||!d[0].regex(/[^0-9]/gi)))m=d.shift();if(d.length&&(typeof d[d.length-1]==="number"||!d[d.length-1].regex(/[^0-9]/gi)))o=Math.range(1,parseInt(d.pop()),168);if(!d.length)return l;for(e in l)if(typeof l[e][d[0]]==="number"){q=true;break}if(d.length===1){if(q)return l[m][d[0]];
for(f in l[m])if(f.indexOf(d[0]+"+")===0&&typeof l[m][f]==="number")h=(h||0)+l[m][f];return h}if(d.length===2&&d[1]==="change"){if(l[m]&&l[m-1]){e=this.get([m,d[0]]);f=this.get([m-1,d[0]]);if(typeof e==="number"&&typeof f==="number")return e-f;return 0}return 0}if(d.length>2&&d[2]==="change")n=true;for(e=m-o;e<=m;e++)if(l[e]){h=null;if(q){if(typeof l[e][d[0]]==="number")h=l[e][d[0]]}else for(f in l[e])if(f.indexOf(d[0]+"+")===0&&typeof l[e][f]==="number")h=(h||0)+l[e][f];if(n){if(h!==null&&g!==null){k.push(h-
g);isNaN(k[k.length-1])&&debug("NaN: "+h+" - "+g)}g=h}else h!==null&&k.push(h)}if(History.math[d[1]])return History.math[d[1]](k);throw"Wanting to get unknown History type "+d[1]+" on "+d[0];};History.getTypes=function(d){var e,f=[],h={},g=this.data;d=d+"+";for(e in g)if(e.indexOf(d)===0)h[e]=true;for(e in h)f.push(e);return f};
History.makeGraph=function(d,e,f,h){var g,k,l=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,q,o=[],n=[],s=[],p=[],r={},u="";p=1;var t="",v=Math.floor(Date.now()/36E5);if(typeof h==="number")h=[h];else if(typeof h!=="array"&&typeof h!=="object")h=null;if(h&&length(h))for(g in h){l=Math.min(l,h[g]);m=Math.max(m,h[g])}if(typeof d==="string")d=[d];for(g=v-72;g<=v;g++){r[g]=[0];if(this.data[g]){for(k in d)r[g][k]=this.get(g+"."+d[k]);if(sum(r[g]))l=Math.min(l,sum(r[g]));m=Math.max(m,sum(r[g]))}}if(m>=
1E9){p=1E9;t="b"}else if(m>=1E6){p=1E6;t="m"}else if(m>=1E3){p=1E3;t="k"}m=Math.ceil(m/p)*p;d=(f?"$":"")+addCommas(m/p)+t;l=Math.floor(l/p)*p;q=(f?"$":"")+addCommas(l/p)+t;if(h&&length(h)){for(g in h){s.push('<div style="bottom:'+Math.max(Math.floor((h[g]-l)/(m-l)*100),0)+'px;"></div>');o.push("<div"+(typeof g!=="number"?' title="'+g+'"':"")+' style="bottom:'+Math.range(2,Math.ceil((h[g]-l)/(m-l)*100)-2,92)+'px;">'+(f?"$":"")+addCommas((h[g]/p).round(1))+t+"</div>")}u='<div class="goal">'+s.reverse().join("")+
"</div>";o.reverse()}th(n,"<div>"+d+"</div><div>"+e+"</div><div>"+q+"</div>");for(g=v-72;g<=v;g++){s=[];p=[];h=[];e=v-g+" hour"+(v-g==1?"":"s")+" ago";t=0;for(k in r[g]){s.push('<div style="height:'+Math.max(Math.ceil(100*(r[g][k]-(!t?l:0))/(m-l)),0)+'px;"></div>');t++;if(r[g][k])h.push(r[g][k]?(f?"$":"")+addCommas(r[g][k]):"")}p.push('<div class="bars">'+s.reverse().join("")+"</div>"+u);h.reverse();e=e+(h.length?", ":"")+h.join(" + ")+(h.length>1?" = "+(f?"$":"")+addCommas(sum(r[g])):"");td(n,p.join(""),
'title="'+e+'"')}th(n,o.join(""));return"<tr>"+n.join("")+"</tr>"};var Page=new Worker("Page");Page.settings={system:true,unsortable:true,keep:true};Page.option={timeout:15,reload:5};Page.page="";Page.last=null;Page.lastclick=null;Page.when=null;Page.retry=0;Page.checking=true;Page.node_trigger=null;Page.loading=false;Page.display=[{id:"timeout",label:"Retry after",select:[10,15,30,60],after:"seconds"},{id:"reload",label:"Reload after",select:[3,5,7,9,11,13,15],after:"tries"}];
Page.defaults={castle_age:{pageNames:{index:{url:"index.php",selector:"#app"+APPID+"_indexNewFeaturesBox"},quests_quest:{url:"quests.php",image:"tab_quest_on.gif"},quests_quest1:{url:"quests.php?land=1",image:"land_fire_sel.gif"},quests_quest2:{url:"quests.php?land=2",image:"land_earth_sel.gif"},quests_quest3:{url:"quests.php?land=3",image:"land_mist_sel.gif"},quests_quest4:{url:"quests.php?land=4",image:"land_water_sel.gif"},quests_quest5:{url:"quests.php?land=5",image:"land_demon_realm_sel.gif"},
quests_quest6:{url:"quests.php?land=6",image:"land_undead_realm_sel.gif"},quests_quest7:{url:"quests.php?land=7",image:"tab_underworld_big.gif"},quests_quest8:{url:"quests.php?land=8",image:"tab_heaven_big2.gif"},quests_demiquests:{url:"symbolquests.php",image:"demi_quest_on.gif"},quests_atlantis:{url:"monster_quests.php",image:"tab_atlantis_on.gif"},battle_battle:{url:"battle.php",image:"battle_on.gif"},battle_training:{url:"battle_train.php",image:"training_grounds_on_new.gif"},battle_rank:{url:"battlerank.php",
image:"tab_battle_rank_on.gif"},battle_raid:{url:"raid.php",image:"tab_raid_on.gif"},battle_war_council:{url:"war_council.php",image:"war_select_banner.jpg"},heroes_heroes:{url:"mercenary.php",image:"tab_heroes_on.gif"},heroes_generals:{url:"generals.php",image:"tab_generals_on.gif"},town_soldiers:{url:"soldiers.php",image:"tab_soldiers_on.gif"},town_blacksmith:{url:"item.php",image:"tab_black_smith_on.gif"},town_magic:{url:"magic.php",image:"tab_magic_on.gif"},town_land:{url:"land.php",image:"tab_land_on.gif"},
oracle_oracle:{url:"oracle.php",image:"oracle_on.gif"},oracle_demipower:{url:"symbols.php",image:"demi_on.gif"},oracle_treasurealpha:{url:"treasure_chest.php",image:"tab_treasure_alpha_on.gif"},oracle_treasurevanguard:{url:"treasure_chest.php?treasure_set=alpha",image:"tab_treasure_vanguard_on.gif"},oracle_treasureonslaught:{url:"treasure_chest.php?treasure_set=onslaught",image:"tab_treasure_onslaught_on.gif"},keep_stats:{url:"keep.php?user="+userID,image:"tab_stats_on.gif"},keep_eliteguard:{url:"party.php?user="+
userID,image:"tab_elite_guard_on.gif"},keep_achievements:{url:"achievements.php",image:"tab_achievements_on.gif"},keep_alchemy:{url:"alchemy.php",image:"tab_alchemy_on.gif"},keep_monster:{url:"battle_monster.php",image:"tab_monster_on.jpg"},keep_monster_active2:{url:"battle_monster.php",selector:'div[style*="nm_monster_list_button.gif"]'},keep_monster_active:{url:"raid.php",image:"dragon_view_more.gif"},army_invite:{url:"army.php",image:"invite_on.gif"},army_gifts:{url:"gift.php",selector:"#app"+
APPID+"_giftContainer"},army_viewarmy:{url:"army_member.php",image:"view_army_on.gif"},army_sentinvites:{url:"army_reqs.php",image:"sent_invites_on.gif"},army_newsfeed:{url:"army_news_feed.php",selector:"#app"+APPID+"_army_feed_header"},gift_accept:{url:"gift_accept.php",selector:'div[style*="gift_background.jpg"]'},apprentice_collect:{url:"apprentice.php?collect=true",image:"ma_view_progress2.gif"}}}};
Page.init=function(){$("body").bind("DOMNodeInserted",function(d){if(!Page.node_trigger&&($(d.target).attr("id")==="app"+APPID+"_app_body_container"||$(d.target).attr("id")==="app"+APPID+"_globalContainer"))Page.node_trigger=window.setTimeout(function(){Page.node_trigger=null;Page.parse_all()},100)})};
Page.parse_all=function(){WorkerStack.push(this);Page.identify();var d,e=[];for(d in Workers)if(Workers[d].parse&&Workers[d].pages&&(Workers[d].pages.indexOf("*")>=0||Page.page!==""&&Workers[d].pages.indexOf(Page.page)>=0)){Workers[d]._unflush();Workers[d]._parse(false)&&e.push(Workers[d])}for(d in e)e[d]._parse(true);for(d in Workers)Workers[d]._flush();WorkerStack.pop()};
Page.work=function(d){if(!this.checking)return false;var e,f,h,g=null;for(e in Workers){if(Workers[e].pages){h=Workers[e].pages.split(" ");for(f=0;f<h.length;f++)if(h[f]!=="*"&&this.pageNames[h[f]]&&!this.data[h[f]]&&h[f].indexOf("_active")===-1){g=h[f];break}}if(g)break}if(!d){if(g)return true;return this.checking=false}if(g&&!this.to(g)){this.data[g]=Date.now();return true}return false};
Page.identify=function(){this.page="";if(!$("#app_content_"+APPID+" > div > div").length||!$("#app"+APPID+"_globalContainer > div > div").length){debug("Page apparently not loaded correctly, reloading.");this.reload();return null}this.clear();var d=$("#app"+APPID+"_app_body"),e;$("img",d).each(function(f,h){f=$(h).attr("src").filepart();for(e in Page.pageNames)if(Page.pageNames[e].image&&f===Page.pageNames[e].image){Page.page=e;return}});if(!this.page)for(e in Page.pageNames)if(Page.pageNames[e].selector&&
$(Page.pageNames[e].selector).length)Page.page=e;if(this.page!=="")this.data[this.page]=Date.now();return this.page};
Page.to=function(d,e,f){if(Queue.option.pause){debug("Trying to load page when paused...");return true}if(d===this.page&&(f||typeof e==="undefined"))return true;e||(e="");if(d&&this.pageNames[d]&&this.pageNames[d].url){this.clear();this.last=this.pageNames[d].url;this.when=Date.now();if(e.indexOf("?")===0&&this.last.indexOf("?")>0)this.last=this.last.substr(0,this.last.indexOf("?"))+e;else this.last+=e;debug("Navigating to "+d+" ("+(f?"FORCE: ":"")+this.last+")");if(f)window.location.href=this.last;
else this.ajaxload()}return false};
Page.ajaxload=function(){$.ajax({cache:false,dataType:"text",timeout:this.option.timeout*1E3,url:"http://apps.facebook.com/castle_age/"+this.last,error:function(){debug("Page not loaded correctly, reloading.");Page.ajaxload()},success:function(d){if(d.indexOf("app"+APPID+"_results_container")!==-1&&d.indexOf("</html>")!==-1&&d.indexOf("single_popup")!==-1&&d.indexOf("app"+APPID+"_index")!==-1){Page.loading=false;d=d.substring(d.indexOf('<div id="app'+APPID+'_globalContainer"'),d.indexOf('<div class="UIStandardFrame_SidebarAds"'));
if(d.indexOf(APP)===-1)arguments.callee("");else{$("#app"+APPID+"_AjaxLoadIcon").css("display","none");$("#app"+APPID+"_globalContainer").replaceWith(d)}}else if(++Page.retry<Page.option.retry){debug("Page not loaded correctly, retry last action.");Page.ajaxload()}else{debug("Page not loaded correctly, reloading.");Page.reload()}}});this.loading=true;setTimeout(function(){Page.loading&&$("#app"+APPID+"_AjaxLoadIcon").css("display","block")},1500)};
Page.reload=function(){debug("Page.reload()");window.location.href=window.location.href};
Page.click=function(d){if(!$(d).length){log("Page.click: Unable to find element - "+d);return false}if(this.lastclick===d){if(++this.retry>=this.option.retry){debug("Element not clicked properly, reloading.");Page.reload();return true}}else this.clear();var e=document.createEvent("MouseEvents");e.initEvent("click",true,true);isGreasemonkey?$(d).get(0).wrappedJSObject.dispatchEvent(e):$(d).get(0).dispatchEvent(e);this.lastclick=d;this.when=Date.now();return true};
Page.clear=function(){this.last=this.lastclick=this.when=null;this.retry=0};var Queue=new Worker("Queue","*");Queue.data=null;var QUEUE_FINISH=0,QUEUE_CONTINUE=1,QUEUE_RELEASE=2;Queue.settings={system:true,unsortable:true,keep:true};Queue.runtime={reminder:{},current:null};
Queue.option={delay:5,clickdelay:5,queue:["Page","Resources","Queue","Settings","Title","Income","LevelUp","Elite","Quest","Monster","Battle","Heal","Land","Town","Bank","Alchemy","Blessing","Gift","Upgrade","Potions","Army","Idle"],start_stamina:0,stamina:0,start_energy:0,energy:0,pause:false};Queue.caap_load=function(){this.option.pause=false};
Queue.display=[{label:"Drag the unlocked panels into the order you wish them run."},{id:"delay",label:"Delay Between Events",text:true,after:"secs",size:3},{id:"clickdelay",label:"Delay After Mouse Click",text:true,after:"secs",size:3,help:"This should be a multiple of Event Delay"},{id:"stamina",before:"Keep",select:"stamina",after:"Stamina Always"},{id:"start_stamina",before:"Stock Up",select:"stamina",after:"Stamina Before Using"},{id:"energy",before:"Keep",select:"energy",after:"Energy Always"},
{id:"start_energy",before:"Stock Up",select:"energy",after:"Energy Before Using"}];Queue.runfirst=[];Queue.lastclick=Date.now();Queue.lastrun=Date.now();Queue.burn={stamina:false,energy:false};Queue.timer=null;Queue.lasttimer=0;Queue.lastpause=false;
Queue.init=function(){if("Caap"in Workers)return false;var d,e;this._watch(Player);this.option.queue=unique(this.option.queue);for(d in Workers)if(Workers[d].work&&Workers[d].display&&!findInArray(this.option.queue,d)){log("Adding "+d+" to Queue");Workers[d].settings.unsortable?this.option.queue.unshift(d):this.option.queue.push(d)}for(d=0;d<this.option.queue.length;d++)if((e=Workers[this.option.queue[d]])&&e.display){if(this.runtime.current&&e.name===this.runtime.current){debug("Trigger "+e.name+
" (continue after load)");$("#"+e.id+" > h3").css("font-weight","bold")}$("#golem_config").append($("#"+e.id))}$(document).click(function(){Queue.lastclick=Date.now()});$(document).keypress(function(){Queue.lastclick=Date.now()});Queue.lastpause=this.option.pause;$btn=$('<img class="golem-button'+(this.option.pause?" red":" green")+'" id="golem_pause" src="'+(this.option.pause?Images.play:Images.pause)+'">').click(function(){var f=Queue.set("option.pause",!Queue.get("option.pause",false));debug("State: "+
(f?"paused":"running"));$(this).toggleClass("red green").attr("src",f?Images.play:Images.pause);Page.clear();Queue.clearCurrent();Config.updateOptions()});$("#golem_buttons").prepend($btn)};Queue.clearCurrent=function(){var d=this.get("runtime.current",null);if(d){$("#"+Workers[d].id+" > h3").css("font-weight","normal");this.set("runtime.current",null)}};
Queue.update=function(){if("Caap"in Workers)return false;var d,e;if(!this.option.pause&&this.option.delay!==this.lasttimer){window.clearInterval(this.timer);this.timer=window.setInterval(function(){Queue.run()},this.option.delay*1E3);this.lasttimer=this.option.delay}else if(this.option.pause&&this.option.pause!==this.lastpause){window.clearInterval(this.timer);this.lasttimer=-1}this.lastpause=this.option.pause;for(d in Workers){e=$("#"+Workers[d].id+" .golem-panel-header");if(Queue.enabled(Workers[d])){if(e.hasClass("red")){e.removeClass("red");
Workers[d]._update("option",null)}}else if(!e.hasClass("red")){e.addClass("red");Workers[d]._update("option",null)}}this.runtime.current&&!this.get(["option","enabled",this.runtime.current],true)&&this.clearCurrent();this.burn.stamina=this.burn.energy=0;if(this.option.burn_stamina||Player.get("stamina")>=this.option.start_stamina){this.burn.stamina=Math.max(0,Player.get("stamina")-this.option.stamina);this.option.burn_stamina=this.burn.stamina>0}if(this.option.burn_energy||Player.get("energy")>=this.option.start_energy){this.burn.energy=
Math.max(0,Player.get("energy")-this.option.energy);this.option.burn_energy=this.burn.energy>0}};
Queue.run=function(){if(!(isWorker(Window)&&!Window.active)){var d,e,f;e=Date.now();var h=null,g=false;if(!(this.option.pause||e-this.lastclick<this.option.clickdelay*1E3))if(!Page.loading){WorkerStack.push(this);for(d in Workers)if(Workers[d].work&&!Workers[d].display&&this.enabled(Workers[d])){Workers[d]._unflush();Workers[d]._work(false)}for(d=0;d<this.option.queue.length;d++){e=Workers[this.option.queue[d]];if(!(!e||!e.work||!e.display||!this.enabled(e))){if(this.runtime.current===e.name){e._unflush();
f=e._work(true);if(f===QUEUE_RELEASE)g=true;else if(!f){this.runtime.current=null;e.id&&$("#"+e.id+" > h3").css("font-weight","normal");debug("End "+e.name)}}else f=e._work(false);if(!e.settings.stateful&&typeof f!=="boolean")e.settings.stateful=true;if(!h&&f)h=e}}e=this.runtime.current?Workers[this.runtime.current]:null;if(h!==e&&(!e||!e.settings.stateful||h.settings.important||g)){if(e){debug("Interrupt "+e.name+" with "+h.name);e.id&&$("#"+e.id+" > h3").css("font-weight","normal")}else debug("Trigger "+
h.name);this.runtime.current=h.name;h.id&&$("#"+h.id+" > h3").css("font-weight","bold")}for(d in Workers)Workers[d]._flush();WorkerStack.pop()}}};Queue.enabled=function(d){return isWorker(d)&&this.get(["option","enabled",d.name],true)};var Settings=new Worker("Settings");Settings._rootpath=false;Settings.settings={system:true,unsortable:true,advanced:true};Settings.option={action:"None",which:"- default -",name:"- default -",confirm:false};
Settings.display=[{title:"IMPORTANT!",label:"This will backup and restore your current options.<br>There is no confirmation dialog!"},{id:"action",label:"Action (<b>Immediate!!</b>)",select:["None","Load","Save","Delete"]},{id:"which",label:"Which",select:"settings"},{id:"name",label:"New Name",text:true}];Settings.oldwhich=null;Settings.init=function(){this.data["- default -"]||this.set("- default -");Settings.oldwhich=this.option.which};
Settings.update=function(d){if(d==="option"){var e;d=[];if(this.oldwhich!==this.option.which){$("input:golem(settings,name)").val(this.option.which);this.oldwhich=this.option.name=this.option.which}switch(this.option.action){default:case "None":break;case "Load":debug("Loading "+this.option.which);this.get(this.option.which);break;case "Save":debug("Saving "+this.option.name);this.set(this.option.name);this.option.which=this.option.name;break;case "Delete":this.option.which!=="- default -"&&delete this.data[this.option.which];
this.option.which="- default -";this.option.name="- default -";break}$("select:golem(settings,action)").val("None");this.option.action="None";for(e in this.data)d.push(e);Config.set("settings",d.sort())}};Settings.set=function(d,e){var f=typeof d==="string"?d.split("."):typeof d==="object"?d:[];if(f.length&&(f[0]==="option"||f[0]==="runtime"))return this._set(d,e);this._unflush();this.data[d]={};for(var h in Workers)if(Workers[h]!==this&&Workers[h].option)this.data[d][h]=$.extend(true,{},Workers[h].option)};
Settings.get=function(d){var e,f=typeof d==="string"?d.split("."):typeof d==="object"?d:[];if(f.length&&(f[0]==="option"||f[0]==="runtime"))return this._get(d);this._unflush();if(this.data[d]){for(e in Workers)if(Workers[e]!==this&&Workers[e].option&&this.data[d][e]){Workers[e].option=$.extend(true,{},this.data[d][e]);Workers[e]._save("option")}Page.reload()}};var Title=new Worker("Title");Title.data=null;Title.settings={system:true,unsortable:true,advanced:true};Title.option={enabled:false,title:"CA: {Queue:runtime.current} | {energy}e | {stamina}s | {exp_needed}xp by {LevelUp:time}"};
Title.display=[{id:"enabled",label:"Change Window Title",checkbox:true},{id:"title",text:true,size:24},{title:"Useful Values",info:'{myname}<br>{energy} / {maxenergy}<br>{health} / {maxhealth}<br>{stamina} / {maxstamina}<br>{level}<br>{pause} - "(Paused) " when paused<br>{LevelUp:time} - Next level time<br>{Queue:runtime.current} - Activity'}];Title.old=null;Title.init=function(){this._watch(Player)};
Title.update=function(){if(this.option.enabled&&this.option.title){var d,e,f,h,g="",k=this.option.title.match(/([^}]+\}?)/g);for(d in k){e=k[d].regex(/([^{]*)\{?([^}]*)\}?/);g+=e[0];if(e[1]){h=Player;f=e[1].split(":");if(f[1])h=WorkerByName(f.shift());if(h){e=h.get(f[0]);g+=typeof e==="number"?addCommas(e):typeof e==="string"?e:"";this._watch(h)}else debug('Bad worker specified = "'+e[1]+'"')}}if(!this.old)this.old=document.title;document.title=g}else if(this.old){document.title=this.old;this.old=
null}};var Update=new Worker("Update");Update.data=null;Update.option=null;Update.settings={gm_only:true,system:true};Update.runtime={lastcheck:0,force:false};Update.found=false;
Update.init=function(){var d=$('<img class="golem-button" name="Script Update" id="golem_update" src="'+(isRelease?Images.update:Images.beta)+'">').click(function(){$(this).addClass("red");Update.runtime.force=true});$("#golem_buttons").append(d);if(isRelease){d=$('<img class="golem-button golem-advanced"'+(Config.get("option.advanced")?"":' style="display:none;"')+' name="Beta Update" src="'+Images.beta+'">').click(function(){$(this).addClass("red");isRelease=false;Update.runtime.force=true});$("#golem_buttons").append(d)}};
Update.work=function(){if(!this.found&&(this.runtime.force||Date.now()-this.runtime.lastcheck>216E5)){this.runtime.lastcheck=Date.now();debug("Checking trunk revisions");GM_xmlhttpRequest({method:"GET",url:"http://code.google.com/p/game-golem/source/browse/#svn/trunk",onload:function(d){if(d.readyState===4&&d.status===200){var e;e=d.responseText.regex(/"trunk":{".*"_release.user.js":\["[^"]*","([0-9]+)","([^"]*)"/i);if(e[0]>revision){$("#golem_buttons").after('<div class="golem-button golem-info green" title="r'+
e[0]+" released "+e[1]+", currently on r"+revision+'"><a href="http://game-golem.googlecode.com/svn/trunk/_release.user.js">New Version Available</a></div>');Update.found=true;log("New version available: "+e[0]+", currently on r"+revision)}if(!isRelease){e=d.responseText.regex(/"trunk":{".*"_normal.user.js":\["[^"]*","([0-9]+)","([^"]*)"/i);if(e[0]>revision){$("#golem_buttons").after('<div class="golem-button golem-info green" title="r'+e[0]+" released "+e[1]+", currently on r"+revision+'"><a href="http://game-golem.googlecode.com/svn/trunk/_normal.user.js">New Beta Available</a></div>');
Update.found=true;log("New revision available: "+e[0]+", currently on r"+revision)}}if(Update.runtime.force&&!Update.found){d=$('<div class="golem-button golem-info red">No Update Found</div>').animate({"z-index":0},{duration:5E3,complete:function(){log("test");$(this).remove()}});$("#golem_buttons").after(d)}Update.runtime.force=false;$("#golem_update").removeClass("red")}}})}};var Window=new Worker("Window");Window.runtime=Window.option=null;Window._rootpath=false;Window.settings={system:true};
Window.data={active:false,list:{}};Window.global={_magic:"golem-magic-key",_id:"#"+Date.now()};Window.active=false;Window.timeout=15E3;Window.warning=null;
Window.init=function(){var d=Date.now(),e;try{e=JSON.parse((isGreasemonkey?window.wrappedJSObject:window).name);if(typeof e==="object"&&typeof e._magic!=="undefined"&&e._magic===this.global._magic)this.global=e}catch(f){}(isGreasemonkey?window.wrappedJSObject:window).name=JSON.stringify(this.global);this.data.list=this.data.list||{};this.data.list[this.global._id]=d;if(!this.data.active||typeof this.data.list[this.data.active]==="undefined"||this.data.list[this.data.active]<d-this.timeout||this.data.active===
this.global._id){this.active=true;this.data.active=this.global._id;this._save("data");$(".golem-title").after('<div id="golem_window" class="golem-button green" style="display:none;">Enabled</div>')}else{$(".golem-title").after('<div id="golem_window" class="golem-info golem-button red"><b>Disabled</b></div>');$("#golem_window").nextAll().hide()}$("#golem_window").click(function(){Window._unflush();if(Window.active){$(this).html("<b>Disabled</b>").toggleClass("red green").nextAll().hide();Window.data.active=
null;Window.active=false}else if(!Window.data.active||typeof Window.data.list[Window.data.active]==="undefined"||Window.data.list[Window.data.active]<Date.now()-Window.timeout){$(this).html("Enabled").toggleClass("red green");$("#golem_buttons").show();Config.get("option.display")==="block"&&$("#golem_config").parent().show();Queue.clearCurrent();Window.data.active=Window.global._id;Window.active=true}else{$(this).html("<b>Disabled</b><br><span>Another instance running!</span>");!Window.warning&&
function(){if($("#golem_window span").length)$("#golem_window span").css("color").indexOf("255")===-1?$("#golem_window span").animate({color:"red"},200,arguments.callee):$("#golem_window span").animate({color:"black"},200,arguments.callee)}();window.clearTimeout(Window.warning);Window.warning=window.setTimeout(function(){Window.active||$("#golem_window").html("<b>Disabled</b>");Window.warning=null},3E3)}Window._flush()});this._revive(1)};
Window.update=function(d){if(d==="reminder"){var e;d=Date.now();this.data=this.data||{};this.data.list=this.data.list||{};this.data.list[this.global._id]=d;for(e in this.data.list)this.data.list[e]<d-this.timeout&&delete this.data.list[e];e=length(this.data.list);if(e===1){if(!this.active){$("#golem_window").css("color","black").html("Enabled").toggleClass("red green");$("#golem_buttons").show();Config.get("option.display")==="block"&&$("#golem_config").parent().show();Queue.set("runtime.current",
null);this.data.active=this.global._id;this.active=true}$("#golem_window").hide()}else e>1&&$("#golem_window").show();this._flush()}};
Window.get=function(d,e){var f=typeof d==="string"?d.split("."):typeof d==="object"?d:[],h=this.global;try{return function(k,l,m){if(l.length){var q=l.shift();return arguments.callee(k[q],l,m)}else return typeof k!=="undefined"?k:m}(h,f,e)}catch(g){typeof e==="undefined"&&debug(g.name+" in "+this.name+".get("+d.toString()+"): "+g.message)}return typeof e!=="undefined"?e:null};
Window.set=function(d,e){var f=typeof d==="string"?d.split("."):typeof d==="object"?d:[],h=this.global;if(f.length)try{(function(k,l){var m=l.shift();if(l.length){if(typeof k[m]!=="object")k[m]={};arguments.callee(k[m],l);length(k[m])||delete k[m]}else if(typeof e!=="undefined")k[m]=e;else delete k[m]})(h,f);(isGreasemonkey?window.wrappedJSObject:window).name=JSON.stringify(this.global)}catch(g){debug(g.name+" in "+this.name+".set("+d+", "+e+"): "+g.message)}};var Alchemy=new Worker("Alchemy");
Alchemy.defaults.castle_age={pages:"keep_alchemy"};Alchemy.data={ingredients:{},summons:{},recipe:{}};Alchemy.option={perform:false,hearts:false,summon:false};Alchemy.runtime={best:null};Alchemy.display=[{id:"hearts",label:"Use Battle Hearts",checkbox:true},{id:"summon",label:"Use Summon Ingredients",checkbox:true}];
Alchemy.parse=function(){var d=this.data.ingredients={},e=this.data.recipe={};$("div.ingredientUnit").each(function(f,h){f=$("img",h).attr("src").filepart();d[f]=$(h).text().regex(/x([0-9]+)/)});$("div.alchemyQuestBack,div.alchemyRecipeBack,div.alchemyRecipeBackMonster").each(function(f,h){var g={};f=$("div.recipeTitle",h).text().trim().replace("RECIPES: ","");if(f.indexOf(" (")>0)f=f.substr(0,f.indexOf(" ("));if($(h).hasClass("alchemyQuestBack"))g.type="Quest";else if($(h).hasClass("alchemyRecipeBack"))g.type=
"Recipe";else if($(h).hasClass("alchemyRecipeBackMonster"))g.type="Summons";g.ingredients={};$("div.recipeImgContainer",h).parent().each(function(k,l){k=$("img",l).attr("src").filepart();g.ingredients[k]=$(l).text().regex(/x([0-9]+)/)||1});e[f]=g})};
Alchemy.update=function(){var d=null,e=this.data.recipe,f,h;for(f in e)if(e[f].type==="Summons")for(h in e[f].ingredients)this.data.summons[h]=true;for(f in e)if(e[f].type==="Recipe"){d=f;for(h in e[f].ingredients)if(!this.option.hearts&&h==="raid_hearts.gif"||!this.option.summon&&this.data.summons[h]||e[f].ingredients[h]>(this.data.ingredients[h]||0)){d=null;break}if(d)break}this.runtime.best=d};
Alchemy.work=function(d){if(!this.runtime.best)return QUEUE_FINISH;if(!d||!Page.to("keep_alchemy"))return QUEUE_CONTINUE;debug("Perform - "+this.runtime.best);Page.click($('input[type="image"]',$('div.recipeTitle:contains("'+this.runtime.best+'")').next()))||Page.reload();return QUEUE_RELEASE};var Bank=new Worker("Bank");Bank.data=null;Bank.defaults.castle_age={};Bank.option={general:true,above:1E4,hand:0,keep:1E4};
Bank.display=[{id:"general",label:"Use Best General",checkbox:true},{id:"above",label:"Bank Above",text:true},{id:"hand",label:"Keep in Cash",text:true},{id:"keep",label:"Keep in Bank",text:true}];Bank.work=function(d){if("Caap"in Workers&&this.option.above==="")return QUEUE_FINISH;if(Player.get("cash")<=10||Player.get("cash")<=this.option.above)return QUEUE_FINISH;else if(!d||this.stash(Player.get("cash")-this.option.hand))return QUEUE_CONTINUE;return QUEUE_RELEASE};
Bank.stash=function(d){if(!d||!Player.get("cash")||Math.min(Player.get("cash"),d)<=10)return true;if(this.option.general&&!Generals.to("bank")||!Page.to("keep_stats"))return false;$('input[name="stash_gold"]').val(Math.min(Player.get("cash"),d));Page.click('input[value="Stash"]');return true};
Bank.retrieve=function(d){!("Caap"in Workers)&&(WorkerByName(Queue.get("runtime.current")).settings.bank=true);d-=Player.get("cash");if(d<=0||Player.get("bank")-this.option.keep<d)return true;if(!Page.to("keep_stats"))return false;$('input[name="get_gold"]').val(d.toString());Page.click('input[value="Retrieve"]');return false};Bank.worth=function(d){var e=Player.get("cash")+Math.max(0,Player.get("bank")-this.option.keep);if(typeof d==="number")return d<=e;return e};var Battle=new Worker("Battle");
Battle.defaults.castle_age={pages:"battle_rank battle_battle"};Battle.data={user:{},rank:{},points:{}};Battle.option={general:true,points:true,monster:true,arena:false,losses:5,type:"Invade",bp:"Always",army:1.1,level:1.1,preferonly:"Sometimes",prefer:[],between:0};Battle.runtime={attacking:null};
Battle.symbol={1:"data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%16%00%00%00%16%08%03%00%00%00%F3j%9C%09%00%00%00%18PLTE%17%90%B3%1AIn%99%AD%B0%3F%5Erj%7F%8A4%40J%22*1%FF%FF%FFm%0F%82%CD%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00%ABIDATx%DAl%91%0B%0E%04!%08CAh%E7%FE7%DE%02%BA3%FBib%A2O%A8%02vm%91%00xN%B6%A1%10%EB%86O%0C%22r%AD%0Cmn%0C%8A%8Drxa%60-%B3p%AF%8C%05%0C%06%15d%E6-%5D%90%8D%E5%90~%B0x%A20e%117%0E%D9P%18%A1%60w%F3%B0%1D%1E%18%1C%85m'D%B9%08%E7%C6%FE%0F%B7%CF%13%C77%1Eo%F4%93%05%AA%24%3D%D9%3F%E1%DB%25%8E%07%BB%CA%D8%9C%8E%FE6%A6J%B9%1F%FB%DAa%8A%BFNW3%B5%9ANc%D5%FEn%9El%F7%20%F6tt%8C%12%F01%B4%CE%F8%9D%E5%B7%5E%02%0C%00n%97%07%B1AU%81%B7%00%00%00%00IEND%AEB%60%82",2:"data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%16%00%00%00%16%08%03%00%00%00%F3j%9C%09%00%00%00%18PLTE%E0%0D%0CZ%5B%5Bv%13%0F%2F%1A%16%7Byx%8941DB%3F%FF%FF%FFOmpc%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00%B4IDATx%DAT%D1%5B%12%C5%20%08%03P%08%C2%DD%FF%8Eo%12%EB%D8%F2%D1%C7%C1%01%C5%F8%3DQ%05T%9D%BFxP%C6%07%EA%CDF%07p%998%B9%14%C3%C4aj%AE%9CI%A5%B6%875zFL%0F%C8%CD%19vrG%AC%CD%5C%BC%C6nM%D57'%EB%CA%AD%EC%C2%E5b%B5%93%5B%E9%97%99%40D%CC%97sw%DB%FByqwF%83u%FA%F2%C8%A3%93u%A0%FD%8C%B8%BA%96NAn%90%17%C1%C7%E1'%D7%F2%85%01%D4%DC%A7d%16%EDM2%1A%C3%C5%1E%15%7DX%C7%23%19%EB%1El%F5h%B2lV%5B%CF%ED%A0w%89~%AE'%CE%ED%01%F7%CA%5E%FC%8D%BF%00%03%00%AA%CE%08%23%FB4h%C4%00%00%00%00IEND%AEB%60%82",
3:"data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%16%00%00%00%16%08%03%00%00%00%F3j%9C%09%00%00%00%18PLTE%B1%98g%DE%BCyqpq%8CnF%12%11%0EME7y8%0B%FF%FF%FF6%A1%E73%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00%B7IDATx%DA%5C%91Y%16C!%0CB%C9%40%BA%FF%1D%17%7Cz%9Em%BE%F4%8A%19%08%3E%3BX%40%F1%DC%B0%A1%99_xcT%EF(%BC8%D8%CC%9A%A9%D4!%0E%0E%8Bf%863%FE%16%0F%06%5BR%22%02%1C%A0%89%07w%E6T%AC%A8A%F6%C2%251_%9CPG%C2%A1r7N%CB%E1%1CtN%E7%06%86%7F%B85%8B%1A%22%2F%AC%3E%D4%B2_.%9C%C6%EA%B3%E2%C6%BB%24%CA%25uY%98%D5H%0D%EE%922%40b%19%09%CFNs%99%C8Y%E2XS%D2%F3*%0F7%B5%B9%B6%AA%16_%0E%9A%D61V%DCu-%E5%A2g%3BnO%C1%B3%1E%9C%EDiax%94%3F%F87%BE%02%0C%00%98%F2%07%E0%CE%8C%E4%B1%00%00%00%00IEND%AEB%60%82",
4:"data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%16%00%00%00%16%08%03%00%00%00%F3j%9C%09%00%00%00%18PLTE%90%CA%3CSTRq%9B5On*%10%13%0Dx%7Ct6B'%FF%FF%FFx%0A%94%CE%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00%B2IDATx%DAT%D1A%16%C4%20%08%03P%20%92%B9%FF%8D'%80%B5%96%85%AF~%95*%D8o%07%09%90%CF%CC6%96%F5%CA%CD%E0%DAA%BC%0CM%B3C%CBxX%9A%E9%15Z%18%B7QW%E2%DB%9B%3D%E0%CD%99%11%18V%3AM%02%CD%FA%08.%8A%B5%D95%B1%A0%A7%E9Ci%D0%9Cb3%034D%F8%CB(%EE%F8%F0%F1%FA%C5ae9%BB%FD%B0%A7%CF%F9%1Au%9FfR%DB%A3%A19%179%CFa%B1%8E%EB*%91%BE_%B9*M%A9S%B7%97%AE)%15%B5%3F%BAX%A9%0Aw%C9m%9A%A0%CA%AA%20%5Eu%E5%D5%1DL%23%D4%9Eu7%AD%DBvZv%F17%FE%02%0C%00%D3%0A%07%E1%0961%CF%00%00%00%00IEND%AEB%60%82",
5:"data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%16%00%00%00%16%08%03%00%00%00%F3j%9C%09%00%00%00%18PLTE%F2%F2%EF!!%20%A5%A5%A3vvv%5BZZ%3D%3D%3B%00%00%00%FF%FF%FF.%C4%F9%B3%00%00%00%08tRNS%FF%FF%FF%FF%FF%FF%FF%00%DE%83%BDY%00%00%00%BEIDATx%DA%5C%91Q%92%C30%08C%11B%DE%FB%DFx%25%C7n3%E5%23%E3%3Cd%01%A6%FEN%00%12p%FF%EA%40%A3%05%A7%F0%C6%C2%0A%CCW_%AC%B5%C4%1D9%5D%EC39%09'%B0y%A5%D8%E2H%5D%D53%DDH%E1%E05%A6%9A2'%9Bkcw%40%E9%C5e%5Ev%B6g%E4%B1)%DA%DF%EEQ%D3%A0%25Vw%EC%B9%D5)%C8%5Cob%9C%1E%E2%E2%D8%16%F1%94%F8%E0-%AF%B9%F8x%CB%F2%FE%C8g%1Eo%A03w%CA%86%13%DB%C4%1D%CA%7C%B7%E8w%E4d%FAL%E9%CE%9B%F3%F0%D0g%F8%F0%AD%CFSyD%DC%875%87%3B%B0%D1%5D%C4%D9N%5C%13%3A%EB%A9%F7.%F5%BB%CB%DF%F8%17%60%00%EF%2F%081%0F%2BNZ%00%00%00%00IEND%AEB%60%82"};
Battle.demi={1:"Ambrosia",2:"Malekus",3:"Corvintheus",4:"Aurora",5:"Azeron"};
Battle.display=[{id:"general",label:"Use Best General",checkbox:true},{id:"type",label:"Battle Type",select:["Invade","Duel","War"],help:"War needs level 150+, and is similar to Duel - though also uses 10 stamina"},{id:"losses",label:"Attack Until",select:["Ignore",1,2,3,4,5,6,7,8,9,10],after:"Losses"},{id:"points",label:"Always Get Demi-Points",checkbox:true},{advanced:true,id:"monster",label:"Fight Monsters First",checkbox:true},{id:"bp",label:"Get Battle Points<br>(Clears Cache)",select:["Always",
"Never","Don't Care"]},{advanced:true,id:"cache",label:"Limit Cache Length",select:[100,200,300,400,500]},{advanced:true,id:"between",label:"Time Between Attacks<br>(On same target)",select:{0:"none",3E5:"5 mins",9E5:"15 mins",18E5:"30 mins",36E5:"1 hour",72E5:"2 hours",216E5:"6 hours",432E5:"12 hours",864E5:"24 hours"},help:"Stop yourself from being as noticed, but may result in fewer attacks and slower advancement"},{id:"army",require:{type:"Invade"},label:"Target Army Ratio<br>(Only needed for Invade)",
select:["Any",0.5,0.6,0.7,0.8,0.9,1,1.1,1.2,1.3,1.4,1.5],help:"Smaller number for smaller target army. Reduce this number if you're losing in Invade"},{id:"level",require:{type:[["Invade"]]},label:"Target Level Ratio<br>(Mainly used for Duel)",select:["Any",0.5,0.6,0.7,0.8,0.9,1,1.1,1.2,1.3,1.4,1.5],help:"Smaller number for lower target level. Reduce this number if you're losing a lot"},{advanced:true,hr:true,title:"Preferred Targets"},{advanced:true,id:"preferonly",label:"Fight Preferred",select:["Never",
"Sometimes","Only","Until Dead"]},{advanced:true,id:"prefer",multiple:"userid"}];Battle.init=function(){this._watch(Monster);this.option.arena=false};
Battle.parse=function(){var d,e,f;if(Page.page==="battle_rank"){d={0:{name:"Newbie",points:0}};$('tr[height="23"]').each(function(h,g){h=$(g).text().regex(/Rank ([0-9]+) - (.*)\s*([0-9]+)/i);d[h[0]]={name:h[1],points:h[2]}});this.data.rank=d;this.data.bp=$('span:contains("Battle Points.")','div:contains("You are a Rank")').text().replace(/,/g,"").regex(/with ([0-9]+) Battle Points/i)}else if(Page.page==="battle_battle"){d=this.data.user;if(this.runtime.attacking){e=this.runtime.attacking;this.runtime.attacking=
null;if($("div.results").text().match(/You cannot battle someone in your army/i))delete d[e];else if($("div.results").text().match(/This trainee is too weak. Challenge someone closer to your level/i))delete d[e];else if($("div.results").text().match(/Your opponent is dead or too weak/i)){d[e].hide=(d[e].hide||0)+1;d[e].dead=Date.now()}else if($('img[src*="battle_victory"]').length){this.data.bp=$('span.result_body:contains("Battle Points.")').text().replace(/,/g,"").regex(/total of ([0-9]+) Battle Points/i);
d[e].win=(d[e].win||0)+1;d[e].last=Date.now();History.add("battle+win",1)}else if($('img[src*="battle_defeat"]').length){d[e].loss=(d[e].loss||0)+1;d[e].last=Date.now();History.add("battle+loss",-1)}else this.runtime.attacking=e}if(e=$("#app"+APPID+'_app_body table.layout table div div:contains("Once a day you can")').text().replace(/[^0-9\/]/g,"").regex(/([0-9]+)\/10([0-9]+)\/10([0-9]+)\/10([0-9]+)\/10([0-9]+)\/10/))this.data.points=e;f=Player.get("rank");$("#app"+APPID+"_app_body table.layout table table tr:even").each(function(h,
g){h=$('img[uid!==""]',g).attr("uid");var k=$("td.bluelink",g).text().replace(/[ \t\n]+/g," "),l=k.regex(/Battle:[^(]+\(Rank ([0-9]+)\)/i);if(!(!h||!k||Battle.option.bp==="Always"&&f-l>5||!Battle.option.bp==="Never"&&f-l<=5)){d[h]=d[h]||{};d[h].name=$("a",g).text().trim();d[h].level=k.regex(/\(Level ([0-9]+)\)/i);d[h].rank=l;d[h].war=k.regex(/War:[^(]+\(Rank ([0-9]+)\)/i);d[h].army=$("td.bluelink",g).next().text().regex(/([0-9]+)/);d[h].align=$('img[src*="graphics/symbol_"]',g).attr("src").regex(/symbol_([0-9])/i)}})}return false};
Battle.update=function(){var d,e,f=this.data.user,h=[],g=false,k=[],l=Player.get("army"),m=Player.get("level"),q=Player.get("rank"),o=0;k.push("Rank "+Player.get("rank")+" "+(Player.get("rank")&&this.data.rank[Player.get("rank")].name)+" with "+addCommas(this.data.bp||0)+" Battle Points, Targets: "+length(f)+" / "+this.option.cache);if(this.option.points)k.push('Demi Points Earned Today: <img src="'+this.symbol[1]+'" alt=" " title="'+this.demi[1]+'" style="width:11px;height:11px;"> '+(this.data.points[0]||
0)+'/10 <img src="'+this.symbol[2]+'" alt=" " title="'+this.demi[2]+'" style="width:11px;height:11px;"> '+(this.data.points[1]||0)+'/10 <img src="'+this.symbol[3]+'" alt=" " title="'+this.demi[3]+'" style="width:11px;height:11px;"> '+(this.data.points[2]||0)+'/10 <img src="'+this.symbol[4]+'" alt=" " title="'+this.demi[4]+'" style="width:11px;height:11px;"> '+(this.data.points[3]||0)+'/10 <img src="'+this.symbol[5]+'" alt=" " title="'+this.demi[5]+'" style="width:11px;height:11px;"> '+(this.data.points[4]||
0)+"/10");for(d in f)if(this.option.bp==="Always"&&q-(f[d].rank||0)>=4||!this.option.bp==="Never"&&q-(f[d].rank||6)<=5)delete f[d];if(length(f)>this.option.cache){h=[];for(d in f)h.push(d);for(h.sort(function(n,s){var p=0;if((f[n].win||0)-(f[n].loss||0)<(f[s].win||0)-(f[s].loss||0))p+=10;else if((f[n].win||0)-(f[n].loss||0)>(f[s].win||0)-(f[s].loss||0))p-=10;if(Battle.option.bp==="Always")p+=((f[s].rank||0)-(f[n].rank||0))/2;if(Battle.option.bp==="Never")p+=((f[n].rank||0)-(f[s].rank||0))/2;p+=Math.range(-1,
(f[s].hide||0)-(f[n].hide||0),1);p+=Math.range(-10,((f[n].army||0)-(f[s].army||0))/10,10);p+=Math.range(-10,((f[n].level||0)-(f[s].level||0))/10,10);return p});h.length>this.option.cache;)delete f[h.pop()]}g=this.option.points&&this.data.points&&sum(this.data.points)<50;if(!g&&this.option.monster&&(Monster.get("runtime.attack",false)||Monster.get("runtime.fortify",false))){this.runtime.attacking=null;k.push("Attacking Monsters")}else{if(!this.runtime.attacking||!f[this.runtime.attacking]||this.option.army!==
"Any"&&f[this.runtime.attacking].army/l>this.option.army||this.option.level!=="Any"&&f[this.runtime.attacking].level/m>this.option.level)this.runtime.attacking=null;h=[];for(e=0;e<this.option.prefer.length;e++){d=this.option.prefer[e];if(!/[^0-9]/g.test(d)){f[d]=f[d]||{};if(!(f[d].dead&&f[d].dead+3E5>=Date.now()||f[d].last&&f[d].last+this.option.between>=Date.now()||typeof this.option.losses==="number"&&(f[d].loss||0)-(f[d].win||0)>=this.option.losses||g&&(!f[d].align||this.data.points[f[d].align-
1]>=10))){h.push(d,d,d,d,d,d,d,d,d,d);o++}}}if(this.option.preferonly==="Never"||this.option.preferonly==="Sometimes"||this.option.preferonly==="Only"&&!this.option.prefer.length||this.option.preferonly==="Until Dead"&&!h.length)for(d in f)if(!(f[d].dead&&f[d].dead+18E5>=Date.now()||f[d].last&&f[d].last+this.option.between>=Date.now()||typeof this.option.losses==="number"&&(f[d].loss||0)-(f[d].win||0)>=this.option.losses||this.option.army!=="Any"&&(f[d].army||0)/l>this.option.army&&this.option.type===
"Invade"||this.option.level!=="Any"&&(f[d].level||0)/m>this.option.level&&this.option.type!=="Invade"||g&&(!f[d].align||this.data.points[f[d].align-1]>=10))){if(Battle.option.bp==="Always")for(e=Math.range(1,(f[d].rank||0)-q+1,5);e>0;e--)h.push(d);else h.push(d);o++}if(!this.runtime.attacking&&h.length)this.runtime.attacking=h[Math.floor(Math.random()*h.length)];if(this.runtime.attacking){d=this.runtime.attacking;k.push('Next Target: <img src="'+this.symbol[f[d].align]+'" alt=" " title="'+this.demi[f[d].align]+
'" style="width:11px;height:11px;"> '+f[d].name+" (Level "+f[d].level+" "+this.data.rank[f[d].rank].name+" with "+f[d].army+" army)"+(o?", "+o+" valid target"+plural(o):""))}else{this.runtime.attacking=null;k.push("No valid targets found");this._remind(60)}}Dashboard.status(this,k.join("<br>"))};
Battle.work=function(d){if(!this.runtime.attacking||Player.get("health")<13||Queue.burn.stamina<(this.option.type==="War"?10:1))return QUEUE_FINISH;if(!d||this.option.general&&!Generals.to(Generals.best(this.option.type))||!Page.to("battle_battle"))return QUEUE_CONTINUE;d=$('form input[alt="'+this.option.type+'"]').first().parents("form");if(d.length){log("Attacking "+this.data.user[this.runtime.attacking].name+" ("+this.runtime.attacking+")");$('input[name="target_id"]',d).attr("value",this.runtime.attacking);
Page.click($('input[type="image"]',d))}else{debug("Unable to find attack buttons, forcing reload");Page.to("index")}return QUEUE_RELEASE};Battle.rank=function(d){for(var e in Battle.data.rank)if(Battle.data.rank[e].name===d)return parseInt(e,10);return 0};Battle.order=[];
Battle.dashboard=function(d,e){var f,h=[0,0,0,0,0,0],g=[],k=[],l=["align","name","level","rank","army","win","loss","hide"],m=this.data.user,q=Player.get("army"),o=Player.get("level");for(f in m)h[m[f].align]++;if(typeof d==="undefined"){this.order=[];for(f in m)this.order.push(f)}if(typeof d==="undefined")d=this.runtime.sort||1;if(typeof e==="undefined")e=this.runtime.rev||false;this.runtime.sort=d;this.runtime.rev=e;typeof l[d]==="string"&&this.order.sort(function(n,s){n=m[n][l[d]]||0;s=m[s][l[d]]||
0;if(typeof n==="string"||typeof s==="string")return e?s>n:s<n;return e?n-s:s-n});g.push('<div style="text-align:center;"><strong>Rank:</strong> '+this.data.rank[Player.get("rank")].name+" ("+Player.get("rank")+"), <strong>Targets:</strong> "+length(m)+" / "+this.option.cache+", <strong>By Alignment:</strong>");for(f=1;f<6;f++)g.push(' <img src="'+this.symbol[f]+'" alt="'+this.demi[f]+'" title="'+this.demi[f]+'" style="width:11px;height:11px;"> '+h[f]);g.push("</div><hr>");th(k,"Align");th(k,"Name");
th(k,"Level");th(k,"Rank");th(k,"Army");th(k,"Wins");th(k,"Losses");th(k,"Hides");g.push('<table cellspacing="0" style="width:100%"><thead><tr>'+k.join("")+"</tr></thead><tbody>");for(f=0;f<this.order.length;f++){m=this.data.user[this.order[f]];k=[];td(k,'<img src="'+this.symbol[m.align]+'" alt="'+this.demi[m.align]+'">','title="'+this.demi[m.align]+'"');th(k,m.name,'title="'+this.order[f]+'"');td(k,this.option.level!=="Any"&&m.level/o>this.option.level?"<i>"+m.level+"</i>":m.level);td(k,this.data.rank[m.rank]?
this.data.rank[m.rank].name:"");td(k,this.option.army!=="Any"&&m.army/q>this.option.army?"<i>"+m.army+"</i>":m.army);td(k,m.win||"");td(k,m.loss||"");td(k,m.hide||"");tr(g,k.join(""))}g.push("</tbody></table>");$("#golem-dashboard-Battle").html(g.join(""));$("#golem-dashboard-Battle tbody tr td:nth-child(2)").css("text-align","left");if(typeof d!=="undefined")$("#golem-dashboard-Battle thead th:eq("+d+")").attr("name",e?"reverse":"sort").append("&nbsp;"+(e?"&uarr;":"&darr;"))};var Blessing=new Worker("Blessing");
Blessing.data=null;Blessing.defaults.castle_age={pages:"oracle_demipower"};Blessing.option={which:"Stamina",display:false};Blessing.runtime={when:0};Blessing.which=["None","Energy","Attack","Defense","Health","Stamina"];Blessing.display=[{id:"which",label:"Which",select:Blessing.which},{id:"display",label:"Display in Blessing info on *",checkbox:true}];
Blessing.parse=function(){var d=$("div.results"),e;if(d.length)if((e=d.text().regex(/Please come back in: ([0-9]+) hours and ([0-9]+) minutes/i))&&e.length)this.runtime.when=Date.now()+(e[0]*60+e[1]+1)*6E4;else if(d.text().match(/You have paid tribute to/i))this.runtime.when=Date.now()+8646E4;return false};
Blessing.update=function(){var d,e;if(this.option.display&&this.option.which!=="None"){d=new Date(this.runtime.when);switch(this.option.which){case "Energy":e="Ambrosia ("+this.option.which+")";break;case "Attack":e="Malekus ("+this.option.which+")";break;case "Defense":e="Corvintheus ("+this.option.which+")";break;case "Defense":e="Corvintheus ("+this.option.which+")";break;case "Health":e="Aurora ("+this.option.which+")";break;case "Stamina":e="Azeron ("+this.option.which+")";break;default:e="Unknown";
break}Dashboard.status(this,'<span title="Next Blessing">Next Blessing performed on '+d.format("l g:i a")+" to "+e+" </span>")}else Dashboard.status(this)};Blessing.work=function(d){if(!this.option.which||this.option.which==="None"||Date.now()<=this.runtime.when)return QUEUE_FINISH;if(!d||!Page.to("oracle_demipower"))return QUEUE_CONTINUE;Page.click("#app"+APPID+"_symbols_form_"+this.which.indexOf(this.option.which)+" input.imgButton");return QUEUE_RELEASE};var Elite=new Worker("Elite");
Elite.data={};Elite.defaults.castle_age={pages:"keep_eliteguard army_viewarmy"};Elite.option={every:12,armyperpage:25};Elite.runtime={armylastpage:1,armyextra:0,waitelite:0,nextelite:0};Elite.display=[{id:"elite",label:"Fill Elite Guard",checkbox:true},{id:"every",label:"Every",select:[1,2,3,6,12,24],after:"hours",help:"Although people can leave your Elite Guard after 24 hours, after 12 hours you can re-confirm them"},{id:"fill",label:"Fill Now",button:true}];
Elite.init=function(){if(length(this.data))for(var d in this.data){Army.set(["_info",d,"name"],this.data[d].name);Army.set(["_info",d,"level"],this.data[d].level);Army.set(["Army",d],true);this.data[d].elite&&Army.set([d,"elite"],this.data[d].elite)}this.data={};Army.section(this.name,{key:"Elite",name:"Elite",show:"Elite",label:function(e,f){return"Elite"in e[f]?("prefer"in e[f].Elite&&e[f].Elite.prefer?'<img src="'+Images.star_on+'">':'<img src="'+Images.star_off+'">')+("elite"in e[f].Elite&&e[f].Elite.elite?
' <img src="'+Images.timer+'" title="Member until: '+makeTime(e[f].Elite.elite)+'">':"")+("full"in e[f].Elite&&e[f].Elite.full?' <img src="'+Images.timer_red+'" title="Full until: '+makeTime(e[f].Elite.full)+'">':""):"Army"in e[f]&&e[f].Army?'<img src="'+Images.star_off+'">':""},sort:function(e,f){if(!("Elite"in e[f])&&!("Army"in e[f])&&!e[f].Army)return 0;return("prefer"in e[f].Elite&&e[f].Elite.prefer?Date.now():0)+("elite"in e[f].Elite?Date.now()-parseInt(e[f].Elite.elite):0)+("full"in e[f].Elite?
Date.now()-parseInt(e[f].Elite.full):0)},click:function(e,f){Army.get(["Elite",f,"prefer"],false)?Army.set(["Elite",f,"prefer"]):Army.set(["Elite",f,"prefer"],true);return true}});$("#"+Config.makeID(this,"fill")).live("click",function(){Elite.set("runtime.waitelite",0);Elite._save("runtime")})};
Elite.parse=function(){$("span.result_body").each(function(e,f){e=$(f).text();if(e.match(/Elite Guard, and they have joined/i)){Army.set([$("img",f).attr("uid"),"elite"],Date.now()+864E5);Elite.runtime.nextelite=null}else if(e.match(/'s Elite Guard is FULL!/i)){Army.set([$("img",f).attr("uid"),"full"],Date.now()+18E5);Elite.runtime.nextelite=null}else if(e.match(/YOUR Elite Guard is FULL!/i)){Elite.runtime.waitelite=Date.now();Elite.runtime.nextelite=null;debug("Elite guard full, wait "+Elite.option.every+
" hours")}});if(Page.page==="army_viewarmy"){var d=0;$('img[linked="true"][size="square"]').each(function(e,f){e=$(f).attr("uid");f=$(f).parent().parent().next();d++;Army.set(["Army",e],true);Army.set(["_info",e,"name"],$("a",f).text());Army.set(["_info",e,"level"],$(f).text().regex(/([0-9]+) Commander/i))});if(d<25)this.runtime.armyextra=Player.get("armymax")-length(this.data)-1}return false};
Elite.update=function(){var d,e,f=[],h=Date.now(),g;this.runtime.nextelite=0;if(Queue.enabled(this)){e=Army.get("Elite");for(d=0;d<e.length;d++){g=Army.get([e[d],"elite"],0);if(g<h&&Army.get([e[d],"full"],h)<h){Army.set([e[d],g?"elite":"full"]);if(Army.get([e[d],"prefer"],false)){this.runtime.nextelite=e[d];break}this.runtime.nextelite=this.runtime.nextelite||e[d]}}if(!this.runtime.nextelite){e=Army.get("Army");for(d=0;d<e.length;d++)if(!Army.get([e[d]],false)){this.runtime.nextelite=e[d];break}}g=
this.runtime.waitelite+this.option.every*36E5;f.push("Elite Guard: Check"+(g<h?"ing now":' in <span class="golem-time" name="'+g+'">'+makeTimer((g-h)/1E3)+"</span>")+(this.runtime.nextelite?", Next: "+Army.get(["_info",this.runtime.nextelite,"name"]):""))}Dashboard.status(this,f.join("<br>"))};
Elite.work=function(d){if(Math.ceil((Player.get("armymax")-this.runtime.armyextra-1)/this.option.armyperpage)>this.runtime.armylastpage){if(d){debug("Filling army list");this.runtime.armylastpage=Math.max(this.runtime.armylastpage+1,Math.ceil((length(Army.get("Army"))+1)/this.option.armyperpage));Page.to("army_viewarmy","?page="+this.runtime.armylastpage)}return true}if(!this.option.elite||!this.runtime.nextelite||this.runtime.waitelite+this.option.every*36E5>Date.now())return false;if(!d)return true;
if(!this.runtime.nextelite&&!length(Army.get("Army"))&&!Page.to("army_viewarmy"))return true;if(this.runtime.waitelite+this.option.every*36E5<=Date.now()){debug("Add "+Army.get(["_info",this.runtime.nextelite,"name"],this.runtime.nextelite)+" to Elite Guard");if(!Page.to("keep_eliteguard","?twt=jneg&jneg=true&user="+this.runtime.nextelite))return true}return false};var Generals=new Worker("Generals");Generals.option=null;Generals.data={};Generals.defaults.castle_age={pages:"* heroes_generals"};
Generals.runtime={disabled:false};Generals.init=function(){for(var d in this.data)d.indexOf("\t")!==-1&&delete this.data[d];if(!Player.get("attack")||!Player.get("defense"))this._watch(Player);this._watch(Town)};
Generals.parse=function(){$("div.results").text().match(/has gained a level!/i)&&this.data[Player.get("general")].level++;if(Page.page==="heroes_generals"){var d=$(".generalSmallContainer2"),e=this.data,f="";$('div.generalContainerBox div:contains("Item Bonuses")').nextAll().each(function(){var g=$("img",this).attr("title");if(g&&g.indexOf("[not owned]")==-1){if(f.length)f+=", ";f+=g.replace(/\<[^>]*\>|\s+|\n/g," ").trim()}});var h=$("div.general_name_div3").first().text().trim();if(e[h])e[h].weaponbonus=
f;if(d.length<length(e)){debug("Different number of generals, have "+d.length+", want "+length(e));return false}d.each(function(g,k){g=$(".general_name_div3_padding",k).text().trim();var l=parseInt($(k).text().regex(/Level ([0-9]+)/i)),m=parseInt($("div.generals_indv_stats",k).next().children().children().children().next().attr("style").regex(/width: ([0-9]*\.*[0-9]*)%/i));if(g&&g.indexOf("\t")===-1&&g.length<30)if(!e[g]||e[g].level!==l||e[g].progress!==m){e[g]=e[g]||{};e[g].img=$(".imgButton",k).attr("src").filepart();
e[g].att=$(".generals_indv_stats_padding div:eq(0)",k).text().regex(/([0-9]+)/);e[g].def=$(".generals_indv_stats_padding div:eq(1)",k).text().regex(/([0-9]+)/);e[g].progress=m;e[g].level=l;e[g].skills=$("table div",k).html().replace(/\<[^>]*\>|\s+|\n/g," ").trim();l>=4&&e[g].priority&&delete e[g].priority}})}return false};
Generals.update=function(d,e){var f=this.data,h,g=[],k=[],l=Town.get("runtime.invade"),m=Town.get("runtime.duel"),q,o,n,s,p,r,u,t,v=q=o=0,y=1,w,x,z=function(A,B){A.push(B)};if(!d||d==="data"){for(h in Generals.data)k.push(h);Config.set("generals",["any"].concat(k.sort()));Config.set("bestgenerals",["any","Best","Under Level 4"].concat(k))}for(h in f)f[h].level<4&&g.push([h,f[h].priority]);g.sort(function(A,B){return A[1]-B[1]});for(h in g)f[g[h][0]].priority=parseInt(h)+1;this.runtime.max_priority=
g.length;if((d==="data"||e===Town||e===Player)&&l&&m){e===Player&&Player.get("attack")&&Player.get("defense")&&this._unwatch(Player);for(h in f){g=f[h].skills+(f[h].weaponbonus||"");q=Math.floor(sum(g.regex(/([-+]?[0-9]*\.?[0-9]*) Player Attack|Increase Player Attack by ([0-9]+)|Convert ([-+]?[0-9]*\.?[0-9]*) Attack/i))+(f[h].skills.regex(/Increase ([-+]?[0-9]*\.?[0-9]*) Player Attack for every Hero Owned/i)||0)*(length(f)-1));o=Math.floor(sum(g.regex(/([-+]?[0-9]*\.?[0-9]*) Player Defense|Increase Player Defense by ([0-9]+)/i))+
(f[h].skills.regex(/Increase ([-+]?[0-9]*\.?[0-9]*) Player Defense for every Hero Owned/i)||0)*(length(f)-1));d=Player.get("attack")+q;e=Player.get("defense")+o;k=Player.get("attack")+q*4/f[h].level;r=Player.get("defense")+o*4/f[h].level;n=Math.min(Player.get("armymax"),g.regex(/Increases? Army Limit to ([0-9]+)/i)||501);s=getAttDef(f,z,"att",Math.floor(n/5));p=getAttDef(f,z,"def",Math.floor(n/5));o=g.regex(/Increase Player Attack when Defending by ([-+]?[0-9]+)/i)||0;q=g.regex(/([-+]?[0-9]+) Defense when attacked/i)||
0;u=o*4/f[h].level;t=q*4/f[h].level;v=g.regex(/([-+]?[0-9]+) Monster attack/i)||0;y=1+(g.regex(/([-+]?[0-9]+)% Critical/i)||0)/100;w=f[h].att+parseInt(f[h].skills.regex(/'s Attack by ([-+]?[0-9]+)/i)||0)+(typeof f[h].weaponbonus!=="undefined"?parseInt(f[h].weaponbonus.regex(/([-+]?[0-9]+) attack/i)||0):0);x=f[h].def+(typeof f[h].weaponbonus!=="undefined"?parseInt(f[h].weaponbonus.regex(/([-+]?[0-9]+) defense/i)||0):0);f[h].invade={att:Math.floor(l.attack+w+x*0.7+(d+e*0.7)*n+s),def:Math.floor(l.defend+
x+w*0.7+(e+q+(d+o)*0.7)*n+p)};f[h].duel={att:Math.floor(m.attack+w+x*0.7+d+e*0.7),def:Math.floor(m.defend+x+w*0.7+e+q+(d+o)*0.7)};f[h].monster={att:Math.floor(y*(m.attack+w+d+v)),def:Math.floor(m.defend+x+e)};f[h].potential={bank:g.regex(/Bank Fee/i)?1:0,defense:Math.floor(m.defend+(f[h].def+4-f[h].level)+(f[h].att+4-f[h].level)*0.7+r+t+(k+u)*0.7),income:g.regex(/Increase Income by ([0-9]+)/i)*4/f[h].level,invade:Math.floor(l.attack+(f[h].att+4-f[h].level)+(f[h].def+4-f[h].level)*0.7+(k+r*0.7)*n+
s),duel:Math.floor(m.attack+(f[h].att+4-f[h].level)+(f[h].def+4-f[h].level)*0.7+k+r*0.7),monster:Math.floor(m.attack+(f[h].att+4-f[h].level)+k+v*4/f[h].level),raid_invade:0,raid_duel:0,influence:g.regex(/Influence ([0-9]+)% Faster/i)||0,drops:g.regex(/Chance ([0-9]+)% Drops/i)||0,demi:g.regex(/Extra Demi Points/i)?1:0,cash:g.regex(/Bonus ([0-9]+) Gold/i)||0};f[h].potential.raid_invade=f[h].potential.defense+f[h].potential.invade;f[h].potential.raid_duel=f[h].potential.defense+f[h].potential.duel}}};
Generals.to=function(d){if(this.runtime.disabled)return true;this._unflush();if(d&&!this.data[d])d=this.best(d);if(!d||Player.get("general")===d||/any/i.test(d))return true;if(!d||!this.data[d]){log('General "'+d+'" requested but not found!');return true}if(!Page.to("heroes_generals"))return false;debug("Changing to General "+d);Page.click('input[src$="'+this.data[d].img+'"]');this.data[d].used=(this.data[d].used||0)+1;return false};
Generals.best=function(d){this._unflush();var e="",f=null,h=0,g;e=Player.get("general");if("Caap"in Workers){var k={BuyGeneral:"cost",LevelUpGeneral:"stamina",IncomeGeneral:"income",SubQuestGeneral:"influence",MonsterGeneral:"cash",BankingGeneral:"bank",BattleGeneral:"invade",MonsterGeneral:"monster",FortifyGeneral:"dispel",IdleGeneral:"defense"};if(k[d]){var l=gm.getValue(d,"best");if(/under level 4/i.test(l))d="under level 4";else if(/use current/i.test(l))return"any";else if(/^best$/i.test(l))d=
k[d];else return l}}switch(d.toLowerCase()){case "cost":e=/Decrease Soldier Cost by ([0-9]+)/i;break;case "stamina":e=/Increase Max Stamina by ([0-9]+)|\+([0-9]+) Max Stamina/i;break;case "energy":e=/Increase Max Energy by ([0-9]+)|\+([0-9]+) Max Energy/i;break;case "income":e=/Increase Income by ([0-9]+)/i;break;case "item":e=/([0-9]+)% Drops for Quest/i;break;case "influence":e=/Bonus Influence ([0-9]+)/i;break;case "defense":e=/([-+]?[0-9]+) Player Defense/i;break;case "cash":e=/Bonus ([0-9]+) Gold/i;
break;case "bank":return"Aeris";case "invade":for(g in this.data)if(!f||this.data[g].invade&&this.data[g].invade.att>this.data[f].invade.att||this.data[g].invade&&this.data[g].invade.att===this.data[f].invade.att&&f!==e)f=g;return f||"any";case "duel":for(g in this.data)if(!f||this.data[g].duel&&this.data[g].duel.att>this.data[f].duel.att||this.data[g].duel&&this.data[g].duel.att===this.data[f].duel.att&&f!==e)f=g;return f||"any";case "raid-invade":for(g in this.data)if(!f||this.data[g].invade&&this.data[g].invade.att>
this.data[f].invade.att)f=g;return f||"any";case "raid-duel":for(g in this.data)if(!f||this.data[g].duel&&this.data[g].duel.att>this.data[f].duel.att)f=g;return f||"any";case "monster":for(g in this.data)if(!f||this.data[g].monster&&this.data[g].monster.att>this.data[f].monster.att)f=g;return f||"any";case "attack":for(g in this.data)if(!f||this.data[g].monster&&this.data[g].monster.att>this.data[f].monster.att)f=g;return f||"any";case "dispel":case "fortify":for(g in this.data)if(!f||this.data[g].monster&&
this.data[g].monster.def>this.data[f].monster.def)f=g;return f||"any";case "defend":for(g in this.data)if(!f||this.data[g].duel&&this.data[g].duel.def>this.data[f].duel.def||this.data[g].duel.def===this.data[f].duel.def&&f!==e)f=g;return f||"any";case "under level 4":for(g in this.data)if(this.data[g].priority==1)return g;default:return"any"}for(g in this.data)if(d=this.data[g].skills.regex(e))if(!f||d>h){f=g;h=d}return f||"any"};Generals.order=[];
Generals.dashboard=function(d,e){var f,h,g=[],k=[],l=0,m=0,q=0,o=0,n=0,s=0;if(typeof d==="undefined"){Generals.order=[];for(f in Generals.data)Generals.order.push(f)}if(typeof d==="undefined")d=this.runtime.sort||1;if(typeof e==="undefined")e=this.runtime.rev||false;this.runtime.sort=d;this.runtime.rev=e;typeof d!=="undefined"&&Generals.order.sort(function(p,r){var u,t;if(d==1){p=p;r=r}else if(d==2){p=Generals.data[p].level||0;r=Generals.data[r].level||0}else if(d==3){p=Generals.data[p].priority||
999999;r=Generals.data[r].priority||999999}else{u=d<6?"invade":d<8?"duel":"monster";t=d%2?"def":"att";p=Generals.data[p][u][t]||0;r=Generals.data[r][u][t]||0}if(typeof p==="string"||typeof r==="string")return e?r>p:r<p;return e?p-r:r-p});for(f in Generals.data){l=Math.max(l,Generals.data[f].invade?Generals.data[f].invade.att:1);m=Math.max(m,Generals.data[f].invade?Generals.data[f].invade.def:1);q=Math.max(q,Generals.data[f].duel?Generals.data[f].duel.att:1);o=Math.max(o,Generals.data[f].duel?Generals.data[f].duel.def:
1);n=Math.max(n,Generals.data[f].monster?Generals.data[f].monster.att:1);s=Math.max(s,Generals.data[f].monster?Generals.data[f].monster.def:1)}k.push('<table cellspacing="0" style="width:100%"><thead><tr><th></th><th>General</th><th>Level</th><th>Quest<br>Rank</th><th>Invade<br>Attack</th><th>Invade<br>Defend</th><th>Duel<br>Attack</th><th>Duel<br>Defend</th><th>Monster<br>Attack</th><th>Fortify<br>Dispel</th></tr></thead><tbody>');for(h=0;h<Generals.order.length;h++){f=Generals.order[h];g=[];g.push('<img src="'+
imagepath+Generals.data[f].img+'" style="width:25px;height:25px;" title="Skills: '+Generals.data[f].skills+", Weapon Bonus: "+(typeof Generals.data[f].weaponbonus!=="unknown"?Generals.data[f].weaponbonus?Generals.data[f].weaponbonus:"none":"unknown")+'">');g.push(f);g.push("<div"+(isNumber(Generals.data[f].progress)?' title="'+Generals.data[f].progress+'%"':"")+">"+Generals.data[f].level+'</div><div style="background-color: #9ba5b1; height: 2px; width=100%;"><div style="background-color: #1b3541; float: left; height: 2px; width: '+
(Generals.data[f].progress||0)+'%;"></div></div>');g.push(Generals.data[f].priority?(Generals.data[f].priority!=1?'<a class="golem-moveup" name='+Generals.data[f].priority+">&uarr</a> ":"&nbsp;&nbsp; ")+Generals.data[f].priority+(Generals.data[f].priority!=this.runtime.max_priority?' <a class="golem-movedown" name='+Generals.data[f].priority+">&darr</a>":" &nbsp;&nbsp;"):"");g.push(Generals.data[f].invade?(l==Generals.data[f].invade.att?"<strong>":"")+addCommas(Generals.data[f].invade.att)+(l==Generals.data[f].invade.att?
"</strong>":""):"?");g.push(Generals.data[f].invade?(m==Generals.data[f].invade.def?"<strong>":"")+addCommas(Generals.data[f].invade.def)+(m==Generals.data[f].invade.def?"</strong>":""):"?");g.push(Generals.data[f].duel?(q==Generals.data[f].duel.att?"<strong>":"")+addCommas(Generals.data[f].duel.att)+(q==Generals.data[f].duel.att?"</strong>":""):"?");g.push(Generals.data[f].duel?(o==Generals.data[f].duel.def?"<strong>":"")+addCommas(Generals.data[f].duel.def)+(o==Generals.data[f].duel.def?"</strong>":
""):"?");g.push(Generals.data[f].monster?(n==Generals.data[f].monster.att?"<strong>":"")+addCommas(Generals.data[f].monster.att)+(n==Generals.data[f].monster.att?"</strong>":""):"?");g.push(Generals.data[f].monster?(s==Generals.data[f].monster.def?"<strong>":"")+addCommas(Generals.data[f].monster.def)+(s==Generals.data[f].monster.def?"</strong>":""):"?");k.push("<tr><td>"+g.join("</td><td>")+"</td></tr>")}k.push("</tbody></table>");$("a.golem-moveup").live("click",function(){var p=null,r=null,u=parseInt($(this).attr("name"));
Generals._unflush();for(var t in Generals.data){if(Generals.data[t].priority==u)r=t;if(Generals.data[t].priority==u-1)p=t}if(p&&r){debug("Priority: Swapping "+r+" with "+p);Generals.data[p].priority++;Generals.data[r].priority--}Generals.dashboard(d,e);return false});$("a.golem-movedown").live("click",function(){var p=null,r=null,u=parseInt($(this).attr("name"));Generals._unflush();for(var t in Generals.data){if(Generals.data[t].priority==u)p=t;if(Generals.data[t].priority==u+1)r=t}if(p&&r){debug("Priority: Swapping "+
r+" with "+p);Generals.data[p].priority++;Generals.data[r].priority--}Generals.dashboard(d,e);return false});$("#golem-dashboard-Generals").html(k.join(""));$("#golem-dashboard-Generals tbody tr td:nth-child(2)").css("text-align","left");if(typeof d!=="undefined")$("#golem-dashboard-Generals thead th:eq("+d+")").attr("name",e?"reverse":"sort").append("&nbsp;"+(e?"&uarr;":"&darr;"))};var Gift=new Worker("Gift");Gift.settings={keep:true};Gift.defaults.castle_age={pages:"* index army_invite army_gifts gift_accept"};
Gift.data={received:[],todo:{},gifts:{}};Gift.option={type:"None"};Gift.runtime={work:false,gift_waiting:false,gift_sent:0,sent_id:null,gift:{sender_id:null,sender_ca_name:null,sender_fb_name:null,name:null,id:null}};Gift.display=[{label:"Work in progress..."},{id:"type",label:"Return Gifts",select:["None","Random","Same as Received"]}];
Gift.init=function(){delete this.data.uid;delete this.data.lastgift;if(length(this.data.gifts)){var d=[];for(var e in this.data.gifts)d.push(e);for(var f in this.data.todo)if(!/[^0-9]/g.test(f)){e=Math.floor(Math.random()*d.length);this.data.todo[d[e]]||(this.data.todo[d[e]]=[]);this.data.todo[d[e]].push(f);delete this.data.todo[f]}}};
Gift.parse=function(d){if(d)return false;var e=this.data.gifts;d=this.data.todo;var f=this.data.received;if(Page.page==="index")if($("span.result_body").text().indexOf("has sent you a gift")>=0){this.runtime.gift.sender_ca_name=$("span.result_body").text().regex(/[\t\n]*(.+) has sent you a gift/i);this.runtime.gift.name=$("span.result_body").text().regex(/has sent you a gift:\s+(.+)!/i);this.runtime.gift.id=$("span.result_body img").attr("src").filepart();debug(this.runtime.gift.sender_ca_name+" has a "+
this.runtime.gift.name+" waiting for you. ("+this.runtime.gift.id+")");return this.runtime.gift_waiting=true}else{if($("span.result_body").text().indexOf("warrior wants to join your Army")>=0){this.runtime.gift.sender_ca_name="A Warrior";this.runtime.gift.name="Random Soldier";this.runtime.gift.id="random_soldier";debug(this.runtime.gift.sender_ca_name+" has a "+this.runtime.gift.name+" waiting for you.");return this.runtime.gift_waiting=true}}else if(Page.page==="army_invite"){if(this.runtime.gift.sender_id)if($("div.game").text().indexOf("accepted the gift")>=
0||$("div.game").text().indexOf("have been awarded the gift")>=0){debug("Accepted "+this.runtime.gift.name+" from "+this.runtime.gift.sender_ca_name+"(id:"+this.runtime.gift.sender_id+")");f.push(this.runtime.gift);this.runtime.work=true;this.runtime.gift={}}if($("div.messages").text().indexOf("gift")>=0){this.runtime.gift_waiting=true;if(!this.runtime.gift.id)return false;this.runtime.gift.sender_id=$("div.messages img[uid]").first().attr("uid");if(this.runtime.gift.sender_id)this.runtime.gift.sender_fb_name=
$("div.messages img[uid]").first().attr("title");else log("Can't find the gift sender's ID.")}else{this.runtime.gift_waiting=false;this.runtime.gift={}}}else if(Page.page==="gift_accept"){if(this.runtime.sent_id&&$("div#app"+APPID+"_results_main_wrapper").text().indexOf("You have sent")>=0){debug(e[this.runtime.sent_id].name+" sent.");for(j=d[this.runtime.sent_id].length-1;j>=Math.max(d[this.runtime.sent_id].length-30,0);j--)d[this.runtime.sent_id].pop();d[this.runtime.sent_id].length||delete d[this.runtime.sent_id];
this.runtime.sent_id=null;if(d.length==0)this.runtime.work=false}}else if(Page.page==="army_gifts"){this.data.gifts={};e=this.data.gifts;$('div[id*="_giftContainer"] div[id*="_gift"]').each(function(h,g){h=$("img",g).attr("src").filepart();var k=$(g).text().trim().replace("!","");g=$(g).attr("id").regex(/_gift([0-9]+)/);e[h]={};e[h].name=k;e[h].slot=g})}else if($("div.result").text().indexOf("have exceed")!==-1){debug("We have run out of gifts to send.  Waiting one hour to retry.");this.runtime.gift_delay=
Date.now()+36E5}return false};
Gift.work=function(d){if(length(h)&&this.runtime.gift_delay<Date.now())return this.runtime.work=true;if(!d){if(this.runtime.gift_waiting||this.runtime.work)return true;return false}if(!this.runtime.gift_waiting&&!this.runtime.work)return false;if(this.runtime.gift_waiting&&!this.runtime.gift.id)if(!Page.to("index"))return true;if(this.runtime.gift.id&&!this.runtime.gift.sender_id)if(!Page.to("army_invite"))return true;if(this.runtime.gift.sender_id){if(!Page.to("army_invite"))return true;if(!Page.to("army_invite",
"?act=acpt&rqtp=gift&uid="+this.runtime.gift.sender_id)||this.runtime.gift.sender_id.length>0)return true}var e,f,h=this.data.todo;d=this.data.received;var g=[],k;if(!d.length&&(!length(h)||this.runtime.gift_delay>Date.now())){this.runtime.work=false;Page.to("keep_alchemy");return false}if(d.length){Page.to("army_gifts");for(e=d.length-1;e>=0;e--){g=this.option.type;if(typeof this.data.gifts[d[e].id]==="undefined"&&this.option.type!="None"){debug(d[e].id+" was not found in our sendable gift list.");
g="Random"}switch(g){case "Random":if(length(this.data.gifts)){g=[];for(f in this.data.gifts)g.push(f);k=Math.floor(Math.random()*g.length);debug("Will randomly send a "+this.data.gifts[g[k]].name+" to "+d[e].sender_ca_name);h[g[k]]||(h[g[k]]=[]);h[g[k]].push(d[e].sender_id)}this.runtime.work=true;break;case "Same as Received":debug("Will return a "+d[e].name+" to "+d[e].sender_ca_name);h[d[e].id]||(h[d[e].id]=[]);h[d[e].id].push(d[e].sender_id);this.runtime.work=true;break;case "None":default:this.runtime.work=
false;break}d.pop()}}if(this.runtime.gift_sent>Date.now()){if($('div.dialog_buttons input[name="sendit"]').length){this.runtime.gift_sent=null;Page.click('div.dialog_buttons input[name="sendit"]')}else if($('span:contains("Out of requests")').text().indexOf("Out of requests")>=0){debug("We have run out of gifts to send.  Waiting one hour to retry.");this.runtime.gift_delay=Date.now()+36E5;Page.click('div.dialog_buttons input[name="ok"]')}return true}else if(this.runtime.gift_sent)this.runtime.gift_sent=
null;if($('div.dialog_buttons input[name="skip_ci_btn"]').length){Page.click('div.dialog_buttons input[name="skip_ci_btn"]');return true}if(length(h)&&(!this.runtime.gift_delay||this.runtime.gift_delay<Date.now()))for(e in h)if(typeof this.data.gifts[e]==="undefined")for(f in this.data.gifts){if(this.data.gifts[f].slot==1){h[f]=typeof h[f]==="undefined"?h[e]:h[f].concat(h[e]);delete h[e];break}}else{if(!Page.to("army_gifts","?app_friends=c&giftSelection="+this.data.gifts[e].slot,true))return true;
if(typeof this.data.gifts[e]==="undefined"){g=[];for(f in this.data.gifts)g.push(f);k=Math.floor(Math.random()*g.length);debug("Unavaliable gift ("+e+") found in todo list. Will randomly send a "+this.data.gifts[g[k]].name+" instead.");h[g[k]]||(h[g[k]]=[]);for(f in h[e])h[g[k]].push(h[e][f]);delete h[e];return true}if($('div[style*="giftpage_select"] div a[href*="giftSelection='+this.data.gifts[e].slot+'"]').length)if($('img[src*="gift_invite_castle_on"]').length){if($("div.unselected_list").children().length){debug("Sending out "+
this.data.gifts[e].name);d=0;for(f=h[e].length-1;f>=0;f--)if(d<30)if($("div.unselected_list input[value='"+h[e][f]+"']").length){Page.click('div.unselected_list input[value="'+h[e][f]+'"]');d++}if(d==0){delete h[e];return true}this.runtime.sent_id=e;this.runtime.gift_sent=Date.now()+6E4;Page.click('input[name="send"]')}}else $('div.tabBtn img.imgButton[src*="gift_invite_castle_off"]').length&&Page.click('div.tabBtn img.imgButton[src*="gift_invite_castle_off"]');else $('div[style*="giftpage_select"]').length&&
Page.click('a[href*="giftSelection='+this.data.gifts[e].slot+'"]:parent');return true}return false};var Heal=new Worker("Heal");Heal.data=null;Heal.defaults.castle_age={};Heal.option={stamina:0,health:0};Heal.display=[{id:"stamina",label:"Heal Above",after:"stamina",select:"stamina"},{id:"health",label:"...And Below",after:"health",select:"health"}];
Heal.work=function(d){if(Player.get("health")>=Player.get("maxhealth")||Player.get("stamina")<Heal.option.stamina||Player.get("health")>=Heal.option.health)return QUEUE_FINISH;if(!d||this.me())return QUEUE_CONTINUE;return QUEUE_RELEASE};Heal.me=function(){if(!Page.to("keep_stats"))return true;debug("Healing...");$('input[value="Heal Wounds"]').length?Page.click('input[value="Heal Wounds"]'):log("Danger Danger Will Robinson... Unable to heal!");return false};var Idle=new Worker("Idle");
Idle.defaults.castle_age={};Idle.settings={after:["LevelUp"]};Idle.data=null;Idle.option={general:"any",index:"Daily",alchemy:"Daily",quests:"Never",town:"Never",battle:"Quarterly",monsters:"Hourly",collect:"Never"};Idle.when=["Never","Quarterly","Hourly","2 Hours","6 Hours","12 Hours","Daily","Weekly"];
Idle.display=[{label:"<strong>NOTE:</strong> Any workers below this will <strong>not</strong> run!<br>Use this for disabling workers you do not use."},{id:"general",label:"Idle General",select:"generals"},{label:"Check Pages:"},{id:"index",label:"Home Page",select:Idle.when},{id:"alchemy",label:"Alchemy",select:Idle.when},{id:"quests",label:"Quests",select:Idle.when},{id:"town",label:"Town",select:Idle.when},{id:"battle",label:"Battle",select:Idle.when},{id:"monsters",label:"Monsters",select:Idle.when},
{id:"collect",label:"Apprentice Reward",select:Idle.when}];
Idle.work=function(d){if(!d)return true;var e,f,h={index:["index"],alchemy:["keep_alchemy"],quests:["quests_quest1","quests_quest2","quests_quest3","quests_quest4","quests_quest5","quests_quest6","quests_quest7","quests_quest8","quests_demiquests","quests_atlantis"],town:["town_soldiers","town_blacksmith","town_magic","town_land"],battle:["battle_battle"],monsters:["keep_monster","battle_raid"],collect:["apprentice_collect"]},g={Never:0,Quarterly:9E5,Hourly:36E5,"2 Hours":72E5,"6 Hours":216E5,"12 Hours":432E5,
Daily:864E5,Weekly:6048E5};if(!Generals.to(this.option.general))return true;for(e in h)if(g[this.option[e]]){f=Date.now()-g[this.option[e]];for(d=0;d<h[e].length;d++)if(!Page.get(h[e][d])||Page.get(h[e][d])<f)if(!Page.to(h[e][d])){Page.set(h[e][d],Date.now());return true}}return true};var Income=new Worker("Income");Income.data=null;Income.settings={important:true};Income.defaults.castle_age={};Income.option={general:true,bank:true,margin:45};
Income.display=[{id:"general",label:"Use Best General",checkbox:true},{id:"bank",label:"Automatically Bank",checkbox:true},{advanced:true,id:"margin",label:"Safety Margin",select:[15,30,45,60],suffix:"seconds"}];
Income.work=function(d){if(!Income.option.margin||!this.option.general)return QUEUE_FINISH;if(Player.get("cash_timer")>this.option.margin){if(d&&this.option.bank)return Bank.work(true);return QUEUE_FINISH}if(!d||!Generals.to("income"))return QUEUE_CONTINUE;debug("Waiting for Income... ("+Player.get("cash_timer")+" seconds)");return QUEUE_CONTINUE};var Land=new Worker("Land");Land.defaults.castle_age={pages:"town_land"};Land.option={enabled:true,onlyten:false,sell:false,land_exp:false,style:0};
Land.runtime={lastlevel:0,best:null,buy:0,cost:0};Land.display=[{id:"enabled",label:"Auto-Buy Land",checkbox:true},{advanced:true,id:"sell",label:"Sell Extra Land",checkbox:true,help:"You can sell land above your Max at full price."},{exploit:true,id:"land_exp",label:"Sell Extra Land 10 at a time",checkbox:true,help:"If you have extra lands, this will sell 10x.  The extra sold lands will be repurchased at a lower cost."},{id:"style",label:"ROI Style",select:{0:"Percent",1:"Daily"},help:"This changes the display when visiting the LanD page."}];
Land.init=function(){this._watch(Bank)};
Land.parse=function(d){$("tr.land_buy_row,tr.land_buy_row_unique").each(function(e,f){e=$("img",f).attr("alt");var h;if(d)$(".land_buy_info strong:first",f).after(' (<span title="Return On Investment - higher is better"><strong>ROI</strong>: '+(Land.data[e].income*100*(Land.option.style?24:1)/Land.data[e].cost).round(3)+"%"+(Land.option.style?" / Day":"")+"</span>)");else{!$(".land_buy_image_int",f).length&&$(".land_buy_image",f).prepend('<div class="land_buy_image_int"></div>').children(".land_buy_image_int").append($('.land_buy_image >[class!="land_buy_image_int"]',f));
!$(".land_buy_info_int",f).length&&$(".land_buy_info",f).prepend('<div class="land_buy_info_int"></div>').children(".land_buy_info_int").append($('.land_buy_info >[class!="land_buy_info_int"]',f));Land.data[e]={};Land.data[e].income=$(".land_buy_info .gold",f).text().replace(/[^0-9]/g,"").regex(/([0-9]+)/);Land.data[e].max=$(".land_buy_info",f).text().regex(/Max Allowed For your level: ([0-9]+)/i);Land.data[e].cost=$(".land_buy_costs .gold",f).text().replace(/[^0-9]/g,"").regex(/([0-9]+)/);if(h=$("option",
$(".land_buy_costs .gold",f).parent().next()).last().attr("value"))Land.data[e].buy=h;Land.data[e].own=$(".land_buy_costs span",f).text().replace(/[^0-9]/g,"").regex(/([0-9]+)/)}});return true};
Land.update=function(){var d,e=Bank.worth(),f=Player.get("income")+History.get("income.mean"),h,g=0;if(this.option.land_exp){$("input:golem(land,sell)").attr("checked",true);this.option.sell=true}for(d in this.data){if(this.option.sell&&this.data[d].own>this.data[d].max){h=d;g=this.data[d].max-this.data[d].own;if(this.option.land_exp)g=-10;break}if(this.data[d].buy)if(!h||this.data[h].cost/f+this.data[d].cost/(f+this.data[h].income)>this.data[d].cost/f+this.data[h].cost/(f+this.data[d].income))h=
d}if(h){if(!g){d=this.data[h].cost/(10+this.data[h].own)/this.data[h].income;d*=1.5;g=this.data[h].cost*10<=e?Math.min(this.data[h].max-this.data[h].own,10):this.data[h].cost/f>d?1:this.data[h].cost*5/f>d?Math.min(this.data[h].max-this.data[h].own,5):Math.min(this.data[h].max-this.data[h].own,10)}this.runtime.buy=g;this.runtime.cost=g*this.data[h].cost;Dashboard.status(this,(g>0?this.runtime.buy?"Buying ":"Want to buy ":this.runtime.buy?"Selling ":"Want to sell ")+Math.abs(g)+"x "+h+" for $"+addCommas(Math.abs(this.runtime.cost))+
" (Cash in bank: $"+addCommas(Player.get("bank"))+")")}else Dashboard.status(this);this.runtime.best=h};
Land.work=function(d){if(!this.option.enabled||!this.runtime.best||!this.runtime.buy||!Bank.worth(this.runtime.cost)){if(!this.runtime.best&&this.runtime.lastlevel<Player.get("level")){if(!d||!Page.to("town_land"))return QUEUE_CONTINUE;this.runtime.lastlevel=Player.get("level")}return QUEUE_FINISH}if(!d||!Bank.retrieve(this.runtime.cost)||!Page.to("town_land"))return QUEUE_CONTINUE;$("tr.land_buy_row,tr.land_buy_row_unique").each(function(e,f){if($("img",f).attr("alt")===Land.runtime.best){Land.runtime.buy>
0?$("select",$(".land_buy_costs .gold",f).parent().next()).val(Land.runtime.buy>5?10:Land.runtime.buy>1?5:1):$("select",$(".land_buy_costs .gold",f).parent().parent().next()).val(Land.runtime.buy<=-10?10:Land.runtime.buy<=-5?5:1);debug((Land.runtime.buy>0?"Buy":"Sell")+"ing "+Math.abs(Land.runtime.buy)+" x "+Land.runtime.best+" for $"+addCommas(Math.abs(Land.runtime.cost)));Page.click($('.land_buy_costs input[name="'+(Land.runtime.buy>0?"Buy":"Sell")+'"]',f))}});return QUEUE_RELEASE};
var LevelUp=new Worker("LevelUp");LevelUp.data=null;LevelUp.settings={before:["Idle","Battle","Monster","Quest"]};LevelUp.defaults.castle_age={pages:"*"};LevelUp.option={enabled:false,income:true,bank:true,general:"any",order:"stamina",algorithm:"Per Action"};LevelUp.runtime={level:0,heal_me:false,battle_monster:false,old_quest:null,old_quest_energy:0,running:false,energy:0,stamina:0,exp:0,exp_possible:0,energy_samples:0,exp_per_energy:1,stamina_samples:0,exp_per_stamina:1,quests:[]};
LevelUp.display=[{title:"Important!",label:"This will spend Energy and Stamina to force you to level up quicker."},{id:"enabled",label:"Enabled",checkbox:true},{id:"income",label:"Allow Income General",checkbox:true},{id:"bank",label:"Allow Bank General",checkbox:true},{id:"general",label:"Best General",select:["any","Energy","Stamina"],help:"Select which type of general to use when leveling up."},{id:"order",label:"Spend first ",select:["Energy","Stamina"],help:"Select which resource you want to spend first when leveling up."},
{id:"algorithm",label:"Estimation Method",select:["Per Action","Per Hour"],help:"'Per Hour' uses your gain per hour. 'Per Action' uses your gain per action."}];LevelUp.init=function(){this._watch(Player);this._watch(Quest);this.runtime.exp=this.runtime.exp||Player.get("exp");this.runtime.level=this.runtime.level||Player.get("level")};
LevelUp.parse=function(d){d?$("#app"+APPID+"_st_2_5 strong").attr("title",Player.get("exp")+"/"+Player.get("maxexp")+" at "+addCommas(this.get("exp_average").round(1))+" per hour").html(addCommas(Player.get("exp_needed"))+'<span style="font-weight:normal;"> in <span class="golem-time" style="color:rgb(25,123,48);" name="'+this.get("level_time")+'">'+makeTimer(this.get("level_timer"))+"</span></span>"):$(".result_body").each(function(e,f){if($('img[src$="battle_victory.gif"]',f).length){e=$(f).text().replace(/,|\t/g,
"");(f=e.regex(/([+-][0-9]+) Experience/i))&&History.add("exp+battle",f);(f=(e.regex(/\+\$([0-9]+)/i)||0)-(e.regex(/\-\$([0-9]+)/i)||0))&&History.add("income+battle",f);(f=e.regex(/([+-][0-9]+) Battle Points/i))&&History.add("bp+battle",f);(f=e.regex(/([+-][0-9]+) Stamina/i))&&History.add("stamina+battle",f);(f=e.regex(/([+-][0-9]+) Energy/i))&&History.add("energy+battle",f)}});return true};
LevelUp.update=function(d,e){var f,h,g,k=Player.get("energy"),l=Player.get("stamina");h=Player.get("exp");d=this.runtime;var m=Config.getOrder();if(e===Player||!length(d.quests)){if(h!==d.exp)if(d.stamina>l){d.exp_per_stamina=(d.exp_per_stamina*Math.min(d.stamina_samples,49)+(h-d.exp)/(d.stamina-l))/Math.min(d.stamina_samples+1,50);d.stamina_samples=Math.min(d.stamina_samples+1,50)}else if(d.energy>k){d.exp_per_energy=(d.exp_per_energy*Math.min(d.energy_samples,9)+(h-d.exp)/(d.energy-k))/Math.min(d.energy_samples+
1,10);d.energy_samples=Math.min(d.energy_samples+1,10)}d.energy=k;d.stamina=l;d.exp=h}if(e===Quest||!length(d.quests)){h=Quest.get();d.quests=e=[[0]];for(f in h)if(!e[h[f].energy]||h[f].exp>e[h[f].energy][0])e[h[f].energy]=[h[f].exp,[f]];h=1;g=[0];for(f=1;f<e.length;f++)if(e[f]&&e[f][0]/f>=g[0]/h){h=f;g=e[f]}else e[f]=[g[0],[g[1][0]]];for(;e.length>1&&e[e.length-1][0]===e[e.length-2][0];)e.pop()}d.exp_possible=this.runtime.quests.length<=1?1:k<this.runtime.quests.length?this.runtime.quests[Math.min(k,
this.runtime.quests.length-1)][0]:this.runtime.quests[this.runtime.quests.length-1][0]*Math.floor(k/(this.runtime.quests.length-1))+this.runtime.quests[k%(this.runtime.quests.length-1)][0];if(arrayIndexOf(m,"Idle")>=arrayIndexOf(m,"Monster")&&Monster.runtime.attack||arrayIndexOf(m,"Idle")>=arrayIndexOf(m,"Battle"))d.exp_possible+=Math.floor(l*d.exp_per_stamina);f=new Date(this.get("level_time"));if(this.option.enabled)d.running?Dashboard.status(this,'<span title="Exp Possible: '+this.runtime.exp_possible+
", per Hour: "+addCommas(this.get("exp_average").round(1))+", per Energy: "+this.runtime.exp_per_energy.round(2)+", per Stamina: "+this.runtime.exp_per_stamina.round(2)+'">LevelUp Running Now!</span>'):Dashboard.status(this,'<span title="Exp Possible: '+this.runtime.exp_possible+", per Energy: "+this.runtime.exp_per_energy.round(2)+", per Stamina: "+this.runtime.exp_per_stamina.round(2)+'">'+f.format("l g:i a")+" (at "+addCommas(this.get("exp_average").round(1))+" exp per hour)</span>");else Dashboard.status(this);
if(!this.option.enabled||this.option.general==="any")Generals.set("runtime.disabled",false)};
LevelUp.work=function(d){var e=this.runtime,f=Player.get("energy"),h=Player.get("stamina"),g=Config.getOrder();if(e.running&&this.option.general!=="any")if(this.option.income&&Queue.get("runtime.current")===Income)Generals.set("runtime.disabled",false);else this.option.bank&&Queue.get("runtime.current")===Bank?Generals.set("runtime.disabled",false):Generals.set("runtime.disabled",true);else e.running||Generals.set("runtime.disabled",false);if(e.old_quest){Quest.runtime.best=e.old_quest;Quest.runtime.energy=
e.old_quest_energy;e.old_quest=null;e.old_quest_energy=0}if(!this.option.enabled||e.exp_possible<Player.get("exp_needed")){if(e.running&&e.level<Player.get("level")){if($("#app"+APPID+"_energy_current_value").next().css("color")==="rgb(25, 123, 48)"&&f>=Player.get("maxenergy")){Queue.burn.energy=f;Queue.burn.stamina=0;return QUEUE_FINISH}if($("#app"+APPID+"_stamina_current_value").next().css("color")==="rgb(25, 123, 48)"&&h>=Player.get("maxstamina")){Queue.burn.energy=0;Queue.burn.stamina=h;return QUEUE_FINISH}Generals.set("runtime.disabled",
false);Queue.burn.stamina=Math.max(0,h-Queue.get("option.stamina"));Queue.burn.energy=Math.max(0,f-Queue.get("option.energy"));Battle.set("option.monster",e.battle_monster);e.running=false}else if(e.running&&e.level==Player.get("level")){Generals.set("runtime.disabled",false);Queue.burn.stamina=Math.max(0,h-Queue.get("option.stamina"));Queue.burn.energy=Math.max(0,f-Queue.get("option.energy"));Battle.set("option.monster",e.battle_monster);e.running=false}return QUEUE_FINISH}if(d&&e.heal_me){if(Heal.me())return QUEUE_CONTINUE;
e.heal_me=false}if(d&&!e.running){e.level=Player.get("level");e.battle_monster=Battle.get("option.monster");e.running=true;Battle.set("option.monster",false)}if(this.option.general!=="any"&&Player.get("exp_needed")<100){Generals.set("runtime.disabled",false);if(Generals.to(this.option.general))Generals.set("runtime.disabled",true);else return QUEUE_CONTINUE}if(this.option.order!=="Stamina"||!h||h<Monster.runtime.stamina&&(!Battle.runtime.attacking||arrayIndexOf(g,"Idle")<=arrayIndexOf(g,"Battle"))||
arrayIndexOf(g,"Idle")<=arrayIndexOf(g,"Monster")||!Monster.runtime.attack){debug("Running Energy Burn");if(Player.get("energy")){e.old_quest=Quest.runtime.best;e.old_quest_energy=Quest.runtime.energy;Queue.burn.energy=f;Queue.burn.stamina=0;Quest.runtime.best=e.quests[Math.min(e.energy,e.quests.length-1)][1][0];Quest.runtime.energy=f;return QUEUE_FINISH}}else debug("Running Stamina Burn");Quest._update("data",null);if(e.level===Player.get("level")&&Player.get("health")<13&&h){e.heal_me=true;return QUEUE_CONTINUE}Queue.burn.energy=
0;Queue.burn.stamina=h;return QUEUE_FINISH};
LevelUp.get=function(d,e){switch(d){case "timer":return makeTimer(this.get("level_timer"));case "time":return(new Date(this.get("level_time"))).format("l g:i a");case "level_timer":return Math.floor((this.get("level_time")-Date.now())/1E3);case "level_time":return Date.now()+Math.floor(36E5*((Player.get("exp_needed")-this.runtime.exp_possible)/(this.get("exp_average")||10)));case "exp_average":return this.option.algorithm=="Per Hour"?History.get("exp.average.change"):12*(this.runtime.exp_per_stamina+
this.runtime.exp_per_energy);default:return this._get(d,e)}};var Monster=new Worker("Monster");Monster.data={};Monster.defaults.castle_age={pages:"keep_monster keep_monster_active keep_monster_active2 battle_raid"};
Monster.option={general:true,general_fortify:"any",general_attack:"any",fortify:30,min_to_attack:0,fortify_active:false,choice:"Any",hide:false,stop:"Never",own:true,armyratio:"Any",levelratio:"Any",force1:true,raid:"Invade x5",assist:true,maxstamina:5,minstamina:5,maxenergy:10,minenergy:10,check_interval:36E5,avoid_behind:false,avoid_hours:5,behind_override:false};Monster.runtime={check:false,uid:null,type:null,fortify:false,attack:false,stamina:5,health:10};
Monster.display=[{id:"general",label:"Use Best General",require:{"Caap.runtime.enabled":false},checkbox:true},{title:"Fortification"},{id:"fortify_active",label:"Fortify Active",checkbox:true,help:"Must be checked to fortify."},{advanced:true,id:"general_fortify",require:{"Caap.runtime.enabled":true,fortify_active:true},label:"Fortify General",select:"bestgenerals"},{id:"fortify",require:"fortify_active",label:"Fortify Below (AB)",text:30,help:"Fortify if ATT BONUS is under this value. Range of -50% to +50%.",
after:"%"},{id:"min_to_attack",require:"fortify_active",label:"Attack Over (AB)",text:1,help:"Attack if ATT BONUS is over this value. Range of -50% to +50%.",after:"%"},{id:"minenergy",require:"fortify_active",label:"Min Energy Cost",select:[10,20,40,100],help:"Select the minimum energy for a single energy action"},{id:"maxenergy",require:"fortify_active",label:"Max Energy Cost",select:[10,20,40,100],help:"Select the maximum energy for a single energy action"},{title:"Who To Fight"},{advanced:true,
id:"general_attack",label:"Attack General",require:"Caap.runtime.enabled",select:"bestgenerals"},{advanced:true,id:"hide",label:"Use Raids and Monsters to Hide",checkbox:true,help:"Fighting Raids keeps your health down. Fight Monsters with remaining stamina."},{id:"choice",label:"Attack",select:["Any","Strongest","Weakest","Shortest ETD","Longest ETD","Spread","Max Damage","Mim Damage","ETD Maintain"]},{id:"stop",label:"Stop",select:["Never","Achievement","Loot"],help:"Select when to stop attacking a target."},
{advanced:true,id:"own",label:"Never stop on Your Monsters",checkbox:true,help:"Never stop attacking your own summoned monsters (Ignores Stop option)."},{advanced:true,id:"behind_override",label:"Rescue failing monsters",checkbox:true,help:"Attempts to rescue failing monsters even if damage is at or above Stop Optionby continuing to attack. Can be used in coordination with Lost-cause monsters setting to give up if monster is too far gone to be rescued."},{advanced:true,id:"avoid_behind",label:"Avoid Lost-cause Monsters",
checkbox:true,help:"Do not attack monsters that are a lost cause, i.e. the ETD is longer than the time remaining."},{advanced:true,id:"avoid_hours",label:"Lost-cause if ETD is",after:"hours after timer",text:true,help:"# of Hours Monster must be behind before preventing attacks."},{id:"minstamina",label:"Min Stamina Cost",select:[1,5,10,20,50],help:"Select the minimum stamina for a single attack"},{id:"maxstamina",label:"Max Stamina Cost",select:[1,5,10,20,50],help:"Select the maximum stamina for a single attack"},
{title:"Raids"},{id:"raid",label:"Raid",select:["Invade","Invade x5","Duel","Duel x5"]},{id:"armyratio",require:{raid:[["Duel","Duel x5"]]},label:"Target Army Ratio",select:["Any",0.5,0.6,0.7,0.8,0.9,1,1.1,1.2,1.3,1.4,1.5],help:"Smaller number for smaller target army. Reduce this number if you're losing in Invade"},{id:"levelratio",require:{raid:[["Invade","Invade x5"]]},label:"Target Level Ratio",select:["Any",0.5,0.6,0.7,0.8,0.9,1,1.1,1.2,1.3,1.4,1.5],help:"Smaller number for lower target level. Reduce this number if you're losing a lot"},
{id:"force1",label:"Force +1",checkbox:true,help:"Force the first player in the list to aid."},{title:"Siege Assist Options"},{id:"assist",label:"Assist with Sieges",help:"Spend stamina to assist with sieges.",checkbox:true},{id:"assist_links",label:"Use Assist Links in Dashboard",checkbox:true},{advanced:true,id:"check_interval",label:"Monster Review",select:{9E5:"Quarterly",18E5:"1/2 Hour",36E5:"Hourly",72E5:"2 Hours",216E5:"6 Hours",432E5:"12 Hours",864E5:"Daily",6048E5:"Weekly"},help:"Sets how ofter to check Monster Stats."}];
Monster.types={raid_easy:{name:"The Deathrune Siege",list:"deathrune_list1.jpg",image:"raid_title_raid_a1.jpg",image2:"raid_title_raid_a2.jpg",dead:"raid_1_large_victory.jpg",achievement:100,timer:216E3,timer2:302400,raid:true},raid:{name:"The Deathrune Siege",list:"deathrune_list2.jpg",image:"raid_title_raid_b1.jpg",image2:"raid_title_raid_b2.jpg",dead:"raid_1_large_victory.jpg",achievement:100,timer:319920,timer2:519960,raid:true},colossus:{name:"Colossus of Terra",list:"stone_giant_list.jpg",image:"stone_giant_large.jpg",
dead:"stone_giant_dead.jpg",achievement:2E4,timer:259200,mpool:1,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},gildamesh:{name:"Gildamesh, the Orc King",list:"orc_boss_list.jpg",image:"orc_boss.jpg",dead:"orc_boss_dead.jpg",achievement:15E3,timer:259200,mpool:1,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},keira:{name:"Keira the Dread Knight",list:"boss_keira_list.jpg",image:"boss_keira.jpg",dead:"boss_keira_dead.jpg",achievement:3E4,timer:172800,mpool:1,atk_btn:'input[name="Attack Dragon"]',
attacks:[1,5]},lotus:{name:"Lotus Ravenmoore",list:"boss_lotus_list.jpg",image:"boss_lotus.jpg",dead:"boss_lotus_big_dead.jpg",achievement:5E5,timer:172800,mpool:1,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},mephistopheles:{name:"Mephistopheles",list:"boss_mephistopheles_list.jpg",image:"boss_mephistopheles_large.jpg",dead:"boss_mephistopheles_dead.jpg",achievement:1E5,timer:172800,mpool:1,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},skaar:{name:"Skaar Deathrune",list:"death_list.jpg",
image:"death_large.jpg",dead:"death_dead.jpg",achievement:1E6,timer:345E3,mpool:1,atk_btn:'input[name="Attack Dragon"][src*="attack"]',attacks:[1,5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="dispel"]',defends:[10,20,40,100]},sylvanus:{name:"Sylvana the Sorceress Queen",list:"boss_sylvanus_list.jpg",image:"boss_sylvanus_large.jpg",dead:"boss_sylvanus_dead.jpg",achievement:5E4,timer:172800,mpool:1,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},dragon_emerald:{name:"Emerald Dragon",list:"dragon_list_green.jpg",
image:"dragon_monster_green.jpg",dead:"dead_dragon_image_green.jpg",achievement:1E5,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},dragon_frost:{name:"Frost Dragon",list:"dragon_list_blue.jpg",image:"dragon_monster_blue.jpg",dead:"dead_dragon_image_blue.jpg",achievement:1E5,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},dragon_gold:{name:"Gold Dragon",list:"dragon_list_yellow.jpg",image:"dragon_monster_gold.jpg",dead:"dead_dragon_image_gold.jpg",
achievement:1E5,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},dragon_red:{name:"Ancient Red Dragon",list:"dragon_list_red.jpg",image:"dragon_monster_red.jpg",dead:"dead_dragon_image_red.jpg",achievement:1E5,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5]},serpent_amethyst:{name:"Amethyst Sea Serpent",list:"seamonster_list_purple.jpg",image:"seamonster_purple.jpg",dead:"seamonster_dead.jpg",title:"seamonster_title_amethyst.jpg",achievement:25E4,
timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5],def_btn:'input[name="Defend against Monster"]',defends:[10]},serpent_ancient:{name:"Ancient Sea Serpent",list:"seamonster_list_red.jpg",image:"seamonster_red.jpg",dead:"seamonster_dead.jpg",title:"seamonster_title_ancient.jpg",achievement:25E4,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5],def_btn:'input[name="Defend against Monster"]',defends:[10]},serpent_emerald:{name:"Emerald Sea Serpent",list:"seamonster_list_green.jpg",
image:"seamonster_green.jpg",dead:"seamonster_dead.jpg",title:"seamonster_title_emerald.jpg",achievement:25E4,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5],def_btn:'input[name="Defend against Monster"]',defends:[10]},serpent_sapphire:{name:"Sapphire Sea Serpent",list:"seamonster_list_blue.jpg",image:"seamonster_blue.jpg",dead:"seamonster_dead.jpg",title:"seamonster_title_sapphire.jpg",achievement:25E4,timer:259200,mpool:2,atk_btn:'input[name="Attack Dragon"]',attacks:[1,
5],def_btn:'input[name="Defend against Monster"]',defends:[10]},cronus:{name:"Cronus, The World Hydra",list:"hydra_head.jpg",image:"hydra_large.jpg",dead:"hydra_dead.jpg",achievement:5E5,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"]',attacks:[1,5,10,20,50]},legion:{name:"Battle of the Dark Legion",list:"castle_siege_list.jpg",image:"castle_siege_large.jpg",dead:"castle_siege_dead.jpg",achievement:1E3,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"][src*="attack"]',attacks:[1,
5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="fortify"]',defends:[10,20,40,100],orcs:true},genesis:{name:"Genesis, The Earth Elemental",list:"earth_element_list.jpg",image:"earth_element_large.jpg",dead:"earth_element_dead.jpg",achievement:1E6,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"][src*="attack"]',attacks:[1,5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="fortify"]',defends:[10,20,40,100]},ragnarok:{name:"Ragnarok, The Ice Elemental",list:"water_list.jpg",image:"water_large.jpg",
dead:"water_dead.jpg",achievement:1E6,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"][src*="attack"]',attacks:[1,5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="dispel"]',defends:[10,20,40,100]},bahamut:{name:"Bahamut, the Volcanic Dragon",list:"nm_volcanic_list.jpg",image:"nm_volcanic_large.jpg",dead:"nm_volcanic_dead.jpg",achievement:1E6,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"][src*="stab"],input[name="Attack Dragon"][src*="bolt"],input[name="Attack Dragon"][src*="smite"],input[name="Attack Dragon"][src*="bash"]',
attacks:[5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="cripple"],input[name="Attack Dragon"][src*="deflect"],input[name="Attack Dragon"][src*="heal"],input[name="Attack Dragon"][src*="strengthen"]',defends:[10,20,40,100]},alpha_bahamut:{name:"Alpha Bahamut, the Volcanic Dragon",list:"nm_volcanic_list_2.jpg",image:"nm_volcanic_large_2.jpg",dead:"nm_volcanic_dead_2.jpg",achievement:3E6,timer:604800,mpool:3,atk_btn:'input[name="Attack Dragon"][src*="stab"],input[name="Attack Dragon"][src*="bolt"],input[name="Attack Dragon"][src*="smite"],input[name="Attack Dragon"][src*="bash"]',
attacks:[5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="cripple"],input[name="Attack Dragon"][src*="deflect"],input[name="Attack Dragon"][src*="heal"],input[name="Attack Dragon"][src*="strengthen"]',defends:[10,20,40,100]},azriel:{name:"Azriel, the Angel of Wrath",list:"nm_azriel_list.jpg",image:"nm_azriel_large2.jpg",dead:"nm_azriel_dead.jpg",achievement:3E6,timer:604800,mpool:1,atk_btn:'input[name="Attack Dragon"][src*="stab"],input[name="Attack Dragon"][src*="bolt"],input[name="Attack Dragon"][src*="smite"],input[name="Attack Dragon"][src*="bash"]',
attacks:[5,10,20,50],def_btn:'input[name="Attack Dragon"][src*="cripple"],input[name="Attack Dragon"][src*="deflect"],input[name="Attack Dragon"][src*="heal"],input[name="Attack Dragon"][src*="strengthen"]',defends:[10,20,40,100]}};Monster.health_img=['img[src$="nm_red.jpg"]','img[src$="monster_health_background.jpg"]'];Monster.shield_img=['img[src$="bar_dispel.gif"]'];Monster.defense_img=['img[src$="nm_green.jpg"]','img[src$="seamonster_ship_health.jpg"]'];Monster.secondary_img=['img[src$="nm_stun_bar.gif"]'];
Monster.class_img=['div[style*="nm_bottom"] img[src$="nm_class_warrior.jpg"]','div[style*="nm_bottom"] img[src$="nm_class_cleric.jpg"]','div[style*="nm_bottom"] img[src$="nm_class_rogue.jpg"]','div[style*="nm_bottom"] img[src$="nm_class_mage.jpg"]'];Monster.class_name=["Warrior","Cleric","Rogue","Mage"];Monster.class_off=["","",'img[src$="nm_s_off_cripple.gif"]','img[src$="nm_s_off_deflect.gif"]'];
Monster.init=function(){var d,e;this._watch(Player);this._watch(Queue);this.runtime.count=0;for(d in this.data)for(e in this.data[d]){this.data[d][e].state==="engage"&&this.runtime.count++;if(typeof this.data[d][e].ignore==="unknown")this.data[d][e].ignore=false;if(typeof this.data[d][e].dispel!=="undefined"){this.data[d][e].defense=100-this.data[d][e].dispel;delete this.data[d][e].dispel}}$("#golem-dashboard-Monster tbody td a").live("click",function(){var f=$(this).attr("href");Page.to(f.indexOf("raid")>
0?"battle_raid":"keep_monster",f.substr(f.indexOf("?")));return false})};
Monster.parse=function(){var d;Battle.get("user");var e,f,h=false,g,k,l=Monster.data,m=Monster.types;if(Page.page==="keep_monster_active"||Page.page==="keep_monster_active2"){e=$('img[linked][size="square"]').attr("uid");this.runtime.checkuid=this.runtime.checktype=null;debug("Parsing for Monster type");for(d in m)if(m[d].dead&&$('img[src$="'+m[d].dead+'"]').length&&!m[d].title){f=d;k=m[d].timer;h=true}else if(m[d].dead&&$('img[src$="'+m[d].dead+'"]').length&&m[d].title&&$('div[style*="'+m[d].title+
'"]').length){f=d;k=m[d].timer;h=true}else if(m[d].image&&($('img[src$="'+m[d].image+'"]').length||$('div[style*="'+m[d].image+'"]').length)){f=d;k=m[d].timer}else if(m[d].image2&&($('img[src$="'+m[d].image2+'"]').length||$('div[style*="'+m[d].image2+'"]').length)){f=d;k=m[d].timer2||m[d].timer}if(!e||!f){debug("Unknown monster (probably dead)");return false}l[e]=l[e]||{};l[e][f]=l[e][f]||{};g=l[e][f];g.last=Date.now();if($('input[src*="collect_reward_button.jpg"]').length){g.state="reward";return false}if(h&&
g.state==="assist")g.state=null;else if(h&&g.state==="engage")g.state="reward";else{if(!g.state&&$("span.result_body").text().match(/for your help in summoning|You have already assisted on this objective|You don't have enough stamina assist in summoning/i)){if($("span.result_body").text().match(/for your help in summoning/i))g.assist=Date.now();g.state="assist"}if(this.runtime.attacked&&$('span[class="positive"]').length&&typeof $('span[class="positive"]').prevAll("span").text().regex(/([0-9]+)/)===
"number"){this.runtime.post_stamina=Player.get("stamina");if(g.battle_stamina)g.battle_stamina+=this.runtime.pre_stamina-this.runtime.post_stamina;else g.battle_stamina=this.runtime.pre_stamina-this.runtime.post_stamina;if(e=$('span[class="positive"]').prevAll("span").text().regex(/([0-9]+)/)){g.dmg_per_stamina=g.dmg_per_stamina?Math.ceil((g.dmg_per_stamina+e/(this.runtime.pre_stamina-this.runtime.post_stamina))/2):Math.ceil(e/g.battle_stamina);g.dmg_avg=g.dmg_avg?Math.ceil((g.dmg_avg+e)/2):e}this.runtime.pre_stamina=
this.runtime.post_stamina=0;this.runtime.attacked=false}if(this.runtime.defended&&$('span[class="positive"]').length&&typeof $('span[class="positive"]').prevAll("span").text().regex(/([0-9]+)/)==="number"){this.runtime.post_energy=Player.get("energy");e=$('span[class="positive"]').prevAll("span").text().regex(/([0-9]+)/);if(g.battle_energy)g.battle_energy+=this.runtime.pre_energy-this.runtime.post_energy;else g.battle_energy=this.runtime.pre_energy-this.runtime.post_energy;if(e){g.dfd_per_energy=
g.dfd_per_energy?Math.ceil((g.dfd_per_energy+e/(this.runtime.pre_energy-this.runtime.post_energy))/2):Math.ceil(e/g.battle_energy);g.dfd_avg=g.dfd_avg?Math.ceil((g.dfd_avg+e)/2):e}this.runtime.pre_energy=this.runtime.post_energy=0;this.runtime.defended=false}if($('img[src$="battle_victory.gif"],img[src$="battle_defeat.gif"],span["result_body"] a:contains("Attack Again")').length)g.battle_count=(g.battle_count||0)+1;$('img[src$="battle_victory"]').length&&History.add("raid+win",1);$('img[src$="battle_defeat"]').length&&
History.add("raid+loss",-1);if(!g.name){e=$('img[linked][size="square"]').parent().parent().next().text().trim().replace(/[\s\n\r]{2,}/g," ");g.name=e.regex(/(.+)'s /i)}for(d in Monster.class_img)if($(Monster.class_img[d]).length)g.mclass=d;if(g.mclass>1)if($(Monster.class_off[g.mclass]).length===0)for(d in Monster.secondary_img){e=$(Monster.secondary_img[d]);if(e.length){g.secondary=100*e.width()/e.parent().width();break}}for(d in Monster.health_img)if($(Monster.health_img[d]).length){e=$(Monster.health_img[d]).parent();
g.health=e.length?100*e.width()/e.parent().width():0;break}for(d in Monster.shield_img)if($(Monster.shield_img[d]).length){e=$(Monster.shield_img[d]).parent();g.defense=100*(1-e.width()/(e.next().length?e.width()+e.next().width():e.parent().width()));g.attackbonus=g.defense*(isNumber(g.strength)?g.strength/100:1)-50;break}for(d in Monster.defense_img)if($(Monster.defense_img[d]).length){d=$(Monster.defense_img[d]).parent();g.defense=d.width()/(d.next().length?d.width()+d.next().width():d.parent().width())*
100;g.strength=d.parent().width()<d.parent().parent().width()?100*d.parent().width()/d.parent().parent().width():100;g.attackbonus=g.defense*(isNumber(g.strength)?g.strength/100:1)-50;break}g.timer=$("#app"+APPID+"_monsterTicker").text().parseTimer();g.finish=Date.now()+g.timer*1E3;g.damage_total=0;g.damage_siege=0;g.damage_players=0;g.fortify=0;g.damage={};$('img[src*="siege_small"]').each(function(q,o){q=$(o).parent().next().next().next().children().eq(0).text();o=$(o).parent().next().next().next().children().eq(1).text().replace(/[^0-9]/g,
"").regex(/([0-9]+)/);g.damage[q]=[o];g.damage_siege+=o});$('td.dragonContainer table table a[href^="http://apps.facebook.com/castle_age/keep.php?user="]').each(function(q,o){q=$(o).attr("href").regex(/user=([0-9]+)/i);var n=null;n=m[f].raid?$(o).parent().next().text().replace(/[^0-9\/]/g,""):$(o).parent().parent().next().text().replace(/[^0-9\/]/g,"");o=n.regex(/([0-9]+)/);n=n.regex(/\/([0-9]+)/);g.damage[q]=n?[o,n]:[o];if(q===userID){g.damage_user=o;if(g.dmg_per_stamina&&g.battle_stamina){for(;g.dmg_per_stamina*
g.battle_stamina<g.damage_user*0.99;)g.battle_stamina++;for(;g.dmg_per_stamina*g.battle_stamina>=g.damage_user*1.01;)g.battle_stamina--}}g.damage_players+=o;if(n)g.fortify+=n});g.damage_total=m[f].orcs?Math.ceil(g.damage_siege/1E3)+g.damage_players:g.damage_siege+g.damage_players;g.dps=g.damage_players/(k-g.timer);g.total=m[f].raid?g.damage_total+$('div[style*="monster_health_back.jpg"] div:nth-child(2)').text().regex(/([0-9]+)/):Math.ceil((1+100*g.damage_total)/(g.health==100?0.1:100-g.health));
g.eta=Date.now()+Math.floor((g.total-g.damage_total)/g.dps)*1E3}}else if(Page.page==="keep_monster"||Page.page==="battle_raid"){if($('div[style*="no_monster_back.jpg"]').attr("style")){debug("Found a timed out monster.");if(typeof this.runtime.checkuid!=="undefined"&&typeof this.runtime.checktype!=="undefined"&&this.runtime.checkuid&&this.runtime.checktype){debug("Deleting "+this.data[this.runtime.checkuid][this.runtime.checktype].name+"'s "+this.runtime.checktype);delete this.data[this.runtime.checkuid][this.runtime.checktype];
length(this.data[this.runtime.checkuid])||delete this.data[this.runtime.checkuid]}else debug("Unknown monster (timed out)");this.runtime.checkuid=this.runtime.checktype=null;return false}this.runtime.checkuid=this.runtime.checktype=null;if(!$("#app"+APPID+"_app_body div.imgButton").length)return false;if(Page.page==="battle_raid")raid=true;for(e in l)for(f in l[e])if((Page.page==="battle_raid"&&this.types[f].raid||Page.page==="keep_monster"&&!this.types[f].raid)&&(l[e][f].state==="complete"||l[e][f].state===
"assist"&&l[e][f].finish<Date.now()))l[e][f].state=null;$("#app"+APPID+"_app_body div.imgButton").each(function(q,o){var n=$("a",o).attr("href").regex(/user=([0-9]+)/i),s=$(o).parent().parent().children().eq(1).html().regex(/graphics\/([^.]*\....)/i),p="unknown";for(q in m)if(s==m[q].list){p=q;break}if(!(!n||p==="unknown")){l[n]=l[n]||{};l[n][p]=l[n][p]||{};if(n===userID)l[n][p].name="You";else{s=$(o).parent().parent().children().eq(2).text().trim();l[n][p].name=s.regex(/(.+)'s /i)}switch($("img",
o).attr("src").regex(/dragon_list_btn_([0-9])/)){case 2:l[n][p].state="reward";break;case 3:l[n][p].state="engage";break;case 4:l[n][p].state="complete";break;default:l[n][p].state="unknown";break}}})}return false};
Monster.update=function(d,e){if(d!=="runtime"){var f,h,g=[],k=this.runtime.uid,l=this.runtime.type,m=null,q,o;d=null;var n=0;if(e===Player){this.runtime.count=0;for(f in this.data){for(h in this.data[f])if(!this.data[f][h].state||this.data[f][h].state===null){log("Found Invalid Monster State=("+this.data[f][h].state+")");delete this.data[f][h]}else this.data[f][h].state==="engage"&&this.runtime.count++;if(!length(this.data[f])){log("Found Invalid Monster ID=("+this.data[f]+")");delete this.data[f]}}if(!k||
!l||!this.data[k]||!this.data[k][l]||this.data[k][l].state!=="engage"&&this.data[k][l].state!=="assist"){this.runtime.uid=k=null;this.runtime.type=l=null}l=k=null;for(f in this.data)for(h in this.data[f]){if((!this.data[f][h].health&&this.data[f][h].state==="engage"||typeof this.data[f][h].last==="undefined"||this.data[f][h].last<Date.now()-this.option.check_interval)&&(typeof this.data[f][h].ignore==="undefined"||!this.data[f][h].ignore&&this.data[f][h].state!=="complete")&&!this.runtime.check){this.runtime.check=
true;break}e=this.types[h].raid&&this.option.raid.search("x5")==-1?1:this.types[h].raid?5:this.option.minstamina<Math.min.apply(Math,this.types[h].attacks)||this.option.maxstamina<Math.min.apply(Math,this.types[h].attacks)?Math.min.apply(Math,this.types[h].attacks):this.option.minstamina>Math.max.apply(Math,this.types[h].attacks)?Math.max.apply(Math,this.types[h].attacks):this.option.minstamina>this.option.maxstamina?this.option.maxstamina:this.option.minstamina;o=this.types[h].def_btn?this.option.minenergy:
null;q=this.types[h].raid?13:10;if((typeof this.data[f][h].ignore==="undefined"||!this.data[f][h].ignore)&&this.data[f][h].state==="engage"&&this.data[f][h].finish>Date.now()&&(!this.option.hide||Player.get("health")>=q)&&(Queue.burn.energy>=o||(!this.option.hide||Queue.burn.stamina>=e)&&(typeof this.data[f][h].attackbonus==="undefined"||this.data[f][h].attackbonus>=this.option.min_to_attack||this.data[f][h].attackbonus<=this.option.fortify&&this.option.fortify_active&&Queue.burn.energy>=o))){if(!this.data[f][h].battle_count)this.data[f][h].battle_count=
1;if(f===userID&&this.option.own){g.push([f,h,this.data[f][h].health,this.data[f][h].eta,this.data[f][h].battle_count,((sum(this.data[f][h].damage[userID])||0)/this.data[f][h].damage_total*100).round(4),this.data[f][h].finish,(this.data[f][h].eta-this.data[f][h].finish)/36E5]);break}else if(this.option.behind_override&&this.data[f][h].eta>=this.data[f][h].finish-this.option.check_interval&&sum(this.data[f][h].damage[userID])>this.types[h].achievement){g.push([f,h,this.data[f][h].health,this.data[f][h].eta,
this.data[f][h].battle_count,((sum(this.data[f][h].damage[userID])||0)/this.data[f][h].damage_total*100).round(4),this.data[f][h].finish,(this.data[f][h].eta-this.data[f][h].finish)/36E5]);break}else switch(this.option.stop){default:case "Never":g.push([f,h,this.data[f][h].health,this.data[f][h].eta,this.data[f][h].battle_count,((sum(this.data[f][h].damage[userID])||0)/this.data[f][h].damage_total*100).round(4),this.data[f][h].finish,(this.data[f][h].eta-this.data[f][h].finish)/36E5]);break;case "Achievement":if(isNumber(this.types[h].achievement)&&
(typeof this.data[f][h].damage[userID]==="undefined"||sum(this.data[f][h].damage[userID])<this.types[h].achievement))g.push([f,h,this.data[f][h].health,this.data[f][h].eta,this.data[f][h].battle_count,((sum(this.data[f][h].damage[userID])||0)/this.data[f][h].damage_total*100).round(4),this.data[f][h].finish,(this.data[f][h].eta-this.data[f][h].finish)/36E5]);break;case "Loot":if(isNumber(this.types[h].achievement)&&(typeof this.data[f][h].damage[userID]==="undefined"||sum(this.data[f][h].damage[userID])<
(f==userID&&h==="keira"?2E5:2*this.types[h].achievement)))g.push([f,h,this.data[f][h].health,this.data[f][h].eta,this.data[f][h].battle_count,((sum(this.data[f][h].damage[userID])||0)/this.data[f][h].damage_total*100).round(4),this.data[f][h].finish,(this.data[f][h].eta-this.data[f][h].finish)/36E5]);break}}}if(g.length){g.sort(function(s,p){switch(Monster.option.choice){case "Any":return Math.random()-0.5;case "Strongest":return p[2]-s[2];case "Weakest":return s[2]-p[2];case "Shortest ETD":return s[3]-
p[3];case "Longest ETD":return p[3]-s[3];case "Spread":return s[4]-p[4];case "Max Damage":return p[5]-s[5];case "Min Damage":return s[5]-p[5];case "ETD Maintain":return s[7]<p[7]?1:s[7]>p[7]?-1:0}});if(this.option.avoid_behind)for(f=0;f<=g.length-1;f++){if((g[f][3]/36E5-g[f][6]/36E5).round(0)<=this.option.avoid_hours){m=g[f];break}}else m=g[0]}delete g;if(m){k=m[0];l=m[1]}this.runtime.uid=k;this.runtime.type=l}if(k&&l){this.runtime.stamina=this.types[l].raid&&this.option.raid.search("x5")==-1?1:this.types[l].raid?
5:this.option.minstamina<Math.min.apply(Math,this.types[l].attacks)||this.option.maxstamina<Math.min.apply(Math,this.types[l].attacks)?Math.min.apply(Math,this.types[l].attacks):this.option.minstamina>Math.max.apply(Math,this.types[l].attacks)?Math.max.apply(Math,this.types[l].attacks):this.option.minstamina>this.option.maxstamina?this.option.maxstamina:this.option.minstamina;this.runtime.energy=!this.types[l].defends?10:this.option.minenergy<Math.min.apply(Math,this.types[l].defends)||this.option.maxenergy<
Math.min.apply(Math,this.types[l].defends)?Math.min.apply(Math,this.types[l].defends):this.option.minenergy>Math.max.apply(Math,this.types[l].defends)?Math.max.apply(Math,this.types[l].defends):this.option.minenergy>this.option.maxenergy?this.option.maxenergy:this.option.minenergy;this.runtime.health=this.types[l].raid?13:10;this.runtime.fortify=this.option.fortify_active&&(typeof this.data[k][l].mclass==="undefined"||this.data[k][l].mclass<2)&&typeof this.data[k][l].attackbonus!=="undefined"&&this.data[k][l].attackbonus<
this.option.fortify&&this.data[k][l].defense<100?true:this.option.fortify_active&&typeof this.data[k][l].mclass!=="undefined"&&this.data[k][l].mclass>1&&typeof this.data[k][l].secondary!=="undefined"&&this.data[k][l].secondary<100?true:false;if(Queue.burn.energy<this.runtime.energy)this.runtime.fortify=false;this.runtime.attack=true;f=(k===userID?"your ":this.data[k][l].name+"'s ")+this.types[l].name;if(Player.get("health")>this.runtime.health&&Queue.burn.stamina>=this.runtime.stamina||this.runtime.fortify&&
Queue.burn.energy>=this.runtime.energy)Dashboard.status(this,(this.runtime.fortify?"Fortify":"Attack")+" "+f+" ("+makeImage("stamina")+" "+this.runtime.stamina+"+, "+makeImage("energy")+" "+this.runtime.energy+"+)");else if(this.runtime.fortify&&Queue.burn.energy<this.runtime.energy){d="energy";n=LevelUp.runtime.running&&LevelUp.option.enabled?this.runtime.energy-Queue.burn.energy:Math.max(this.runtime.energy-Queue.burn.energy,this.runtime.energy+Queue.option.energy-Player.get("energy"),Queue.option.start_energy-
Player.get("energy"))}else if(Queue.burn.stamina<this.runtime.stamina){d="stamina";n=LevelUp.runtime.running&&LevelUp.option.enabled?this.runtime.stamina-Queue.burn.stamina:Math.max(this.runtime.stamina-Queue.burn.stamina,this.runtime.stamina+Queue.option.stamina-Player.get("stamina"),Queue.option.start_stamina-Player.get("stamina"))}else if(Player.get("health")<this.runtime.health){d="health";n=this.runtime.health-Player.get("health")}if(d)Dashboard.status(this,"Waiting for "+makeImage(d)+n+" to "+
(this.runtime.fortify?"fortify ":"attack ")+f+" ("+makeImage("stamina")+this.runtime.stamina+"+, "+makeImage("energy")+this.runtime.energy+"+)")}else{this.runtime.attack=false;this.runtime.fortify=false;Dashboard.status(this,"Nothing to do.")}}};
Monster.work=function(d){var e,f,h=[];h=[];var g=this.runtime.uid,k=this.runtime.type,l=null;if(!this.runtime.check&&(!this.runtime.fortify||Queue.burn.energy<this.runtime.energy||Player.get("health")<10)&&(!this.runtime.attack||Queue.burn.stamina<this.runtime.stamina||Player.get("health")<this.runtime.health))return QUEUE_FINISH;if(!d)return QUEUE_CONTINUE;if(this.runtime.check){for(e in this.data)for(f in this.data[e])if((!this.data[e][f].health&&this.data[e][f].state==="engage"||typeof this.data[e][f].last===
"undefined"||this.data[e][f].last<Date.now()-this.option.check_interval)&&(typeof this.data[e][f].ignore==="undefined"||!this.data[e][f].ignore)){debug("Reviewing "+this.data[e][f].name+"'s "+this.types[f].name);this.runtime.checkuid=e;this.runtime.checktype=f;Page.to(this.types[f].raid?"battle_raid":"keep_monster","?user="+e+(this.types[f].mpool?"&mpool="+this.types[f].mpool:""));return QUEUE_CONTINUE}this.runtime.check=false;debug("Finished Monster / Raid review");return QUEUE_RELEASE}if(this.types[k].raid){if(!Generals.to(this.option.raid.search("Invade")==
-1?"raid-duel":"raid-invade"))return QUEUE_CONTINUE;switch(this.option.raid){case "Invade":l=$('input[src$="raid_attack_button.gif"]:first');break;case "Invade x5":l=$('input[src$="raid_attack_button3.gif"]:first');break;case "Duel":l=$('input[src$="raid_attack_button2.gif"]:first');break;case "Duel x5":l=$('input[src$="raid_attack_button4.gif"]:first');break}}else{if(this.data[g][k].button_fail<=10||!this.data[g][k].button_fail){f=this.runtime.fortify&&Queue.burn.energy>=this.runtime.energy?"fortify":
"attack";if("Caap"in Workers){if(!Generals.to(this.option["general_"+f]==="Best"?f:this.option["general_"+f]))return QUEUE_CONTINUE}else if(this.option.general&&!Generals.to(f))return QUEUE_CONTINUE;debug("Try to "+f+" [UID="+g+"]"+this.data[g][k].name+"'s "+this.types[k].name);switch(f){case "fortify":if(!l&&this.option.maxenergy<this.types[k].defends[0])l=$(this.types[k].def_btn).eq(0);else for(e=e=$(this.types[k].def_btn).length-1;e>=0;e--)if(this.types[k].defends[e]<=this.option.maxenergy&&Queue.burn.energy>=
this.types[k].defends[e]){l=$(this.types[k].def_btn).eq(e);break}break;case "attack":if(!l&&this.option.maxstamina<Math.min.apply(Math,this.types[k].attacks))l=$(this.types[k].atk_btn).eq(0).name;else for(e=e=$(this.types[k].atk_btn).length-1;e>=0;e--)if(this.types[k].attacks[e]<=this.option.maxstamina&&Queue.burn.stamina>=this.types[k].attacks[e]){l=$(this.types[k].atk_btn).eq(e);break}break;default:break}}if(!l||!l.length)this.data[g][k].button_fail+=1;if(this.data[g][k].button_fail>10){log("Ignoring Monster "+
this.data[g][k].name+"'s "+this.types[k].name+this.data[g][k]+": Unable to locate "+f+" button "+this.data[g][k].button_fail+" times!");this.data[g][k].ignore=true;this.data[g][k].button_fail=0}}if(!l||!l.length||Page.page!=="keep_monster_active"&&Page.page!=="keep_monster_active2"||$('div[style*="dragon_title_owner"] img[linked]').attr("uid")!=g&&$('div[style*="nm_top"] img[linked]').attr("uid")!=g){Page.to(this.types[k].raid?"battle_raid":"keep_monster","?user="+g+(this.types[k].mpool?"&mpool="+
this.types[k].mpool:""));return QUEUE_CONTINUE}if(this.option.assist&&typeof $('input[name*="help with"]')!=="undefined"&&(typeof this.data[g][k].phase==="undefined"||$('input[name*="help with"]').attr("title").regex(/ (.*)/i)!==this.data[g][k].phase)){debug("Current Siege Phase is: "+this.data[g][k].phase);this.data[g][k].phase=$('input[name*="help with"]').attr("title").regex(/ (.*)/i);debug("Found a new siege phase ("+this.data[g][k].phase+"), assisting now.");Page.to(this.types[k].raid?"battle_raid":
"keep_monster","?user="+g+"&action=doObjective"+(this.types[k].mpool?"&mpool="+this.types[k].mpool:"")+"&lka="+e+"&ref=nf");return QUEUE_RELEASE}if(this.types[k].raid){d=Battle.get("user");if(this.option.force1){for(e in d)h.push(e);$('input[name*="target_id"]').val(h[Math.floor(Math.random()*h.length)]||0)}h=$('div[id*="raid_atk_lst0"] div div').text().regex(/Lvl\s*([0-9]+).*Army: ([0-9]+)/);if(this.option.armyratio!=="Any"&&h[1]/Player.get("army")>this.option.armyratio&&this.option.raid.indexOf("Invade")>=
0||this.option.levelratio!=="Any"&&h[0]/Player.get("level")>this.option.levelratio&&this.option.raid.indexOf("Invade")==-1){log("No valid Raid target!");Page.to("battle_raid","");return QUEUE_CONTINUE}}this.runtime.uid=this.runtime.type=null;switch(f){case "fortify":this.runtime.pre_energy=Player.get("energy");Page.click(l);this.runtime.defended=true;this.data[g][k].button_fail=0;return QUEUE_RELEASE;case "attack":this.runtime.pre_stamina=Player.get("stamina");Page.click(l);this.runtime.attacked=
true;this.data[g][k].button_fail=0;return QUEUE_RELEASE;default:Page.click(l);return QUEUE_RELEASE}};Monster.order=null;
Monster.dashboard=function(d,e){var f,h,g,k,l,m=[],q=[],o=[null,"name","health","defense",null,"timer","eta"],n={engage:0,assist:1,reward:2,complete:3},s;if(typeof d==="undefined"){this.order=[];for(f in this.data)for(h in this.data[f])this.order.push([f,h])}if(typeof d==="undefined")d=this.runtime.sort||1;if(typeof e==="undefined")e=this.runtime.rev||false;this.runtime.sort=d;this.runtime.rev=e;this.order.sort(function(p,r){var u,t;if(n[Monster.data[p[0]][p[1]].state]>n[Monster.data[r[0]][r[1]].state])return 1;
if(n[Monster.data[p[0]][p[1]].state]<n[Monster.data[r[0]][r[1]].state])return-1;if(typeof o[d]==="string"){u=Monster.data[p[0]][p[1]][o[d]];t=Monster.data[r[0]][r[1]][o[d]]}else if(d==4){if(typeof Monster.data[p[0]][p[1]].damage!=="undefined"&&typeof Monster.data[r[0]][r[1]].total!=="undefined")u=sum(Monster.data[p[0]][p[1]].damage[userID]/Monster.data[p[0]][p[1]].total);if(typeof Monster.data[r[0]][r[1]].damage!=="undefined"&&typeof Monster.data[r[0]][r[1]].total!=="undefined")t=sum(Monster.data[r[0]][r[1]].damage[userID]/
Monster.data[r[0]][r[1]].total)}if(typeof u==="undefined")return 1;else if(typeof t==="undefined")return-1;if(typeof u==="string"||typeof t==="string")return e?(t||"")>(u||""):(t||"")<(u||"");return e?(u||0)-(t||0):(t||0)-(u||0)});th(q,"");th(q,"User");th(q,"Health",'title="(estimated)"');th(q,"Att Bonus",'title="Composite of Fortification or Dispel into an approximate attack bonus (+50%...-50%)."');th(q,"Damage");th(q,"Time Left");th(q,"Kill In (ETD)",'title="(estimated)"');th(q,"");m.push('<table cellspacing="0" style="width:100%"><thead><tr>'+
q.join("")+"</tr></thead><tbody>");for(g=0;g<this.order.length;g++){f=this.order[g][0];h=this.order[g][1];if(this.types[h]){q=[];k=this.data[f][h];s=!((k.state==="engage"||k.state==="assist")&&k.total);l=Monster.option.assist_link&&(k.state==="engage"||k.state==="assist")?"?user="+f+"&action=doObjective"+(Monster.types[h].mpool?"&mpool="+Monster.types[h].mpool:"")+"&lka="+f+"&ref=nf":"?user="+f+(Monster.types[h].mpool?"&mpool="+Monster.types[h].mpool:"");td(q,'<a href="http://apps.facebook.com/castle_age/'+
(Monster.types[h].raid?"raid.php":"battle_monster.php")+l+'"><img src="'+imagepath+Monster.types[h].list+'" style="width:72px;height:20px; position: relative; left: -8px; opacity:.7;" alt="'+h+'"><strong class="overlay">'+k.state+"</strong></a>",'title="'+Monster.types[h].name+" | Achievement: "+addCommas(Monster.types[h].achievement)+" | Loot: "+addCommas(Monster.types[h].achievement*2)+'"');th(q,'<a class="golem-monster-ignore" name="'+f+"+"+h+'" title="Toggle Active/Inactive"'+(Monster.data[f][h].ignore?
' style="text-decoration: line-through;"':"")+">"+Monster.data[f][h].name+"</a>");td(q,s?"":k.health===100?"100%":addCommas(k.total-k.damage_total)+" ("+k.health.round(1)+"%)");td(q,s?"":isNumber(k.attackbonus)?k.attackbonus.round(1)+"%":"",isNumber(k.strength)?'title="Max: '+(k.strength-50).round(1)+'%"':"");td(q,s?"":k.state!=="engage"?"":typeof k.damage[userID]==="undefined"?"":addCommas(k.damage[userID][0]||0)+" ("+((k.damage[userID][0]||0)/k.total*100).round(2)+"%)",s?"":'title="In '+(k.battle_count||
"an unknown number of")+' attacks"');td(q,s?"":k.timer?'<span class="golem-timer">'+makeTimer((k.finish-Date.now())/1E3)+"</span>":"?");td(q,s?"":'<span class="golem-timer">'+(k.health===100?makeTimer((k.finish-Date.now())/1E3):makeTimer((k.eta-Date.now())/1E3))+"</span>");th(q,'<a class="golem-monster-delete" name="'+f+"+"+h+'" title="Delete this Monster from the dashboard">[x]</a>');tr(m,q.join(""))}}m.push("</tbody></table>");$("#golem-dashboard-Monster").html(m.join(""));$("a.golem-monster-delete").live("click",
function(){var p=$(this).attr("name").split("+");Monster._unflush();delete Monster.data[p[0]][p[1]];length(Monster.data[p[0]])||delete Monster.data[p[0]];Monster.dashboard();return false});$("a.golem-monster-ignore").live("click",function(){var p=$(this).attr("name").split("+");Monster._unflush();Monster.data[p[0]][p[1]].ignore=!Monster.data[p[0]][p[1]].ignore;Monster.dashboard();Page.page!=="keep_monster"?Page.to("keep_monster"):Page.to("index");return false});if(typeof d!=="undefined")$("#golem-dashboard-Monster thead th:eq("+
d+")").attr("name",e?"reverse":"sort").append("&nbsp;"+(e?"&uarr;":"&darr;"))};var News=new Worker("News");News.data=null;News.option=null;News.defaults.castle_age={pages:"index"};News.runtime={last:0};
News.parse=function(d){if(d){var e=0,f=0,h=0,g=0,k=0,l=0,m=0,q;d=[];var o={},n=this.runtime.last;News.runtime.last=Date.now();$("#app"+APPID+"_battleUpdateBox .alertsContainer .alert_content").each(function(s,p){var r;s=$(p).text().replace(/,/g,"");r=$(p).prev().text();var u=r.regex(/([0-9]+) days/i),t=r.regex(/([0-9]+) hours/i),v=r.regex(/([0-9]+) minutes/i),y=r.regex(/([0-9]+) seconds/i),w=r=0,x=0,z=0;u=Date.now()-((((u||0)*24+(t||0))*60+(v||59))*60+(y||59))*1E3;if(s.regex(/You were killed/i))l++;
else{r=$("a:eq(0)",p).attr("href").regex(/user=([0-9]+)/i);o[r]=o[r]||{name:$("a:eq(0)",p).text(),win:0,lose:0};p=null;if(s.regex(/Victory!/i)){g++;o[r].lose++;r=s.regex(/([0-9]+) experience/i);w=s.regex(/([0-9]+) Battle Points!/i);x=s.regex(/([0-9]+) War Points!/i);z=s.regex(/\$([0-9]+)/i);p="win"}else{k++;o[r].win++;r=0-s.regex(/([0-9]+) experience/i);w=0-s.regex(/([0-9]+) Battle Points!/i);x=0-s.regex(/([0-9]+) War Points!/i);z=0-s.regex(/\$([0-9]+)/i);p="loss"}if(u>n){u=Math.floor(u/36E5);History.add([u,
"exp+battle"],r);History.add([u,"bp+battle"],w);History.add([u,"wp+battle"],x);History.add([u,"income+battle"],z);switch(p){case "win":History.add([u,"battle+win"],1);break;case "loss":History.add([u,"battle+loss"],-1);break}}e+=r;f+=w;h+=x;m+=z}});if(g||k){d.push("You were challenged <strong>"+(g+k)+"</strong> times, winning <strong>"+g+"</strong> and losing <strong>"+k+"</strong>.");d.push("You "+(e>=0?'gained <span class="positive">':'lost <span class="negative">')+addCommas(Math.abs(e))+"</span> experience points.");
d.push("You "+(m>=0?'gained <span class="positive">':'lost <span class="negative">')+'<b class="gold">$'+addCommas(Math.abs(m))+"</b></span>.");d.push("You "+(f>=0?'gained <span class="positive">':'lost <span class="negative">')+addCommas(Math.abs(f))+"</span> Battle Points.");d.push("You "+(h>=0?'gained <span class="positive">':'lost <span class="negative">')+addCommas(Math.abs(h))+"</span> War Points.");d.push("");o=sortObject(o,function(s,p){return o[p].win+o[p].lose/100-(o[s].win+o[s].lose/100)});
for(q in o)d.push('<strong title="'+q+'">'+o[q].name+"</strong> "+(o[q].win?'beat you <span class="negative">'+o[q].win+"</span> time"+(o[q].win>1?"s":""):"")+(o[q].lose?(o[q].win?" and ":"")+'was beaten <span class="positive">'+o[q].lose+"</span> time"+(o[q].lose>1?"s":""):"")+".");if(l)d.push("You died "+(l>1?l+" times":"once")+"!");$("#app"+APPID+"_battleUpdateBox  .alertsContainer").prepend('<div style="padding: 0pt 0pt 10px;"><div class="alert_title">Summary:</div><div class="alert_content">'+
d.join("<br>")+"</div></div>")}}return true};var Player=new Worker("Player");Player.settings={keep:true};Player.defaults.castle_age={pages:"*"};Player.runtime={cash_timeout:null,energy_timeout:null,health_timeout:null,stamina_timeout:null};var use_average_level=false;
Player.init=function(){var d=new Date(script_started+$("*").html().regex(/gold_increase_ticker\(([0-9]+),/)*1E3);this.data.cash_time=d.getSeconds()+d.getMinutes()*60;this.runtime.cash_timeout=null;this.runtime.energy_timeout=null;this.runtime.health_timeout=null;this.runtime.stamina_timeout=null};
Player.parse=function(){var d=this.data,e;if($("#app"+APPID+"_energy_current_value").length){e=$("#app"+APPID+"_energy_current_value").parent().text().regex(/([0-9]+)\s*\/\s*([0-9]+)/);d.energy=e[0]||0}if($("#app"+APPID+"_health_current_value").length){e=$("#app"+APPID+"_health_current_value").parent().text().regex(/([0-9]+)\s*\/\s*([0-9]+)/);d.health=e[0]||0}if($("#app"+APPID+"_stamina_current_value").length){e=$("#app"+APPID+"_stamina_current_value").parent().text().regex(/([0-9]+)\s*\/\s*([0-9]+)/);
d.stamina=e[0]||0}if($("#app"+APPID+"_st_2_5 strong:not([title])").length){e=$("#app"+APPID+"_st_2_5").text().regex(/([0-9]+)\s*\/\s*([0-9]+)/);d.exp=e[0]||0;d.maxexp=e[1]||0}d.cash=parseInt($("strong#app"+APPID+"_gold_current_value").text().replace(/[^0-9]/g,""),10);d.level=$("#app"+APPID+"_st_5").text().regex(/Level: ([0-9]+)!/i);d.armymax=$("a[href*=army.php]","#app"+APPID+"_main_bntp").text().regex(/([0-9]+)/);d.army=Math.min(d.armymax,501);d.upgrade=$("a[href*=keep.php]","#app"+APPID+"_main_bntp").text().regex(/([0-9]+)/)||
0;d.general=$("div.general_name_div3").first().text().trim();d.imagepath=$("#app"+APPID+"_globalContainer img:eq(0)").attr("src").pathpart();if(Page.page==="keep_stats"){e=$("div.keep_attribute_section").first();if(e.length){d.myname=$("div.keep_stat_title_inc > span",e).text().regex(/"(.*)"/);d.rank=$("td.statsTMainback img[src*=rank_medals]").attr("src").filepart().regex(/([0-9]+)/);e=$("div.attribute_stat_container",e);d.maxenergy=$(e).eq(0).text().regex(/([0-9]+)/);d.maxstamina=$(e).eq(1).text().regex(/([0-9]+)/);
d.attack=$(e).eq(2).text().regex(/([0-9]+)/);d.defense=$(e).eq(3).text().regex(/([0-9]+)/);d.maxhealth=$(e).eq(4).text().regex(/([0-9]+)/);d.bank=parseInt($("td.statsTMainback b.money").text().replace(/[^0-9]/g,""),10);e=$('.statsTB table table:contains("Total Income")').text().replace(/[^0-9$]/g,"").regex(/([0-9]+)\$([0-9]+)\$([0-9]+)/);d.maxincome=e[0];d.upkeep=e[1];d.income=e[2]}}if(Page.page==="town_land"){e=$(".mContTMainback div:last-child");d.income=e.eq(e.length-4).text().replace(/[^0-9]/g,
"").regex(/([0-9]+)/)}$("span.result_body").each(function(f,h){f=$(h).text().replace(/,|\s+|\n/g,"");History.add("income",sum(f.regex(/Gain.*\$([0-9]+).*Cost|stealsGold:\+\$([0-9]+)|Youreceived\$([0-9]+)|Yougained\$([0-9]+)/i)));f.regex(/incomepaymentof\$([0-9]+)gold/i)&&History.set("land",sum(f.regex(/incomepaymentof\$([0-9]+)gold|backinthemine:Extra([0-9]+)Gold/i)))});if($("#app"+APPID+"_energy_time_value").length){window.clearTimeout(this.runtime.energy_timeout);this.runtime.energy_timeout=window.setTimeout(function(){Player.get("energy")},
$("#app"+APPID+"_energy_time_value").text().parseTimer()*1E3)}if($("#app"+APPID+"_health_time_value").length){window.clearTimeout(this.runtime.health_timeout);this.runtime.health_timeout=window.setTimeout(function(){Player.get("health")},$("#app"+APPID+"_health_time_value").text().parseTimer()*1E3)}if($("#app"+APPID+"_stamina_time_value").length){window.clearTimeout(this.runtime.stamina_timeout);this.runtime.stamina_timeout=window.setTimeout(function(){Player.get("stamina")},$("#app"+APPID+"_stamina_time_value").text().parseTimer()*
1E3)}$("strong#app"+APPID+"_gold_current_value").attr("title","Cash in Bank: $"+addCommas(d.bank));return false};
Player.update=function(d){if(d!=="option"){var e,f=["stamina","energy","health"],h,g;for(e=0;e<f.length;e++){h=[];g=Divisor(Player.data["max"+f[e]]);for(d=0;d<=Player.data["max"+f[e]];d+=g)h.push(d);Config.set(f[e],h)}History.set("bank",this.data.bank);History.set("exp",this.data.exp)}Dashboard.status(this,"Income: $"+addCommas(Math.max(this.data.income,(History.get("land.average.1")+History.get("income.average.24")).round()))+" per hour (currently $"+addCommas(History.get("land.average.1"))+" from land)")};
Player.get=function(d){var e=this.data;Date.now();switch(d){case "cash":return this.data.cash=parseInt($("strong#app"+APPID+"_gold_current_value").text().replace(/[^0-9]/g,""),10);case "cash_timer":d=new Date;return(3600+e.cash_time-(d.getSeconds()+d.getMinutes()*60))%3600;case "energy":return this.data.energy=$("#app"+APPID+"_energy_current_value").parent().text().regex(/([0-9]+)\s*\/\s*[0-9]+/);case "energy_timer":return $("#app"+APPID+"_energy_time_value").text().parseTimer();case "health":return this.data.health=
$("#app"+APPID+"_health_current_value").parent().text().regex(/([0-9]+)\s*\/\s*[0-9]+/);case "health_timer":return $("#app"+APPID+"_health_time_value").text().parseTimer();case "stamina":return this.data.stamina=$("#app"+APPID+"_stamina_current_value").parent().text().regex(/([0-9]+)\s*\/\s*[0-9]+/);case "stamina_timer":return $("#app"+APPID+"_stamina_time_value").text().parseTimer();case "exp_needed":return e.maxexp-e.exp;case "pause":return isWorker(Window)&&!Window.active?"(Disabled) ":isWorker(Queue)&&
Queue.get("option.pause")?"(Paused) ":"";case "bank":return e.bank-Bank.option.keep>0?e.bank-Bank.option.keep:0;default:return this._get(d)}};var Potions=new Worker("Potions");Potions.defaults.castle_age={pages:"*"};Potions.option={energy:35,stamina:35};Potions.runtime={drink:false};
Potions.display=[{id:"energy",label:"Maximum Energy Potions",select:{0:0,5:5,10:10,15:15,20:20,25:25,30:30,35:35,40:40,infinite:"&infin;"},help:"Will use them when you have to many, if you collect more than 40 they will be lost anyway"},{id:"stamina",label:"Maximum Stamina Potions",select:{0:0,5:5,10:10,15:15,20:20,25:25,30:30,35:35,40:40,infinite:"&infin;"},help:"Will use them when you have to many, if you collect more than 40 they will be lost anyway"}];
Potions.parse=function(){$('.result_body:contains("You have acquired the Energy Potion!")').each(function(){Potions.data.Energy=(Potions.data.Energy||0)+1});if(Page.page==="keep_stats"){this.data={};$(".statsT2:eq(2) .statUnit").each(function(d,e){if((d=$(e).text().replace(/\s+/g," ").trim().regex(/(.*) Potion x ([0-9]+)/i))&&d[0]&&d[1])Potions.data[d[0]]=d[1]})}return false};
Potions.update=function(){var d,e=[],f=LevelUp.get("runtime.running");this.runtime.drink=false;if(Queue.enabled(this))for(d in this.data){this.data[d]&&e.push(makeImage("potion_"+d.toLowerCase())+this.data[d]+"/"+this.option[d.toLowerCase()]);if(!f&&typeof this.option[d.toLowerCase()]==="number"&&this.data[d]>this.option[d.toLowerCase()]&&(Player.get(d.toLowerCase())||0)<(Player.get("max"+d.toLowerCase())||0))this.runtime.drink=true}Dashboard.status(this,e.join(", "))};
Potions.work=function(d){if(!this.runtime.drink)return QUEUE_FINISH;if(!d||!Page.to("keep_stats"))return QUEUE_CONTINUE;for(var e in this.data)if(typeof this.option[e.toLowerCase()]==="number"&&this.data[e]>this.option[e.toLowerCase()]){debug("Wanting to drink a "+e+" potion");Page.click('.statUnit:contains("'+e+'") form .imgButton input');break}return QUEUE_RELEASE};var Quest=new Worker("Quest");Quest.defaults.castle_age={pages:"quests_quest1 quests_quest2 quests_quest3 quests_quest4 quests_quest5 quests_quest6 quests_quest7 quests_quest8 quests_demiquests quests_atlantis"};
Quest.option={general:true,general_choice:"any",what:"Influence",unique:true,monster:true,bank:true};Quest.runtime={best:null,energy:0};Quest.land=["Land of Fire","Land of Earth","Land of Mist","Land of Water","Demon Realm","Undead Realm","Underworld","Kingdom of Heaven"];Quest.area={quest:"Quests",demiquest:"Demi Quests",atlantis:"Atlantis"};Quest.current=null;
Quest.display=[{id:"general",label:"Use Best General",require:{"Caap.runtime.enabled":false},checkbox:true},{advanced:true,id:"general_choice",label:"Subquest General",require:"Caap.runtime.enabled",select:"bestgenerals"},{id:"what",label:"Quest for",select:"quest_reward",help:"Once you have unlocked all areas (Advancement) it will switch to Influence. Once you have 100% Influence it will switch to Experience"},{id:"unique",label:"Get Unique Items First",checkbox:true},{id:"monster",label:"Fortify Monsters First",
checkbox:true},{id:"bank",label:"Automatically Bank",checkbox:true}];Quest.init=function(){for(var d in this.data)d.indexOf("\t")!==-1&&delete this.data[d]};
Quest.parse=function(){var d=this.data,e=null,f=null,h;if(Page.page==="quests_quest")return false;else if(Page.page==="quests_demiquests")e="demiquest";else if(Page.page==="quests_atlantis")e="atlantis";else{e="quest";f=Page.page.regex(/quests_quest([0-9]+)/i)-1}for(h in d)if(d[h].area===e&&(e!=="quest"||d[h].land===f))delete d[h];if($("div.quests_background,div.quests_background_sub").length!==$("div.quests_background .quest_progress,div.quests_background_sub .quest_sub_progress").length){Page.to(Page.page,
"");return false}$("div.quests_background,div.quests_background_sub,div.quests_background_special").each(function(g,k){var l,m,q,o,n,s=0;if($(k).hasClass("quests_background_sub")){g=$(".quest_sub_title",k).text().trim();q=$(".qd_2_sub",k).text().replace(/[^0-9$]/g,"").regex(/^([0-9]+)\$([0-9]+)\$([0-9]+)$/);n=$(".qd_3_sub",k).text().regex(/([0-9]+)/);l=$(".quest_sub_progress",k).text().regex(/LEVEL ([0-9]+)/i);m=$(".quest_sub_progress",k).text().regex(/INFLUENCE: ([0-9]+)%/i);s=2}else{g=$(".qd_1 b",
k).text().trim();q=$(".qd_2",k).text().replace(/[^0-9$]/g,"").regex(/^([0-9]+)\$([0-9]+)\$([0-9]+)$/);n=$(".quest_req b",k).text().regex(/([0-9]+)/);if($(k).hasClass("quests_background")){l=$(".quest_progress",k).text().regex(/LEVEL ([0-9]+)/i);m=$(".quest_progress",k).text().regex(/INFLUENCE: ([0-9]+)%/i);s=1}else s=3}if(!(!g||g.indexOf("\t")!==-1)){d[g]={};d[g].area=e;d[g].type=s;d[g].id=parseInt($('input[name="quest"]',k).val());if(typeof f==="number")d[g].land=f;if(typeof m==="number"){d[g].level=
l||0;d[g].influence=m}d[g].exp=q[0];d[g].reward=(q[1]+q[2])/2;d[g].energy=n;if(s!==2){if(s===3)d[g].unique=true;l=$(".qd_1 img",k).last();if(l.length&&l.attr("title")){d[g].item=l.attr("title").trim();d[g].itemimg=l.attr("src").filepart()}o={};$(".quest_req >div >div >div",k).each(function(p,r){p=$("img",r).attr("title");o[p]=$(r).text().regex(/([0-9]+)/)});if(length(o))d[g].units=o;l=$(".quest_act_gen img",k);if(l.length&&l.attr("title"))d[g].general=l.attr("title")}}});this.data=sortObject(d,function(g,
k){return g>k});return false};
Quest.update=function(d,e){if(!(e===Town&&d!=="data")){var f,h,g,k=false,l=e=null,m=null,q=null,o=0;k=[];var n=this.data;this._watch(Player);this._watch(Queue);if(!d||d==="data"){for(f in n)n[f].item&&!n[f].unique&&k.push(n[f].item);Config.set("quest_reward",["Nothing","Influence","Advancement","Experience","Cash"].concat(unique(k).sort()))}if(this.option.unique&&Alchemy._changed>this.lastunique){for(f in n)if(n[f].unique)if(!Alchemy.get(["ingredients",n[f].itemimg])&&(!e||n[f].energy<n[e].energy))e=
f;this.lastunique=Date.now()}if(!e&&this.option.what!=="Nothing"){for(f in n){if(n[f].units){k=false;for(h in n[f].units){d=Town.get([h,"own"],0);g=n[f].units[h];if(g>d)k=true}if(k)continue}switch(this.option.what){case "Advancement":if(n[f].type!==2&&typeof n[f].land==="number"&&n[f].land>=o&&(n[f].influence<100||n[f].unique&&!Alchemy.get(["ingredients",n[f].itemimg]))&&(!l||n[f].land>(n[l].land||0)||n[f].land===n[l].land&&n[f].unique&&!length(Player.data[n[f].item]))){o=Math.max(o,n[f].land);l=
f}case "Influence":if(typeof n[f].influence!=="undefined"&&n[f].influence<100&&(!m||n[f].energy<n[m].energy))m=f;case "Experience":if(!q||n[f].energy/n[f].exp<n[q].energy/n[q].exp)q=f;break;case "Cash":if(!e||n[f].energy/n[f].reward<n[e].energy/n[e].reward)e=f;break;default:if(n[f].item===this.option.what&&(!e||n[f].energy<n[e].energy))e=f;break}}switch(this.option.what){case "Advancement":e=l||m||q;break;case "Influence":e=m||q;break;case "Experience":e=q;break;default:break}}if(e!==this.runtime.best)if(this.runtime.best=
e){this.runtime.energy=n[e].energy;debug("Wanting to perform - "+e+" in "+(typeof n[e].land==="number"?this.land[n[e].land]:this.area[n[e].area])+" (energy: "+n[e].energy+", experience: "+n[e].exp+", gold: $"+addCommas(n[e].reward)+")")}e?Dashboard.status(this,(typeof n[e].land==="number"?this.land[n[e].land]:this.area[n[e].area])+": "+e+" ("+makeImage("energy")+n[e].energy+" = "+makeImage("exp")+n[e].exp+" + "+makeImage("gold")+"$"+addCommas(n[e].reward)+(n[e].item?Town.get([n[e].item,"img"],null)?
' + <img style="width:16px;height:16px;margin-bottom:-4px;" src="'+imagepath+Town.get([n[e].item,"img"])+'" title="'+n[e].item+'">':" + "+n[e].item:"")+(typeof n[e].influence!=="undefined"&&n[e].influence<100?" @ "+makeImage("percent","Influence")+n[e].influence+"%":"")+")"):Dashboard.status(this)}};
Quest.work=function(d){var e,f,h=null,g=this.runtime.best;if(!g||this.runtime.energy>Queue.burn.energy){if(d&&this.option.bank)return Bank.work(true);return QUEUE_FINISH}if(this.option.monster&&Monster.option.fortify_active){Monster._unflush();for(e in Monster.data)for(f in Monster.data[e]){if(Monster.data[e][f].state==="engage"&&typeof Monster.data[e][f].defense==="number"&&(typeof Monster.data[e][f].mclass==="undefined"||Monster.data[e][f].mclass<2)&&typeof Monster.data[e][f].attackbonus!=="undefined"&&
Monster.data[e][f].attackbonus<Monster.option.fortify&&Monster.data[e][f].defense<100)return QUEUE_FINISH;if(Monster.option.fortify_active&&typeof Monster.data[e][f].mclass!=="undefined"&&Monster.data[e][f].mclass>1&&typeof Monster.data[e][f].secondary!=="undefined"&&Monster.data[e][f].secondary<100)return QUEUE_FINISH}}if(!d)return QUEUE_CONTINUE;if(this.option.general||"Caap"in Workers)if(this.data[g].general&&typeof this.data[g].influence==="number"&&this.data[g].influence<100){if(!Generals.to(this.data[g].general))return QUEUE_CONTINUE}else{if("Caap"in
Workers&&this.option.general_choice!=="Best")h=this.option.general_choice;else switch(this.option.what){case "Influence":case "Advancement":case "Experience":h=Generals.best("under level 4");if(h==="any"&&this.data[g].influence<100)h=Generals.best("influence");break;case "Cash":h=Generals.best("cash");break;default:h=Generals.best("item");break}if(!Generals.to(h))return QUEUE_CONTINUE}switch(this.data[g].area){case "quest":if(!Page.to("quests_quest"+(this.data[g].land+1)))return QUEUE_CONTINUE;break;
case "demiquest":if(!Page.to("quests_demiquests"))return QUEUE_CONTINUE;break;case "atlantis":if(!Page.to("quests_atlantis"))return QUEUE_CONTINUE;break;default:log("Can't get to quest area!");return QUEUE_FINISH}debug("Performing - "+g+" (energy: "+this.data[g].energy+")");if(!Page.click($('input[name="quest"][value="'+this.data[g].id+'"]').siblings(".imgButton").children('input[type="image"]'))){debug("Can't find button for "+g+", so deleting and re-visiting page...");delete this.data[g];Page.reload()}this.option.unique&&
this.data[g].unique&&!Alchemy.get(["ingredients",this.data[e].itemimg])&&Alchemy.set(["ingredients",this.data[e].itemimg],1);this.option.what==="Advancement"&&this.data[g].unique&&this.data[g].land<6&&Page.to("quests_quest"+(this.data[g].land+2));return QUEUE_RELEASE};Quest.order=[];
Quest.dashboard=function(d,e){function f(m){switch(d){case 0:return Quest.data[m].general||"zzz";case 1:return m;case 2:return typeof Quest.data[m].land==="number"&&typeof Quest.land[Quest.data[m].land]!=="undefined"?Quest.land[Quest.data[m].land]:Quest.area[Quest.data[m].area];case 3:return(typeof Quest.data[m].level!=="undefined"?Quest.data[m].level:-1)*100+(Quest.data[m].influence||0);case 4:return Quest.data[m].energy;case 5:return Quest.data[m].exp/Quest.data[m].energy;case 6:return Quest.data[m].reward/
Quest.data[m].energy;case 7:return Quest.data[m].item||"zzz"}return 0}var h,g,k=[],l=[];if(typeof d==="undefined"){this.order=[];for(h in this.data)this.order.push(h)}if(typeof d==="undefined")d=this.runtime.sort||1;if(typeof e==="undefined")e=this.runtime.rev||false;this.runtime.sort=d;this.runtime.rev=e;this.order.sort(function(m,q){m=f(m);q=f(q);if(typeof m==="string"||typeof q==="string")return e?(q||"")>(m||""):(q||"")<(m||"");return e?(m||0)-(q||0):(q||0)-(m||0)});th(l,"General");th(l,"Name");
th(l,"Area");th(l,"Level");th(l,"Energy");th(l,"@&nbsp;Exp");th(l,"@&nbsp;Reward");th(l,"Item");k.push('<table cellspacing="0" style="width:100%"><thead><tr>'+l.join("")+"</tr></thead><tbody>");for(g=0;g<this.order.length;g++){h=this.order[g];l=[];td(l,Generals.get([this.data[h].general])?'<img style="width:25px;height:25px;" src="'+imagepath+Generals.get([this.data[h].general,"img"])+'" alt="'+this.data[h].general+'" title="'+this.data[h].general+'">':"");th(l,h);td(l,typeof this.data[h].land===
"number"?this.land[this.data[h].land].replace(" ","&nbsp;"):this.area[this.data[h].area].replace(" ","&nbsp;"));td(l,typeof this.data[h].level!=="undefined"?this.data[h].level+"&nbsp;("+this.data[h].influence+"%)":"");td(l,this.data[h].energy);td(l,(this.data[h].exp/this.data[h].energy).round(2),'title="'+this.data[h].exp+" total, "+(this.data[h].exp/this.data[h].energy*12).round(2)+' per hour"');td(l,"$"+addCommas((this.data[h].reward/this.data[h].energy).round()),'title="$'+addCommas(this.data[h].reward)+
" total, $"+addCommas((this.data[h].reward/this.data[h].energy*12).round())+' per hour"');td(l,this.data[h].itemimg?'<img style="width:25px;height:25px;" src="'+imagepath+this.data[h].itemimg+'" alt="'+this.data[h].item+'" title="'+this.data[h].item+'">':"");tr(k,l.join(""),'style="height:25px;"')}k.push("</tbody></table>");$("#golem-dashboard-Quest").html(k.join(""));$("#golem-dashboard-Quest tbody tr td:nth-child(2)").css("text-align","left");if(typeof d!=="undefined")$("#golem-dashboard-Quest thead th:eq("+
d+")").attr("name",e?"reverse":"sort").append("&nbsp;"+(e?"&uarr;":"&darr;"))};var Town=new Worker("Town");Town.data={};Town.defaults.castle_age={pages:"town_soldiers town_blacksmith town_magic"};Town.option={general:true,number:"Minimum",maxcost:"$100k",units:"All",sell:false};Town.runtime={best:null,buy:0,cost:0};
Town.display=[{label:"Work in progress..."},{id:"general",label:"Use Best General",checkbox:true},{id:"number",label:"Buy Number",select:["None","Minimum","Match Army","Maximum"],help:"Minimum will buy before any quests (otherwise only bought when needed), Maximum will buy 501 (depending on generals)"},{advanced:true,id:"maxcost",label:"Maximum Buy Cost",select:["$10k","$100k","$1m","$10m","$100m","$1b","$10b","$100b"]},{advanced:true,id:"units",label:"Buy Type",select:["All","Best Offense","Best Defense",
"Best of Both"]},{advanced:true,id:"sell",label:"Auto-Sell<br>(Not enabled)",checkbox:true}];
Town.blacksmith={Weapon:/avenger|axe|blade|bow|cleaver|cudgel|dagger|halberd|mace|morningstar|rod|saber|spear|staff|stave|sword|talon|trident|wand|Daedalus|Dragonbane|Dreadnought Greatsword|Excalibur|Incarnation|Ironhart's Might|Judgement|Justice|Lightbringer|Oathkeeper|Onslaught/i,Shield:/buckler|shield|tome|Defender|Dragon Scale|Frost Dagger|Frost Tear Dagger|Harmony|Sword of Redemption|Terra's Guard|The Dreadnought/i,Helmet:/cowl|crown|helm|horns|mask|veil/i,Gloves:/gauntlet|glove|hand|bracer|Slayer's Embrace/i,
Armor:/armor|chainmail|cloak|pauldrons|plate|raiments|robe|Blood Vestment|Garlans Battlegear|Faerie Wings/i,Amulet:/amulet|bauble|charm|crystal|eye|heart|insignia|jewel|lantern|memento|orb|shard|soul|talisman|trinket|Paladin's Oath|Poseidons Horn| Ring|Ring of|Ruby Ore|Thawing Star/i};Town.init=function(){this._watch(Bank)};
Town.parse=function(d){if(d)Page.page==="town_blacksmith"&&$(".eq_buy_row,.eq_buy_row2").each(function(h,g){h=$("div.eq_buy_txt strong:first-child",g);g=h.text().trim();Town.data[g].type&&h.parent().append("<br>"+Town.data[g].type)});else{var e=Town.data,f=Page.page.substr(5);$(".eq_buy_row,.eq_buy_row2").each(function(h,g){!$("div.eq_buy_costs_int",g).length&&$("div.eq_buy_costs",g).prepend('<div class="eq_buy_costs_int"></div>').children("div.eq_buy_costs_int").append($('div.eq_buy_costs >[class!="eq_buy_costs_int"]',
g));!$("div.eq_buy_stats_int",g).length&&$("div.eq_buy_stats",g).prepend('<div class="eq_buy_stats_int"></div>').children("div.eq_buy_stats_int").append($('div.eq_buy_stats >[class!="eq_buy_stats_int"]',g));!$("div.eq_buy_txt_int",g).length&&$("div.eq_buy_txt",g).prepend('<div class="eq_buy_txt_int"></div>').children("div.eq_buy_txt_int").append($('div.eq_buy_txt >[class!="eq_buy_txt_int"]',g));var k;h=$("div.eq_buy_stats",g);var l=$("div.eq_buy_txt strong:first",g).text().trim(),m=$("div.eq_buy_costs",
g),q=$("strong:first-child",m).text().replace(/[^0-9]/g,"");e[l]=e[l]||{};e[l].page=f;e[l].img=$("div.eq_buy_image img",g).attr("src").filepart();e[l].own=$(m).text().regex(/Owned: ([0-9]+)/i);e[l].att=$("div.eq_buy_stats_int div:eq(0)",h).text().regex(/([0-9]+)\s*Attack/);e[l].def=$("div.eq_buy_stats_int div:eq(1)",h).text().regex(/([0-9]+)\s*Defense/);if(q){e[l].cost=parseInt(q,10);e[l].buy=[];$('select[name="amount"]:first option',m).each(function(o,n){e[l].buy.push(parseInt($(n).val(),10))})}if(f===
"blacksmith")for(k in Town.blacksmith)if(l.match(Town.blacksmith[k]))e[l].type=k})}return true};
Town.getInvade=function(d){var e=0,f=0,h=this.data;e+=getAttDef(h,function(g,k,l){l[k].page==="soldiers"&&g.push(k)},"att",d,"invade");f+=getAttDef(h,null,"def",d,"invade");e+=getAttDef(h,function(g,k,l){l[k].type&&l[k].type!=="Weapon"&&g.push(k)},"att",d,"invade");f+=getAttDef(h,null,"def",d,"invade");e+=getAttDef(h,function(g,k,l){l[k].type==="Weapon"&&g.push(k)},"att",d,"invade");f+=getAttDef(h,null,"def",d,"invade");e+=getAttDef(h,function(g,k,l){l[k].page==="magic"&&g.push(k)},"att",d,"invade");
f+=getAttDef(h,null,"def",d,"invade");return{attack:e,defend:f}};
Town.getDuel=function(){var d=0,e=0,f=this.data;d+=getAttDef(f,function(h,g,k){k[g].type==="Weapon"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");d+=getAttDef(f,function(h,g,k){k[g].page==="magic"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");d+=getAttDef(f,function(h,g,k){k[g].type==="Shield"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");d+=getAttDef(f,function(h,g,k){k[g].type==="Helmet"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",
1,"duel");d+=getAttDef(f,function(h,g,k){k[g].type==="Gloves"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");d+=getAttDef(f,function(h,g,k){k[g].type==="Armor"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");d+=getAttDef(f,function(h,g,k){k[g].type==="Amulet"&&h.push(g)},"att",1,"duel");e+=getAttDef(f,null,"def",1,"duel");return{attack:d,defend:e}};
Town.update=function(){var d,e,f=null,h=0,g=this.data,k;this.runtime.invade=this.getInvade(Player.get("army"));this.runtime.duel=this.getDuel();if(this.option.number!=="None"){k=Quest.get();for(d in k)if(k[d].units)for(e in k[d].units)if(g[e]&&g[e].cost&&g[e].own<k[d].units[e]){f=e;h=k[d].units[e]-g[e].own}}if(this.runtime.best=f){this.runtime.buy=h;this.runtime.cost=h*g[f].cost;Dashboard.status(this,"Want to buy "+h+" x "+f+" for $"+addCommas(this.runtime.cost)+" (Cash in bank: $"+addCommas(Player.get("bank"))+
")")}else Dashboard.status(this)};Town.work=function(d){if(!this.runtime.best||!this.runtime.buy||!Bank.worth(this.runtime.cost))return QUEUE_FINISH;if(!d||!this.buy(this.runtime.best,this.runtime.buy))return QUEUE_CONTINUE;return QUEUE_RELEASE};
Town.buy=function(d,e){this._unflush();if(!this.data[d]||!this.data[d].buy||!Bank.worth(this.runtime.cost))return true;if(!Generals.to(this.option.general?"cost":"any")||!Bank.retrieve(this.runtime.cost)||this.data[d].page==="soldiers"&&!Generals.to("cost")||!Page.to("town_"+this.data[d].page))return false;var f,h=0;for(f=0;f<this.data[d].buy.length&&this.data[d].buy[f]<=e;f++)h=this.data[d].buy[f];$(".eq_buy_row,.eq_buy_row2").each(function(g,k){if($("div.eq_buy_txt strong:first",k).text().trim()===
d){debug("Buying "+h+" x "+d+" for $"+addCommas(h*Town.data[d].cost));$('div.eq_buy_costs select[name="amount"]:eq(0)',k).val(h);Page.click($('div.eq_buy_costs input[name="Buy"]',k))}});return false};
var makeTownDash=function(d,e,f,h,g,k){var l=[],m=[],q=f==="att"?"def":"att",o,n={Weapon:1,Shield:2,Helmet:3,Armor:4,Amulet:5,Gloves:6,Magic:7};g&&m.push('<div class="golem-panel"><h3 class="golem-panel-header">'+g+'</h3><div class="golem-panel-content">');for(o in d)e(l,o,d);if(d[l[0]])if(h==="duel"&&d[l[0]].type)l.sort(function(s,p){return n[d[s].type]-n[d[p].type]});else d[l[0]]&&d[l[0]].skills&&d[l[0]][h]?l.sort(function(s,p){return(d[p][h][f]||0)-(d[s][h][f]||0)}):l.sort(function(s,p){return d[p][f]+
0.7*d[p][q]-(d[s][f]+0.7*d[s][q])});for(o=0;o<(k?k:l.length);o++)if(d[l[0]]&&d[l[0]].skills||d[l[o]].use&&d[l[o]].use[h+"_"+f])m.push('<div style="height:25px;margin:1px;"><img src="'+imagepath+d[l[o]].img+'" style="width:25px;height:25px;float:left;margin-right:4px;">'+(d[l[o]].use?d[l[o]].use[h+"_"+f]+" x ":"")+l[o]+" ("+d[l[o]].att+" / "+d[l[o]].def+")"+(d[l[o]].cost?"<br>$"+addCommas(d[l[o]].cost):"")+"</div>");g&&m.push("</div></div>");return m.join("")};
Town.dashboard=function(){var d,e;e=Generals.get();var f;f=Generals.best("duel");d='<div style="float:left;width:50%;"><div class="golem-panel"><h3 class="golem-panel-header">Invade - Attack</h3><div class="golem-panel-content" style="padding:8px;">'+makeTownDash(e,function(h,g){h.push(g)},"att","invade","Heroes")+makeTownDash(this.data,function(h,g,k){k[g].page==="soldiers"&&k[g].use&&h.push(g)},"att","invade","Soldiers")+makeTownDash(this.data,function(h,g,k){k[g].use&&k[g].type==="Weapon"&&h.push(g)},
"att","invade","Weapons")+makeTownDash(this.data,function(h,g,k){k[g].page==="blacksmith"&&k[g].use&&k[g].type!=="Weapon"&&h.push(g)},"att","invade","Equipment")+makeTownDash(this.data,function(h,g,k){k[g].page==="magic"&&k[g].use&&h.push(g)},"att","invade","Magic")+'</div></div><div class="golem-panel"><h3 class="golem-panel-header">Duel - Attack</h3><div class="golem-panel-content" style="padding:8px;">'+(f!=="any"?'<div style="height:25px;margin:1px;"><img src="'+imagepath+e[f].img+'" style="width:25px;height:25px;float:left;margin-right:4px;">'+
f+" ("+e[f].att+" / "+e[f].def+")</div>":"")+makeTownDash(this.data,function(h,g,k){k[g].page==="blacksmith"&&k[g].use&&h.push(g)},"att","duel")+makeTownDash(this.data,function(h,g,k){k[g].page==="magic"&&k[g].use&&h.push(g)},"att","duel")+"</div></div></div>";f=Generals.best("defend");e='<div style="float:right;width:50%;"><div class="golem-panel"><h3 class="golem-panel-header">Invade - Defend</h3><div class="golem-panel-content" style="padding:8px;">'+makeTownDash(e,function(h,g){h.push(g)},"def",
"invade","Heroes")+makeTownDash(this.data,function(h,g,k){k[g].page==="soldiers"&&k[g].use&&h.push(g)},"def","invade","Soldiers")+makeTownDash(this.data,function(h,g,k){k[g].use&&k[g].type==="Weapon"&&h.push(g)},"def","invade","Weapons")+makeTownDash(this.data,function(h,g,k){k[g].page==="blacksmith"&&k[g].use&&k[g].type!=="Weapon"&&h.push(g)},"def","invade","Equipment")+makeTownDash(this.data,function(h,g,k){k[g].page==="magic"&&k[g].use&&h.push(g)},"def","invade","Magic")+'</div></div><div class="golem-panel"><h3 class="golem-panel-header">Duel - Defend</h3><div class="golem-panel-content" style="padding:8px;">'+
(f!=="any"?'<div style="height:25px;margin:1px;"><img src="'+imagepath+e[f].img+'" style="width:25px;height:25px;float:left;margin-right:4px;">'+f+" ("+e[f].att+" / "+e[f].def+")</div>":"")+makeTownDash(this.data,function(h,g,k){k[g].page==="blacksmith"&&k[g].use&&h.push(g)},"def","duel")+makeTownDash(this.data,function(h,g,k){k[g].page==="magic"&&k[g].use&&h.push(g)},"def","duel")+"</div></div></div>";$("#golem-dashboard-Town").html(d+e)};var Upgrade=new Worker("Upgrade");Upgrade.data=null;
Upgrade.defaults.castle_age={pages:"keep_stats"};Upgrade.option={order:[]};Upgrade.runtime={working:false,run:0};Upgrade.display=[{label:"Points will be allocated in this order, add multiple entries if wanted (ie, 3x Attack and 1x Defense would put &frac34; on Attack and &frac14; on Defense)"},{id:"order",multiple:["Energy","Stamina","Attack","Defense","Health"]}];
Upgrade.init=function(){if(this.option.run){this.runtime.run=this.option.run;delete this.option.run}if(this.option.working){this.runtime.working=this.option.working;delete this.option.working}};Upgrade.parse=function(){var d=$("div.results");if(this.runtime.working&&d.length&&d.text().match(/You just upgraded your/i)){this.runtime.working=false;this.runtime.run++}return false};
Upgrade.work=function(d){var e=Player.get("upgrade");if(this.runtime.run>=this.option.order.length)this.runtime.run=0;if(!this.option.order.length||!e||this.option.order[this.runtime.run]==="Stamina"&&e<2)return QUEUE_FINISH;if(!d||!Page.to("keep_stats"))return QUEUE_CONTINUE;switch(this.option.order[this.runtime.run]){case "Energy":d='a[href$="?upgrade=energy_max"]';break;case "Stamina":d='a[href$="?upgrade=stamina_max"]';break;case "Attack":d='a[href$="?upgrade=attack"]';break;case "Defense":d=
'a[href$="?upgrade=defense"]';break;case "Health":d='a[href$="?upgrade=health_max"]';break;default:this.runtime.run++;return true}if(Page.click(d))this.runtime.working=true;else Page.reload();return QUEUE_RELEASE};
